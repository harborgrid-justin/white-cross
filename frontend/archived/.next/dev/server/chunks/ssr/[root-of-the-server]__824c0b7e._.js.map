{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/components/layouts/Breadcrumbs.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Breadcrumbs = registerClientReference(\n    function() { throw new Error(\"Attempted to call Breadcrumbs() from the server but Breadcrumbs is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/layouts/Breadcrumbs.tsx <module evaluation>\",\n    \"Breadcrumbs\",\n);\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/layouts/Breadcrumbs.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/layouts/Breadcrumbs.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;;;AACvE;;AACO,MAAM,cAAc,IAAA,wQAAuB,EAC9C;IAAa,MAAM,IAAI,MAAM;AAAsO,GACnQ,wEACA;uCAEW,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA0S,GACvU,wEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/components/layouts/Breadcrumbs.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Breadcrumbs = registerClientReference(\n    function() { throw new Error(\"Attempted to call Breadcrumbs() from the server but Breadcrumbs is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/layouts/Breadcrumbs.tsx\",\n    \"Breadcrumbs\",\n);\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/layouts/Breadcrumbs.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/layouts/Breadcrumbs.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;;;AACvE;;AACO,MAAM,cAAc,IAAA,wQAAuB,EAC9C;IAAa,MAAM,IAAI,MAAM;AAAsO,GACnQ,oDACA;uCAEW,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAsR,GACnT,oDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/components/layouts/PageHeader.tsx"],"sourcesContent":["/**\r\n * WF-COMP-NAV-006 | PageHeader.tsx - Unified Page Header Component\r\n * Purpose: Consistent page header with title, description, actions, breadcrumbs\r\n * Dependencies: react, Breadcrumbs, Next.js Link\r\n * Features: Responsive, action buttons area, optional description, back navigation, custom breadcrumbs\r\n * Last Updated: 2025-11-02\r\n * Agent: UI/UX Architect\r\n */\r\n\r\nimport React, { memo, ReactNode } from 'react'\r\nimport Link from 'next/link'\r\nimport { ChevronLeft } from 'lucide-react'\r\nimport Breadcrumbs from './Breadcrumbs'\r\n\r\n// ============================================================================\r\n// MAIN PAGE HEADER COMPONENT\r\n// ============================================================================\r\n\r\n/**\r\n * Props for the PageHeader component.\r\n *\r\n * @property {string} title - Main page title displayed prominently\r\n * @property {string} [description] - Optional descriptive text below the title (alias: subtitle)\r\n * @property {string} [subtitle] - Alternative prop name for description (for backward compatibility)\r\n * @property {ReactNode} [actions] - Optional action buttons or controls (e.g., \"Add New\", \"Export\")\r\n * @property {ReactNode} [action] - Alternative single action prop (for backward compatibility)\r\n * @property {boolean} [showBreadcrumbs=true] - Whether to show breadcrumb navigation\r\n * @property {Array} [breadcrumbs] - Custom breadcrumb items array\r\n * @property {string} [backLink] - Optional back navigation link\r\n * @property {string} [backLabel='Back'] - Label for back link button\r\n * @property {ReactNode} [children] - Optional additional content below the header\r\n * @property {string} [className] - Optional CSS classes for the container\r\n */\r\ninterface PageHeaderProps {\r\n  title: string\r\n  description?: string\r\n  subtitle?: string // Alias for description\r\n  actions?: ReactNode\r\n  action?: ReactNode // Alias for actions (singular)\r\n  showBreadcrumbs?: boolean\r\n  breadcrumbs?: Array<{ label: string; href?: string }>\r\n  backLink?: string\r\n  backLabel?: string\r\n  children?: ReactNode\r\n  className?: string\r\n}\r\n\r\n/**\r\n * Unified page header component with breadcrumbs, title, description, and actions.\r\n *\r\n * Provides a consistent header layout for all application pages including:\r\n * - Optional back navigation link\r\n * - Breadcrumb navigation for context (auto-generated or custom)\r\n * - Page title\r\n * - Optional description/subtitle text\r\n * - Action button area\r\n * - Additional content area\r\n *\r\n * Layout:\r\n * - Responsive flex layout\r\n * - Desktop: Title and actions side-by-side\r\n * - Mobile: Stacked layout with title first\r\n * - Breadcrumbs always at top when shown\r\n *\r\n * Features:\r\n * - Back navigation support\r\n * - Consistent spacing and typography\r\n * - Responsive design\r\n * - Dark mode support\r\n * - Text truncation for long titles\r\n * - Flexible action area for buttons/controls\r\n * - Custom or auto-generated breadcrumbs\r\n * - Backward compatible with both old APIs\r\n *\r\n * @param props - Component props\r\n * @param props.title - Main page title\r\n * @param props.description - Optional descriptive text\r\n * @param props.subtitle - Alternative prop name for description\r\n * @param props.actions - Optional action buttons/controls\r\n * @param props.action - Alternative single action prop\r\n * @param props.showBreadcrumbs - Toggle breadcrumb display (default: true)\r\n * @param props.breadcrumbs - Custom breadcrumb items\r\n * @param props.backLink - Optional back navigation URL\r\n * @param props.backLabel - Label for back link (default: 'Back')\r\n * @param props.children - Additional content below header\r\n * @param props.className - Additional CSS classes\r\n * @returns JSX element representing the page header\r\n *\r\n * @example\r\n * ```tsx\r\n * <PageHeader\r\n *   title=\"Student Health Records\"\r\n *   description=\"View and manage student medical information\"\r\n * />\r\n * ```\r\n *\r\n * @example\r\n * ```tsx\r\n * <PageHeader\r\n *   title=\"Medications\"\r\n *   description=\"Track and dispense medications\"\r\n *   actions={\r\n *     <>\r\n *       <Button variant=\"secondary\">Export</Button>\r\n *       <Button variant=\"default\">Add Medication</Button>\r\n *     </>\r\n *   }\r\n *   showBreadcrumbs={true}\r\n * />\r\n * ```\r\n *\r\n * @example\r\n * ```tsx\r\n * <PageHeader\r\n *   title=\"New Message\"\r\n *   description=\"Compose and send a new message\"\r\n *   backLink=\"/messages\"\r\n *   backLabel=\"Back to Messages\"\r\n * />\r\n * ```\r\n */\r\nexport const PageHeader = memo(({\r\n  title,\r\n  description,\r\n  subtitle,\r\n  actions,\r\n  action,\r\n  showBreadcrumbs = true,\r\n  breadcrumbs,\r\n  backLink,\r\n  backLabel = 'Back',\r\n  children,\r\n  className = ''\r\n}: PageHeaderProps) => {\r\n  // Support both description and subtitle props (backward compatibility)\r\n  const descriptionText = description || subtitle;\r\n\r\n  // Support both actions and action props (backward compatibility)\r\n  const actionElements = actions || action;\r\n\r\n  return (\r\n    <div className={`page-header mb-6 ${className}`}>\r\n      {/* Back Navigation */}\r\n      {backLink && (\r\n        <div className=\"mb-2\">\r\n          <Link\r\n            href={backLink}\r\n            className=\"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 transition-colors\"\r\n          >\r\n            <ChevronLeft className=\"w-4 h-4 mr-1\" />\r\n            {backLabel}\r\n          </Link>\r\n        </div>\r\n      )}\r\n\r\n      {/* Breadcrumbs */}\r\n      {showBreadcrumbs && (\r\n        <div className=\"mb-4\">\r\n          {breadcrumbs ? (\r\n            <Breadcrumbs items={breadcrumbs} />\r\n          ) : (\r\n            <Breadcrumbs />\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Header Content */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div className=\"flex-1 min-w-0\">\r\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100 dark:text-white truncate\">\r\n            {title}\r\n          </h1>\r\n          {descriptionText && (\r\n            <p className=\"mt-1 text-sm text-gray-500 dark:text-gray-400 text-gray-600\">\r\n              {descriptionText}\r\n            </p>\r\n          )}\r\n        </div>\r\n\r\n        {/* Action Buttons */}\r\n        {actionElements && (\r\n          <div className=\"flex-shrink-0 flex items-center gap-2\">\r\n            {actionElements}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Additional Content */}\r\n      {children && (\r\n        <div className=\"mt-4\">\r\n          {children}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n})\r\n\r\nPageHeader.displayName = 'PageHeader'\r\n\r\nexport default PageHeader\r\n\r\n"],"names":[],"mappings":"AAAA;;;;;;;CAOC;;;;;;;AAED;AACA;AACA;AACA;;;;;;AA6GO,MAAM,2BAAa,IAAA,6MAAI,EAAC,CAAC,EAC9B,KAAK,EACL,WAAW,EACX,QAAQ,EACR,OAAO,EACP,MAAM,EACN,kBAAkB,IAAI,EACtB,WAAW,EACX,QAAQ,EACR,YAAY,MAAM,EAClB,QAAQ,EACR,YAAY,EAAE,EACE;IAChB,uEAAuE;IACvE,MAAM,kBAAkB,eAAe;IAEvC,iEAAiE;IACjE,MAAM,iBAAiB,WAAW;IAElC,qBACE,8OAAC;QAAI,WAAW,CAAC,iBAAiB,EAAE,WAAW;;YAE5C,0BACC,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC,0LAAI;oBACH,MAAM;oBACN,WAAU;;sCAEV,8OAAC,mOAAW;4BAAC,WAAU;;;;;;wBACtB;;;;;;;;;;;;YAMN,iCACC,8OAAC;gBAAI,WAAU;0BACZ,4BACC,8OAAC,uJAAW;oBAAC,OAAO;;;;;6EAEpB,8OAAC,uJAAW;;;;;;;;;;0BAMlB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAG,WAAU;0CACX;;;;;;4BAEF,iCACC,8OAAC;gCAAE,WAAU;0CACV;;;;;;;;;;;;oBAMN,gCACC,8OAAC;wBAAI,WAAU;kCACZ;;;;;;;;;;;;YAMN,0BACC,8OAAC;gBAAI,WAAU;0BACZ;;;;;;;;;;;;AAKX;AAEA,WAAW,WAAW,GAAG;uCAEV","debugId":null}},
    {"offset": {"line": 187, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/components/ui/skeleton.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Skeleton = registerClientReference(\n    function() { throw new Error(\"Attempted to call Skeleton() from the server but Skeleton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/skeleton.tsx <module evaluation>\",\n    \"Skeleton\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,WAAW,IAAA,wQAAuB,EAC3C;IAAa,MAAM,IAAI,MAAM;AAAgO,GAC7P,gEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/components/ui/skeleton.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Skeleton = registerClientReference(\n    function() { throw new Error(\"Attempted to call Skeleton() from the server but Skeleton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/skeleton.tsx\",\n    \"Skeleton\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,WAAW,IAAA,wQAAuB,EAC3C;IAAa,MAAM,IAAI,MAAM;AAAgO,GAC7P,4CACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 215, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 223, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/app/%28dashboard%29/health-records/_components/HealthRecordsContent.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const HealthRecordsContent = registerClientReference(\n    function() { throw new Error(\"Attempted to call HealthRecordsContent() from the server but HealthRecordsContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/health-records/_components/HealthRecordsContent.tsx <module evaluation>\",\n    \"HealthRecordsContent\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,uBAAuB,IAAA,wQAAuB,EACvD;IAAa,MAAM,IAAI,MAAM;AAAwP,GACrR,yGACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 237, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/app/%28dashboard%29/health-records/_components/HealthRecordsContent.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const HealthRecordsContent = registerClientReference(\n    function() { throw new Error(\"Attempted to call HealthRecordsContent() from the server but HealthRecordsContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/health-records/_components/HealthRecordsContent.tsx\",\n    \"HealthRecordsContent\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,uBAAuB,IAAA,wQAAuB,EACvD;IAAa,MAAM,IAAI,MAAM;AAAwP,GACrR,qFACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 251, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 259, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/app/%28dashboard%29/health-records/_components/HealthRecordsFilters.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const HealthRecordsFilters = registerClientReference(\n    function() { throw new Error(\"Attempted to call HealthRecordsFilters() from the server but HealthRecordsFilters is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/health-records/_components/HealthRecordsFilters.tsx <module evaluation>\",\n    \"HealthRecordsFilters\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,uBAAuB,IAAA,wQAAuB,EACvD;IAAa,MAAM,IAAI,MAAM;AAAwP,GACrR,yGACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/app/%28dashboard%29/health-records/_components/HealthRecordsFilters.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const HealthRecordsFilters = registerClientReference(\n    function() { throw new Error(\"Attempted to call HealthRecordsFilters() from the server but HealthRecordsFilters is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/health-records/_components/HealthRecordsFilters.tsx\",\n    \"HealthRecordsFilters\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,uBAAuB,IAAA,wQAAuB,EACvD;IAAa,MAAM,IAAI,MAAM;AAAwP,GACrR,qFACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 287, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 295, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/identity-access/lib/config/cookies.ts"],"sourcesContent":["/**\r\n * @fileoverview Centralized Cookie Configuration\r\n * @module lib/config/cookies\r\n *\r\n * Single source of truth for all authentication cookie settings.\r\n * Implements security best practices including:\r\n * - __Host- prefix for maximum security\r\n * - Consistent naming across the application\r\n * - Secure defaults for production environments\r\n * - HIPAA-compliant session management\r\n *\r\n * Security Features:\r\n * - __Host- prefix prevents subdomain and path manipulation\r\n * - httpOnly prevents XSS attacks\r\n * - secure ensures HTTPS-only transmission\r\n * - sameSite prevents CSRF attacks\r\n * - Appropriate maxAge for healthcare security requirements\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie\r\n * @see https://web.dev/first-party-cookie-recipes/\r\n */\r\n\r\nimport { ResponseCookie } from 'next/dist/compiled/@edge-runtime/cookies';\r\n\r\n/**\r\n * Cookie names with __Host- prefix for maximum security\r\n *\r\n * The __Host- prefix ensures:\r\n * - Cookie must be set with Secure flag\r\n * - Cookie must be set from a secure origin (HTTPS)\r\n * - Cookie must NOT have a Domain attribute (preventing subdomain access)\r\n * - Cookie path must be /\r\n *\r\n * NOTE: __Host- prefix requires HTTPS. In development (localhost), we use\r\n * regular cookie names without the prefix.\r\n */\r\nexport const COOKIE_NAMES = {\r\n  /** Access token for API authentication */\r\n  ACCESS_TOKEN: process.env.NODE_ENV === 'production' ? '__Host-auth.token' : 'auth.token',\r\n\r\n  /** Refresh token for obtaining new access tokens */\r\n  REFRESH_TOKEN: process.env.NODE_ENV === 'production' ? '__Host-auth.refresh' : 'auth.refresh',\r\n\r\n  /** Session identifier (if using session-based auth alongside JWT) */\r\n  SESSION_ID: process.env.NODE_ENV === 'production' ? '__Host-auth.session' : 'auth.session',\r\n} as const;\r\n\r\n/**\r\n * Cookie expiration times in seconds\r\n */\r\nexport const COOKIE_MAX_AGE = {\r\n  /** Access token: 1 hour (short-lived for security) */\r\n  ACCESS_TOKEN: 60 * 60,\r\n\r\n  /** Refresh token: 7 days (allows persistent login) */\r\n  REFRESH_TOKEN: 7 * 24 * 60 * 60,\r\n\r\n  /** Session: 24 hours (daily re-authentication for HIPAA compliance) */\r\n  SESSION: 24 * 60 * 60,\r\n} as const;\r\n\r\n/**\r\n * Base cookie options for all authentication cookies\r\n * These settings ensure maximum security\r\n */\r\nconst BASE_COOKIE_OPTIONS: Partial<ResponseCookie> = {\r\n  /** Path where cookie is valid */\r\n  path: '/',\r\n\r\n  /** Prevent JavaScript access (XSS protection) */\r\n  httpOnly: true,\r\n\r\n  /** Strict CSRF protection - cookie only sent to same-site requests */\r\n  sameSite: 'strict',\r\n\r\n  /** Only send over HTTPS in production */\r\n  secure: process.env.NODE_ENV === 'production',\r\n} as const;\r\n\r\n/**\r\n * Get cookie options for access token\r\n *\r\n * @param overrides - Optional overrides for specific use cases\r\n * @returns Complete cookie configuration for access token\r\n *\r\n * @example\r\n * ```typescript\r\n * import { cookies } from 'next/headers';\r\n * import { getAccessTokenCookieOptions, COOKIE_NAMES } from './config/cookies';\r\n *\r\n * const cookieStore = await cookies();\r\n * cookieStore.set(COOKIE_NAMES.ACCESS_TOKEN, token, getAccessTokenCookieOptions());\r\n * ```\r\n */\r\nexport function getAccessTokenCookieOptions(\r\n  overrides?: Partial<ResponseCookie>\r\n): ResponseCookie {\r\n  return {\r\n    ...BASE_COOKIE_OPTIONS,\r\n    maxAge: COOKIE_MAX_AGE.ACCESS_TOKEN,\r\n    ...overrides,\r\n  } as ResponseCookie;\r\n}\r\n\r\n/**\r\n * Get cookie options for refresh token\r\n *\r\n * @param overrides - Optional overrides for specific use cases\r\n * @returns Complete cookie configuration for refresh token\r\n *\r\n * @example\r\n * ```typescript\r\n * cookieStore.set(COOKIE_NAMES.REFRESH_TOKEN, refreshToken, getRefreshTokenCookieOptions());\r\n * ```\r\n */\r\nexport function getRefreshTokenCookieOptions(\r\n  overrides?: Partial<ResponseCookie>\r\n): ResponseCookie {\r\n  return {\r\n    ...BASE_COOKIE_OPTIONS,\r\n    maxAge: COOKIE_MAX_AGE.REFRESH_TOKEN,\r\n    ...overrides,\r\n  } as ResponseCookie;\r\n}\r\n\r\n/**\r\n * Get cookie options for session identifier\r\n *\r\n * @param overrides - Optional overrides for specific use cases\r\n * @returns Complete cookie configuration for session\r\n *\r\n * @example\r\n * ```typescript\r\n * cookieStore.set(COOKIE_NAMES.SESSION_ID, sessionId, getSessionCookieOptions());\r\n * ```\r\n */\r\nexport function getSessionCookieOptions(\r\n  overrides?: Partial<ResponseCookie>\r\n): ResponseCookie {\r\n  return {\r\n    ...BASE_COOKIE_OPTIONS,\r\n    maxAge: COOKIE_MAX_AGE.SESSION,\r\n    ...overrides,\r\n  } as ResponseCookie;\r\n}\r\n\r\n/**\r\n * Legacy cookie names for migration support\r\n * These should be removed in a future version\r\n *\r\n * @deprecated Use COOKIE_NAMES instead\r\n */\r\nexport const LEGACY_COOKIE_NAMES = {\r\n  auth_token: 'auth_token',\r\n  refresh_token: 'refresh_token',\r\n  authToken: 'authToken',\r\n  refreshToken: 'refreshToken',\r\n} as const;\r\n\r\n/**\r\n * Clear all authentication cookies\r\n * Useful for logout operations\r\n *\r\n * @param cookieStore - Next.js cookies() instance\r\n *\r\n * @example\r\n * ```typescript\r\n * import { cookies } from 'next/headers';\r\n * import { clearAuthCookies } from './config/cookies';\r\n *\r\n * export async function logout() {\r\n *   const cookieStore = await cookies();\r\n *   clearAuthCookies(cookieStore);\r\n * }\r\n * ```\r\n */\r\nexport async function clearAuthCookies(\r\n  cookieStore: Awaited<ReturnType<typeof import('next/headers').cookies>>\r\n): Promise<void> {\r\n  // Clear current cookies\r\n  cookieStore.delete(COOKIE_NAMES.ACCESS_TOKEN);\r\n  cookieStore.delete(COOKIE_NAMES.REFRESH_TOKEN);\r\n  cookieStore.delete(COOKIE_NAMES.SESSION_ID);\r\n\r\n  // Clear legacy cookies for migration\r\n  Object.values(LEGACY_COOKIE_NAMES).forEach((name) => {\r\n    cookieStore.delete(name);\r\n  });\r\n}\r\n\r\n/**\r\n * Get token from cookies with fallback to legacy names\r\n * This supports migration from old cookie names to new secure names\r\n *\r\n * @param cookieStore - Next.js cookies() instance\r\n * @returns Access token if found, null otherwise\r\n *\r\n * @example\r\n * ```typescript\r\n * const token = getAccessTokenFromCookies(await cookies());\r\n * if (token) {\r\n *   // Verify and use token\r\n * }\r\n * ```\r\n */\r\nexport function getAccessTokenFromCookies(\r\n  cookieStore: Awaited<ReturnType<typeof import('next/headers').cookies>>\r\n): string | null {\r\n  // Try new secure cookie name first\r\n  let token = cookieStore.get(COOKIE_NAMES.ACCESS_TOKEN)?.value;\r\n\r\n  if (token) {\r\n    return token;\r\n  }\r\n\r\n  // Fall back to legacy names for migration\r\n  for (const legacyName of Object.values(LEGACY_COOKIE_NAMES)) {\r\n    token = cookieStore.get(legacyName)?.value;\r\n    if (token) {\r\n      console.warn(\r\n        `[Cookie Migration] Found token in legacy cookie '${legacyName}'. ` +\r\n        `Please migrate to '${COOKIE_NAMES.ACCESS_TOKEN}' for improved security.`\r\n      );\r\n      return token;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Get refresh token from cookies with fallback to legacy names\r\n *\r\n * @param cookieStore - Next.js cookies() instance\r\n * @returns Refresh token if found, null otherwise\r\n */\r\nexport function getRefreshTokenFromCookies(\r\n  cookieStore: Awaited<ReturnType<typeof import('next/headers').cookies>>\r\n): string | null {\r\n  // Try new secure cookie name first\r\n  const token = cookieStore.get(COOKIE_NAMES.REFRESH_TOKEN)?.value;\r\n\r\n  if (token) {\r\n    return token;\r\n  }\r\n\r\n  // Fall back to legacy refresh_token\r\n  const legacyToken = cookieStore.get(LEGACY_COOKIE_NAMES.refresh_token)?.value ||\r\n                      cookieStore.get(LEGACY_COOKIE_NAMES.refreshToken)?.value;\r\n\r\n  if (legacyToken) {\r\n    console.warn(\r\n      '[Cookie Migration] Found refresh token in legacy cookie. ' +\r\n      `Please migrate to '${COOKIE_NAMES.REFRESH_TOKEN}' for improved security.`\r\n    );\r\n  }\r\n\r\n  return legacyToken || null;\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;CAoBC;;;;;;;;;;;;;;;;;;;;AAgBM,MAAM,eAAe;IAC1B,wCAAwC,GACxC,cAAc,sCAAwC,0BAAsB;IAE5E,kDAAkD,GAClD,eAAe,sCAAwC,0BAAwB;IAE/E,mEAAmE,GACnE,YAAY,sCAAwC,0BAAwB;AAC9E;AAKO,MAAM,iBAAiB;IAC5B,oDAAoD,GACpD,cAAc,KAAK;IAEnB,oDAAoD,GACpD,eAAe,IAAI,KAAK,KAAK;IAE7B,qEAAqE,GACrE,SAAS,KAAK,KAAK;AACrB;AAEA;;;CAGC,GACD,MAAM,sBAA+C;IACnD,+BAA+B,GAC/B,MAAM;IAEN,+CAA+C,GAC/C,UAAU;IAEV,oEAAoE,GACpE,UAAU;IAEV,uCAAuC,GACvC,QAAQ,oDAAyB;AACnC;AAiBO,SAAS,4BACd,SAAmC;IAEnC,OAAO;QACL,GAAG,mBAAmB;QACtB,QAAQ,eAAe,YAAY;QACnC,GAAG,SAAS;IACd;AACF;AAaO,SAAS,6BACd,SAAmC;IAEnC,OAAO;QACL,GAAG,mBAAmB;QACtB,QAAQ,eAAe,aAAa;QACpC,GAAG,SAAS;IACd;AACF;AAaO,SAAS,wBACd,SAAmC;IAEnC,OAAO;QACL,GAAG,mBAAmB;QACtB,QAAQ,eAAe,OAAO;QAC9B,GAAG,SAAS;IACd;AACF;AAQO,MAAM,sBAAsB;IACjC,YAAY;IACZ,eAAe;IACf,WAAW;IACX,cAAc;AAChB;AAmBO,eAAe,iBACpB,WAAuE;IAEvE,wBAAwB;IACxB,YAAY,MAAM,CAAC,aAAa,YAAY;IAC5C,YAAY,MAAM,CAAC,aAAa,aAAa;IAC7C,YAAY,MAAM,CAAC,aAAa,UAAU;IAE1C,qCAAqC;IACrC,OAAO,MAAM,CAAC,qBAAqB,OAAO,CAAC,CAAC;QAC1C,YAAY,MAAM,CAAC;IACrB;AACF;AAiBO,SAAS,0BACd,WAAuE;IAEvE,mCAAmC;IACnC,IAAI,QAAQ,YAAY,GAAG,CAAC,aAAa,YAAY,GAAG;IAExD,IAAI,OAAO;QACT,OAAO;IACT;IAEA,0CAA0C;IAC1C,KAAK,MAAM,cAAc,OAAO,MAAM,CAAC,qBAAsB;QAC3D,QAAQ,YAAY,GAAG,CAAC,aAAa;QACrC,IAAI,OAAO;YACT,QAAQ,IAAI,CACV,CAAC,iDAAiD,EAAE,WAAW,GAAG,CAAC,GACnE,CAAC,mBAAmB,EAAE,aAAa,YAAY,CAAC,wBAAwB,CAAC;YAE3E,OAAO;QACT;IACF;IAEA,OAAO;AACT;AAQO,SAAS,2BACd,WAAuE;IAEvE,mCAAmC;IACnC,MAAM,QAAQ,YAAY,GAAG,CAAC,aAAa,aAAa,GAAG;IAE3D,IAAI,OAAO;QACT,OAAO;IACT;IAEA,oCAAoC;IACpC,MAAM,cAAc,YAAY,GAAG,CAAC,oBAAoB,aAAa,GAAG,SACpD,YAAY,GAAG,CAAC,oBAAoB,YAAY,GAAG;IAEvE,IAAI,aAAa;QACf,QAAQ,IAAI,CACV,8DACA,CAAC,mBAAmB,EAAE,aAAa,aAAa,CAAC,wBAAwB,CAAC;IAE9E;IAEA,OAAO,eAAe;AACxB","debugId":null}},
    {"offset": {"line": 424, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/api/nextjs-client.ts"],"sourcesContent":["/**\r\n * @fileoverview Next.js Fetch-Based API Client\r\n * @module lib/api/nextjs-client\r\n * @category API Client\r\n *\r\n * Enterprise-grade HTTP client built on Next.js native fetch API with comprehensive\r\n * caching, revalidation, and error handling capabilities.\r\n *\r\n * Key Features:\r\n * - Native Next.js fetch with automatic request deduplication\r\n * - Cache configuration (cache, revalidate, tags)\r\n * - cacheLife support for Next.js 15+\r\n * - Type-safe HTTP methods (GET, POST, PUT, PATCH, DELETE)\r\n * - Automatic authentication token injection\r\n * - CSRF protection headers\r\n * - Comprehensive error handling and retry logic\r\n * - Request ID generation for tracing\r\n * - HIPAA-compliant audit logging integration\r\n *\r\n * This client is designed to replace axios-based clients in Server Components\r\n * and Server Actions, enabling full integration with Next.js caching system.\r\n *\r\n * @example\r\n * ```typescript\r\n * // In a Server Component\r\n * const students = await serverGet<Student[]>('/api/students', {\r\n *   cache: 'force-cache',\r\n *   next: {\r\n *     revalidate: CACHE_TTL.PHI_STANDARD,\r\n *     tags: [CACHE_TAGS.STUDENTS, CACHE_TAGS.PHI]\r\n *   }\r\n * });\r\n *\r\n * // In a Server Action\r\n * const result = await serverPost<Student>('/api/students', data, {\r\n *   cache: 'no-store',\r\n *   next: { tags: [CACHE_TAGS.STUDENTS] }\r\n * });\r\n * ```\r\n *\r\n * @version 1.0.0\r\n * @since 2025-10-31\r\n */\r\n\r\nimport { cookies, headers } from 'next/headers';\r\nimport { redirect } from 'next/navigation';\r\nimport { COOKIE_NAMES } from '@/identity-access/lib/config/cookies';\r\n\r\n// ==========================================\r\n// TYPE DEFINITIONS\r\n// ==========================================\r\n\r\n/**\r\n * Simple API client options for basic HTTP requests\r\n * @deprecated Consider using NextFetchOptions for new code\r\n */\r\nexport interface ApiClientOptions {\r\n  method?: string\r\n  body?: unknown\r\n  headers?: Record<string, string>\r\n}\r\n\r\n/**\r\n * Next.js cache configuration options\r\n */\r\nexport interface NextCacheConfig {\r\n  /**\r\n   * Cache behavior\r\n   * - 'force-cache': Cache the response (default for GET)\r\n   * - 'no-store': Never cache the response (default for mutations)\r\n   * - 'reload': Bypass cache and revalidate\r\n   * - 'no-cache': Cache but always revalidate\r\n   * - 'force-cache': Use cache if available, fetch if not\r\n   * - 'only-if-cached': Use cache only, fail if not cached\r\n   */\r\n  cache?: RequestCache;\r\n\r\n  /**\r\n   * Next.js-specific cache options\r\n   */\r\n  next?: {\r\n    /**\r\n     * Time in seconds to revalidate cache\r\n     * - number: Revalidate after N seconds\r\n     * - false: Never revalidate (cache indefinitely)\r\n     * - 0: Revalidate immediately (effectively no-store)\r\n     */\r\n    revalidate?: number | false;\r\n\r\n    /**\r\n     * Cache tags for granular invalidation via revalidateTag()\r\n     * @example ['students', 'phi-data']\r\n     */\r\n    tags?: string[];\r\n  };\r\n}\r\n\r\n/**\r\n * cacheLife profiles for Next.js 15+ advanced caching\r\n * @see https://nextjs.org/docs/app/api-reference/next-config-js/cacheLife\r\n */\r\nexport interface CacheLifeConfig {\r\n  /**\r\n   * Time to live in seconds\r\n   */\r\n  ttl: number;\r\n\r\n  /**\r\n   * Stale-while-revalidate window in seconds\r\n   */\r\n  stale?: number;\r\n\r\n  /**\r\n   * Maximum age in cache regardless of revalidation\r\n   */\r\n  max?: number;\r\n}\r\n\r\n/**\r\n * Extended fetch options with Next.js caching and authentication\r\n */\r\nexport interface NextFetchOptions extends RequestInit {\r\n  /**\r\n   * Whether to include authentication token\r\n   * @default true\r\n   */\r\n  requiresAuth?: boolean;\r\n\r\n  /**\r\n   * Cache behavior configuration\r\n   */\r\n  cache?: RequestCache;\r\n\r\n  /**\r\n   * Next.js-specific cache options\r\n   */\r\n  next?: {\r\n    revalidate?: number | false;\r\n    tags?: string[];\r\n  };\r\n\r\n  /**\r\n   * cacheLife profile (Next.js 15+)\r\n   */\r\n  cacheLife?: string | CacheLifeConfig;\r\n\r\n  /**\r\n   * Retry configuration\r\n   */\r\n  retry?: {\r\n    attempts: number;\r\n    delay: number;\r\n  };\r\n\r\n  /**\r\n   * Custom error handler\r\n   */\r\n  onError?: (error: Error) => void;\r\n\r\n  /**\r\n   * Request timeout in milliseconds\r\n   */\r\n  timeout?: number;\r\n}\r\n\r\n/**\r\n * Standardized API response wrapper\r\n */\r\nexport interface ApiResponse<T = unknown> {\r\n  success: boolean;\r\n  data: T;\r\n  message?: string;\r\n  errors?: Record<string, string[]>;\r\n}\r\n\r\n/**\r\n * API error response structure\r\n */\r\nexport interface ApiErrorResponse {\r\n  message: string;\r\n  code?: string;\r\n  status?: number;\r\n  details?: unknown;\r\n  field?: string;\r\n  traceId?: string;\r\n  timestamp?: string;\r\n}\r\n\r\n/**\r\n * Custom error class for Next.js API client errors\r\n *\r\n * @class\r\n * @extends Error\r\n * @classdesc Wraps API errors with metadata and automatic classification\r\n */\r\nexport class NextApiClientError extends Error {\r\n  public readonly code?: string;\r\n  public readonly status?: number;\r\n  public readonly details?: unknown;\r\n  public readonly traceId?: string;\r\n  public readonly isNetworkError: boolean;\r\n  public readonly isServerError: boolean;\r\n  public readonly isValidationError: boolean;\r\n\r\n  constructor(error: ApiErrorResponse) {\r\n    super(error.message);\r\n    this.name = 'NextApiClientError';\r\n    this.code = error.code;\r\n    this.status = error.status;\r\n    this.details = error.details;\r\n    this.traceId = error.traceId;\r\n\r\n    // Classify error types\r\n    this.isNetworkError = error.code === 'NETWORK_ERROR';\r\n    this.isServerError = (error.status ?? 0) >= 500;\r\n    this.isValidationError = error.status === 400;\r\n\r\n    // Maintain proper stack trace\r\n    if (typeof Error.captureStackTrace === 'function') {\r\n      Error.captureStackTrace(this, NextApiClientError);\r\n    }\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// CONFIGURATION\r\n// ==========================================\r\n\r\n/**\r\n * Get API base URL from environment\r\n */\r\nfunction getApiBaseUrl(): string {\r\n  return process.env.API_BASE_URL ||\r\n         process.env.NEXT_PUBLIC_API_URL ||\r\n         'http://localhost:3001';\r\n}\r\n\r\n/**\r\n * Get authentication token from cookies (server-side only)\r\n */\r\nasync function getAuthToken(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await cookies();\r\n    // Use centralized cookie name configuration (environment-aware)\r\n    return cookieStore.get(COOKIE_NAMES.ACCESS_TOKEN)?.value || null;\r\n  } catch (error) {\r\n    console.error('[Next API Client] Failed to get auth token:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Generate unique request ID for tracing\r\n * Made dynamic to avoid prerendering issues\r\n */\r\nfunction generateRequestId(): string {\r\n  // Access headers first to make this function dynamic during prerendering\r\n  headers();\r\n  return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Get CSRF token from cookies\r\n */\r\nasync function getCsrfToken(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await cookies();\r\n    return cookieStore.get('csrf-token')?.value || null;\r\n  } catch (error) {\r\n    console.error('[Next API Client] Failed to get CSRF token:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// CORE FETCH FUNCTION\r\n// ==========================================\r\n\r\n/**\r\n * Core fetch function with Next.js caching, authentication, and error handling\r\n *\r\n * @template T - The expected response data type\r\n * @param endpoint - API endpoint (relative or absolute URL)\r\n * @param options - Fetch options with Next.js caching configuration\r\n * @returns Promise resolving to typed API response\r\n *\r\n * @throws {NextApiClientError} On request failure\r\n *\r\n * @example\r\n * ```typescript\r\n * const response = await nextFetch<Student[]>('/api/students', {\r\n *   cache: 'force-cache',\r\n *   next: { revalidate: 60, tags: ['students'] }\r\n * });\r\n * ```\r\n */\r\nexport async function nextFetch<T>(\r\n  endpoint: string,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  const {\r\n    requiresAuth = true, // Enable authentication by default\r\n    onError,\r\n    retry = { attempts: 3, delay: 1000 },\r\n    timeout = 30000,\r\n    cache = 'force-cache',\r\n    next,\r\n    cacheLife,\r\n    ...fetchOptions\r\n  } = options;\r\n\r\n  // Build full URL\r\n  const url = endpoint.startsWith('http')\r\n    ? endpoint\r\n    : `${getApiBaseUrl()}${endpoint}`;\r\n\r\n  // Prepare headers\r\n  const headers: Record<string, string> = {\r\n    'Content-Type': 'application/json',\r\n  };\r\n\r\n  // Merge additional headers\r\n  if (fetchOptions.headers) {\r\n    Object.entries(fetchOptions.headers).forEach(([key, value]) => {\r\n      if (typeof value === 'string') {\r\n        headers[key] = value;\r\n      }\r\n    });\r\n  }\r\n\r\n  // Add authentication if required\r\n  if (requiresAuth) {\r\n    const token = await getAuthToken();\r\n\r\n    // Don't redirect during login/auth endpoints\r\n    const isAuthEndpoint = endpoint.includes('/auth/') || \r\n                          endpoint.includes('/login') || \r\n                          endpoint.includes('/register') ||\r\n                          endpoint.includes('/forgot-password') ||\r\n                          endpoint.includes('/reset-password');\r\n\r\n    console.log('[Next API Client] Auth check:', {\r\n      endpoint,\r\n      hasToken: !!token,\r\n      tokenStart: token?.substring(0, 20),\r\n      isAuthEndpoint,\r\n      requiresAuth\r\n    });\r\n\r\n    if (!token && !isAuthEndpoint) {\r\n      // Redirect to login if no token (but not during auth operations)\r\n      console.error('[Next API Client] No auth token found for protected endpoint:', endpoint);\r\n      // Note: redirect() in server components/actions can cause issues\r\n      // Consider using middleware for auth protection instead\r\n      redirect('/login');\r\n    }\r\n\r\n    if (token) {\r\n      headers['Authorization'] = `Bearer ${token}`;\r\n      console.log('[Next API Client] Added Authorization header:', {\r\n        authHeaderStart: headers['Authorization'].substring(0, 30),\r\n        fullAuthHeaderLength: headers['Authorization'].length\r\n      });\r\n    }\r\n  }\r\n\r\n  // Add CSRF token for mutations\r\n  if (fetchOptions.method && ['POST', 'PUT', 'PATCH', 'DELETE'].includes(fetchOptions.method)) {\r\n    const csrfToken = await getCsrfToken();\r\n    if (csrfToken) {\r\n      headers['X-CSRF-Token'] = csrfToken;\r\n    }\r\n  }\r\n\r\n  // Add request ID for tracing\r\n  headers['X-Request-ID'] = generateRequestId();\r\n\r\n  // Add security headers for HIPAA compliance\r\n  headers['X-Content-Type-Options'] = 'nosniff';\r\n  headers['X-Frame-Options'] = 'DENY';\r\n  headers['X-XSS-Protection'] = '1; mode=block';\r\n\r\n  // Build Next.js cache configuration\r\n  const nextConfig: Record<string, unknown> = {};\r\n\r\n  if (next?.revalidate !== undefined) {\r\n    nextConfig.revalidate = next.revalidate;\r\n  }\r\n\r\n  if (next?.tags && next.tags.length > 0) {\r\n    nextConfig.tags = next.tags;\r\n  }\r\n\r\n  // Execute fetch with retry logic\r\n  let lastError: Error | null = null;\r\n\r\n  for (let attempt = 0; attempt < retry.attempts; attempt++) {\r\n    try {\r\n      // Create abort controller for timeout\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n\r\n      const response = await fetch(url, {\r\n        ...fetchOptions,\r\n        headers,\r\n        cache,\r\n        next: Object.keys(nextConfig).length > 0 ? nextConfig : undefined,\r\n        signal: controller.signal,\r\n      });\r\n\r\n      clearTimeout(timeoutId);\r\n\r\n      // Handle different response status codes\r\n      if (!response.ok) {\r\n        // Log 401 errors for debugging before consuming the response\r\n        if (response.status === 401) {\r\n          console.error('[Next API Client] 401 Unauthorized:', {\r\n            endpoint,\r\n            status: response.status,\r\n            statusText: response.statusText,\r\n            hasAuthHeader: !!headers['Authorization'],\r\n            authHeaderStart: headers['Authorization']?.substring(0, 30)\r\n          });\r\n        }\r\n        \r\n        const error = await handleErrorResponse(response);\r\n\r\n        // Handle specific errors with redirects\r\n        // Don't redirect on login/auth endpoints to avoid redirect loops\r\n        const isAuthEndpoint = endpoint.includes('/auth/login') || endpoint.includes('/auth/register');\r\n        \r\n        // Note: Redirects in Server Components/Actions can be tricky\r\n        // These will throw NEXT_REDIRECT which Next.js catches\r\n        // Consider using middleware for auth protection instead\r\n        if (response.status === 401 && !isAuthEndpoint) {\r\n          console.error('[Next API Client] 401 error - authentication required');\r\n          redirect('/login');\r\n        } else if (response.status === 403) {\r\n          console.error('[Next API Client] 403 error - access denied');\r\n          redirect('/access-denied');\r\n        }\r\n\r\n        throw error;\r\n      }\r\n\r\n      // Parse response\r\n      const contentType = response.headers.get('content-type');\r\n      if (contentType?.includes('application/json')) {\r\n        return await response.json() as T;\r\n      }\r\n\r\n      return await response.text() as unknown as T;\r\n\r\n    } catch (error) {\r\n      // Re-throw Next.js redirect errors immediately - they should not be caught\r\n      if (error && typeof error === 'object' && 'digest' in error) {\r\n        const errorWithDigest = error as { digest: unknown };\r\n        if (typeof errorWithDigest.digest === 'string' && \r\n            errorWithDigest.digest.startsWith('NEXT_REDIRECT')) {\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      lastError = error as Error;\r\n\r\n      // Don't retry on client errors (except 408, 429)\r\n      if (error instanceof NextApiClientError) {\r\n        const status = error.status;\r\n        if (status && status >= 400 && status < 500 && status !== 408 && status !== 429) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      // Wait before retry (exponential backoff)\r\n      if (attempt < retry.attempts - 1) {\r\n        await new Promise(resolve =>\r\n          setTimeout(resolve, retry.delay * Math.pow(2, attempt))\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  // All retries failed\r\n  const finalError = lastError || new Error('Unknown error');\r\n\r\n  if (onError) {\r\n    onError(finalError);\r\n  }\r\n\r\n  throw finalError;\r\n}\r\n\r\n/**\r\n * Handle error responses and create normalized error objects\r\n */\r\nasync function handleErrorResponse(response: Response): Promise<NextApiClientError> {\r\n  let details: unknown;\r\n\r\n  try {\r\n    const contentType = response.headers.get('content-type');\r\n    if (contentType?.includes('application/json')) {\r\n      details = await response.json();\r\n    } else {\r\n      details = await response.text();\r\n    }\r\n  } catch {\r\n    details = null;\r\n  }\r\n\r\n  const error: ApiErrorResponse = {\r\n    message: typeof details === 'object' && details !== null && 'message' in details\r\n      ? (details as { message: string }).message\r\n      : response.statusText || 'Request failed',\r\n    status: response.status,\r\n    code: typeof details === 'object' && details !== null && 'code' in details\r\n      ? (details as { code: string }).code\r\n      : undefined,\r\n    details,\r\n    traceId: response.headers.get('x-trace-id') || undefined,\r\n  };\r\n\r\n  return new NextApiClientError(error);\r\n}\r\n\r\n// ==========================================\r\n// CONVENIENCE METHODS\r\n// ==========================================\r\n\r\n/**\r\n * GET request with Next.js caching support\r\n *\r\n * @template T - Expected response data type\r\n * @param endpoint - API endpoint\r\n * @param params - Query parameters\r\n * @param options - Fetch options with cache configuration\r\n * @returns Promise resolving to response data\r\n *\r\n * @example\r\n * ```typescript\r\n * const students = await serverGet<Student[]>('/api/students',\r\n *   { status: 'active' },\r\n *   {\r\n *     cache: 'force-cache',\r\n *     next: { revalidate: 60, tags: ['students'] }\r\n *   }\r\n * );\r\n * ```\r\n */\r\nexport async function serverGet<T>(\r\n  endpoint: string,\r\n  params?: Record<string, string | number | boolean>,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  const queryString = params\r\n    ? '?' + new URLSearchParams(\r\n        Object.entries(params).map(([k, v]) => [k, String(v)])\r\n      ).toString()\r\n    : '';\r\n\r\n  return nextFetch<T>(`${endpoint}${queryString}`, {\r\n    ...options,\r\n    method: 'GET',\r\n  });\r\n}\r\n\r\n/**\r\n * POST request (typically with no-store for mutations)\r\n *\r\n * @template T - Expected response data type\r\n * @param endpoint - API endpoint\r\n * @param data - Request body data\r\n * @param options - Fetch options (defaults to no-store for mutations)\r\n * @returns Promise resolving to response data\r\n *\r\n * @example\r\n * ```typescript\r\n * const newStudent = await serverPost<Student>('/api/students',\r\n *   { name: 'John Doe', grade: '5' },\r\n *   {\r\n *     cache: 'no-store',\r\n *     next: { tags: ['students'] }\r\n *   }\r\n * );\r\n * ```\r\n */\r\nexport async function serverPost<T>(\r\n  endpoint: string,\r\n  data?: unknown,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  return nextFetch<T>(endpoint, {\r\n    ...options,\r\n    method: 'POST',\r\n    body: data ? JSON.stringify(data) : undefined,\r\n    cache: options.cache ?? 'no-store', // Mutations typically no-store\r\n  });\r\n}\r\n\r\n/**\r\n * PUT request (typically with no-store for mutations)\r\n *\r\n * @template T - Expected response data type\r\n * @param endpoint - API endpoint\r\n * @param data - Request body data\r\n * @param options - Fetch options (defaults to no-store for mutations)\r\n * @returns Promise resolving to response data\r\n */\r\nexport async function serverPut<T>(\r\n  endpoint: string,\r\n  data?: unknown,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  return nextFetch<T>(endpoint, {\r\n    ...options,\r\n    method: 'PUT',\r\n    body: data ? JSON.stringify(data) : undefined,\r\n    cache: options.cache ?? 'no-store',\r\n  });\r\n}\r\n\r\n/**\r\n * PATCH request (typically with no-store for mutations)\r\n *\r\n * @template T - Expected response data type\r\n * @param endpoint - API endpoint\r\n * @param data - Request body data\r\n * @param options - Fetch options (defaults to no-store for mutations)\r\n * @returns Promise resolving to response data\r\n */\r\nexport async function serverPatch<T>(\r\n  endpoint: string,\r\n  data?: unknown,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  return nextFetch<T>(endpoint, {\r\n    ...options,\r\n    method: 'PATCH',\r\n    body: data ? JSON.stringify(data) : undefined,\r\n    cache: options.cache ?? 'no-store',\r\n  });\r\n}\r\n\r\n/**\r\n * DELETE request (typically with no-store for mutations)\r\n *\r\n * @template T - Expected response data type\r\n * @param endpoint - API endpoint\r\n * @param options - Fetch options (defaults to no-store for mutations)\r\n * @returns Promise resolving to response data\r\n */\r\nexport async function serverDelete<T>(\r\n  endpoint: string,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  return nextFetch<T>(endpoint, {\r\n    ...options,\r\n    method: 'DELETE',\r\n    cache: options.cache ?? 'no-store',\r\n  });\r\n}\r\n\r\n// ==========================================\r\n// UTILITY FUNCTIONS\r\n// ==========================================\r\n\r\n/**\r\n * Build cache tags for a resource\r\n *\r\n * @param resourceType - Type of resource (e.g., 'students', 'medications')\r\n * @param isPHI - Whether the data contains PHI\r\n * @param additionalTags - Additional tags to include\r\n * @returns Array of cache tags\r\n *\r\n * @example\r\n * ```typescript\r\n * const tags = buildCacheTags('students', true, ['active']);\r\n * // Returns: ['students', 'phi-data', 'active']\r\n * ```\r\n */\r\nexport function buildCacheTags(\r\n  resourceType: string,\r\n  isPHI: boolean = true,\r\n  additionalTags: string[] = []\r\n): string[] {\r\n  const tags: string[] = [resourceType];\r\n\r\n  if (isPHI) {\r\n    tags.push('phi-data');\r\n  }\r\n\r\n  return [...tags, ...additionalTags];\r\n}\r\n\r\n/**\r\n * Build resource-specific cache tag\r\n *\r\n * @param resourceType - Type of resource\r\n * @param resourceId - ID of specific resource\r\n * @returns Cache tag string\r\n *\r\n * @example\r\n * ```typescript\r\n * const tag = buildResourceTag('student', '123');\r\n * // Returns: 'student-123'\r\n * ```\r\n */\r\nexport function buildResourceTag(\r\n  resourceType: string,\r\n  resourceId: string\r\n): string {\r\n  return `${resourceType}-${resourceId}`;\r\n}\r\n\r\n// ==========================================\r\n// LEGACY CLIENT SUPPORT\r\n// ==========================================\r\n\r\n/**\r\n * Simple API client for basic HTTP requests (legacy support)\r\n * \r\n * @deprecated This is a legacy client merged from client.ts. \r\n * For new development, prefer the Next.js-specific methods:\r\n * - serverGet() for GET requests\r\n * - serverPost() for POST requests\r\n * - serverPut() for PUT requests\r\n * - serverPatch() for PATCH requests\r\n * - serverDelete() for DELETE requests\r\n * \r\n * @param endpoint - API endpoint (relative or absolute URL)\r\n * @param options - Basic request options\r\n * @returns Promise resolving to parsed JSON response\r\n * \r\n * @example\r\n * ```typescript\r\n * // Legacy usage (consider migrating to serverGet/serverPost)\r\n * const data = await apiClient('/api/users', {\r\n *   method: 'POST',\r\n *   body: { name: 'John' }\r\n * });\r\n * ```\r\n */\r\nexport async function apiClient(endpoint: string, options: ApiClientOptions = {}) {\r\n  const { method = 'GET', body, headers = {} } = options\r\n\r\n  const config: RequestInit = {\r\n    method,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      ...headers\r\n    }\r\n  }\r\n\r\n  if (body) {\r\n    config.body = JSON.stringify(body)\r\n  }\r\n\r\n  const url = endpoint.startsWith('http') ? endpoint : `${getApiBaseUrl()}${endpoint}`\r\n  const response = await fetch(url, config)\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`API Error: ${response.statusText}`)\r\n  }\r\n\r\n  return response.json()\r\n}\r\n\r\n/**\r\n * Alias for apiClient (legacy support)\r\n * @deprecated Use apiClient directly or migrate to Next.js-specific methods\r\n */\r\nexport const fetchApi = apiClient\r\n\r\n// ==========================================\r\n// EXPORTS\r\n// ==========================================\r\n\r\nconst nextjsClient = {\r\n  nextFetch,\r\n  serverGet,\r\n  serverPost,\r\n  serverPut,\r\n  serverPatch,\r\n  serverDelete,\r\n  buildCacheTags,\r\n  buildResourceTag,\r\n  // Legacy exports\r\n  apiClient,\r\n  fetchApi,\r\n};\r\n\r\nexport default nextjsClient;\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 833, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/schemas/health-record.schemas.ts"],"sourcesContent":["/**\r\n * Health Record Zod schemas for form validation\r\n *\r\n * @module schemas/health-record\r\n * @description Zod schemas for health record management forms\r\n * HIPAA CRITICAL: All health records contain PHI\r\n */\r\n\r\nimport { z } from 'zod';\r\n// import {\r\n//   HealthRecordType\r\n// } from '@/constants/healthRecords';\r\n\r\n/**\r\n * Health record creation schema\r\n */\r\nexport const healthRecordCreateSchema = z.object({\r\n  studentId: z.string().uuid('Invalid student ID'),\r\n  recordType: z.string().min(1, 'Record type is required'),\r\n  title: z.string()\r\n    .min(1, 'Title is required')\r\n    .max(255, 'Title must be less than 255 characters'),\r\n  description: z.string()\r\n    .min(1, 'Description is required')\r\n    .max(5000, 'Description must be less than 5000 characters'),\r\n  recordDate: z.string().refine((date) => {\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid record date'),\r\n  provider: z.string().max(255).optional(),\r\n  providerNpi: z.string()\r\n    .regex(/^\\d{10}$/, 'NPI must be exactly 10 digits')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  facility: z.string().max(255).optional(),\r\n  facilityNpi: z.string()\r\n    .regex(/^\\d{10}$/, 'Facility NPI must be exactly 10 digits')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  diagnosis: z.string().max(1000).optional(),\r\n  diagnosisCode: z.string()\r\n    .regex(/^[A-Z]\\d{2}(\\.\\d{1,4})?$/, 'Invalid ICD-10 code format (e.g., E11.65)')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  treatment: z.string().max(5000).optional(),\r\n  followUpRequired: z.boolean().default(false),\r\n  followUpDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid follow-up date'),\r\n  followUpCompleted: z.boolean().default(false),\r\n  isConfidential: z.boolean().default(false),\r\n  notes: z.string().max(5000).optional(),\r\n  attachments: z.array(z.string()).default([])\r\n}).refine((data) => {\r\n  if (data.followUpRequired && !data.followUpDate) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'Follow-up date is required when follow-up is needed',\r\n  path: ['followUpDate']\r\n});\r\n\r\nexport type HealthRecordCreateFormData = z.infer<typeof healthRecordCreateSchema>;\r\n\r\n/**\r\n * Health record update schema\r\n */\r\nexport const healthRecordUpdateSchema = z.object({\r\n  recordType: z.string().optional(),\r\n  title: z.string()\r\n    .min(1, 'Title is required')\r\n    .max(255, 'Title must be less than 255 characters')\r\n    .optional(),\r\n  description: z.string()\r\n    .min(1, 'Description is required')\r\n    .max(5000, 'Description must be less than 5000 characters')\r\n    .optional(),\r\n  recordDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid record date'),\r\n  provider: z.string().max(255).optional(),\r\n  providerNpi: z.string()\r\n    .regex(/^\\d{10}$/, 'NPI must be exactly 10 digits')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  facility: z.string().max(255).optional(),\r\n  facilityNpi: z.string()\r\n    .regex(/^\\d{10}$/, 'Facility NPI must be exactly 10 digits')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  diagnosis: z.string().max(1000).optional(),\r\n  diagnosisCode: z.string()\r\n    .regex(/^[A-Z]\\d{2}(\\.\\d{1,4})?$/, 'Invalid ICD-10 code format')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  treatment: z.string().max(5000).optional(),\r\n  followUpRequired: z.boolean().optional(),\r\n  followUpDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid follow-up date'),\r\n  followUpCompleted: z.boolean().optional(),\r\n  isConfidential: z.boolean().optional(),\r\n  notes: z.string().max(5000).optional(),\r\n  attachments: z.array(z.string()).optional()\r\n});\r\n\r\nexport type HealthRecordUpdateFormData = z.infer<typeof healthRecordUpdateSchema>;\r\n\r\n/**\r\n * Medical condition creation schema\r\n */\r\nexport const medicalConditionCreateSchema = z.object({\r\n  studentId: z.string().uuid('Invalid student ID'),\r\n  condition: z.string()\r\n    .min(1, 'Condition name is required')\r\n    .max(255, 'Condition name must be less than 255 characters'),\r\n  icdCode: z.string()\r\n    .regex(/^[A-Z]\\d{2}(\\.\\d{1,4})?$/, 'Invalid ICD-10 code format (e.g., E11.65)')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  diagnosisDate: z.string().refine((date) => {\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid diagnosis date'),\r\n  diagnosedBy: z.string().max(255).optional(),\r\n  severity: z.enum(['MILD', 'MODERATE', 'SEVERE', 'CRITICAL'], {\r\n    message: 'Invalid severity level'\r\n  }),\r\n  status: z.enum(['ACTIVE', 'MANAGED', 'RESOLVED', 'MONITORING', 'INACTIVE'], {\r\n    message: 'Invalid status'\r\n  }),\r\n  treatments: z.string().max(2000).optional(),\r\n  accommodationsRequired: z.boolean().default(false),\r\n  accommodationDetails: z.string().max(2000).optional(),\r\n  emergencyProtocol: z.string().max(2000).optional(),\r\n  actionPlan: z.string().max(5000).optional(),\r\n  nextReviewDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid review date'),\r\n  reviewFrequency: z.string().max(100).optional(),\r\n  triggers: z.array(z.string()).default([]),\r\n  notes: z.string().max(5000).optional(),\r\n  carePlan: z.string().max(10000).optional()\r\n}).refine((data) => {\r\n  if (data.accommodationsRequired && !data.accommodationDetails) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'Accommodation details are required when accommodations are needed',\r\n  path: ['accommodationDetails']\r\n});\r\n\r\nexport type MedicalConditionCreateFormData = z.infer<typeof medicalConditionCreateSchema>;\r\n\r\n/**\r\n * Medical condition update schema\r\n */\r\nexport const medicalConditionUpdateSchema = z.object({\r\n  condition: z.string()\r\n    .min(1, 'Condition name is required')\r\n    .max(255, 'Condition name must be less than 255 characters')\r\n    .optional(),\r\n  icdCode: z.string()\r\n    .regex(/^[A-Z]\\d{2}(\\.\\d{1,4})?$/, 'Invalid ICD-10 code format')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  diagnosisDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid diagnosis date'),\r\n  diagnosedBy: z.string().max(255).optional(),\r\n  severity: z.enum(['MILD', 'MODERATE', 'SEVERE', 'CRITICAL']).optional(),\r\n  status: z.enum(['ACTIVE', 'MANAGED', 'RESOLVED', 'MONITORING', 'INACTIVE']).optional(),\r\n  treatments: z.string().max(2000).optional(),\r\n  accommodationsRequired: z.boolean().optional(),\r\n  accommodationDetails: z.string().max(2000).optional(),\r\n  emergencyProtocol: z.string().max(2000).optional(),\r\n  actionPlan: z.string().max(5000).optional(),\r\n  nextReviewDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid review date'),\r\n  reviewFrequency: z.string().max(100).optional(),\r\n  triggers: z.array(z.string()).optional(),\r\n  notes: z.string().max(5000).optional(),\r\n  carePlan: z.string().max(10000).optional(),\r\n  lastReviewDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid last review date')\r\n});\r\n\r\nexport type MedicalConditionUpdateFormData = z.infer<typeof medicalConditionUpdateSchema>;\r\n\r\n/**\r\n * Health record search/filter schema\r\n */\r\nexport const healthRecordSearchSchema = z.object({\r\n  studentId: z.string().uuid().optional(),\r\n  recordType: z.array(z.string()).optional(),\r\n  dateFrom: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid from date'),\r\n  dateTo: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid to date'),\r\n  provider: z.string().optional(),\r\n  isConfidential: z.boolean().optional(),\r\n  followUpRequired: z.boolean().optional(),\r\n  page: z.number().int().positive().default(1),\r\n  limit: z.number().int().positive().max(100).default(20),\r\n  sortBy: z.enum(['recordDate', 'title', 'provider', 'recordType']).default('recordDate'),\r\n  sortDirection: z.enum(['asc', 'desc']).default('desc')\r\n});\r\n\r\nexport type HealthRecordSearchFormData = z.infer<typeof healthRecordSearchSchema>;\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1043, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/audit.ts"],"sourcesContent":["/**\r\n * HIPAA-compliant audit logging utilities\r\n * Tracks all PHI access and modifications for compliance\r\n */\r\n\r\nconst BACKEND_URL = process.env.BACKEND_URL || 'http://localhost:3001';\r\n\r\n/**\r\n * Audit log entry interface\r\n */\r\nexport interface AuditLogEntry {\r\n  userId?: string | null;\r\n  action: string;\r\n  resource: string;\r\n  resourceId?: string;\r\n  details?: string;\r\n  ipAddress?: string;\r\n  userAgent?: string;\r\n  success?: boolean;\r\n  errorMessage?: string;\r\n  changes?: Record<string, unknown>;\r\n}\r\n\r\n/**\r\n * Log audit event to backend\r\n * HIPAA Requirement: All PHI access must be logged\r\n */\r\nexport async function auditLog(entry: AuditLogEntry): Promise<void> {\r\n  try {\r\n    // Send audit log to backend service\r\n    await fetch(`${BACKEND_URL}/audit/log`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        userId: entry.userId,\r\n        action: entry.action,\r\n        entityType: entry.resource,\r\n        entityId: entry.resourceId,\r\n        changes: entry.changes || {\r\n          details: entry.details,\r\n          success: entry.success !== undefined ? entry.success : true,\r\n          errorMessage: entry.errorMessage\r\n        },\r\n        ipAddress: entry.ipAddress,\r\n        userAgent: entry.userAgent\r\n      })\r\n    });\r\n  } catch (error) {\r\n    // Audit logging should never break the main flow\r\n    // Log to console for debugging but don't throw\r\n    console.error('Audit log failed:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * PHI access actions\r\n */\r\nexport const PHI_ACTIONS = {\r\n  VIEW: 'VIEW_PHI',\r\n  CREATE: 'CREATE_PHI',\r\n  UPDATE: 'UPDATE_PHI',\r\n  DELETE: 'DELETE_PHI',\r\n  EXPORT: 'EXPORT_PHI',\r\n  PRINT: 'PRINT_PHI'\r\n} as const;\r\n\r\n/**\r\n * Log PHI access\r\n * HIPAA Critical: All Protected Health Information access must be audited\r\n */\r\nexport async function logPHIAccess(entry: Omit<AuditLogEntry, 'action'> & { action: keyof typeof PHI_ACTIONS }): Promise<void> {\r\n  await auditLog({\r\n    ...entry,\r\n    action: PHI_ACTIONS[entry.action]\r\n  });\r\n}\r\n\r\n/**\r\n * Common audit actions\r\n */\r\nexport const AUDIT_ACTIONS = {\r\n  // Authentication\r\n  LOGIN: 'USER_LOGIN',\r\n  LOGOUT: 'USER_LOGOUT',\r\n  LOGIN_FAILED: 'LOGIN_FAILED',\r\n  TOKEN_REFRESH: 'TOKEN_REFRESH',\r\n  PASSWORD_CHANGE: 'PASSWORD_CHANGE',\r\n\r\n  // Students\r\n  VIEW_STUDENT: 'VIEW_STUDENT',\r\n  CREATE_STUDENT: 'CREATE_STUDENT',\r\n  UPDATE_STUDENT: 'UPDATE_STUDENT',\r\n  DELETE_STUDENT: 'DELETE_STUDENT',\r\n  LIST_STUDENTS: 'LIST_STUDENTS',\r\n\r\n  // Health Records\r\n  VIEW_HEALTH_RECORD: 'VIEW_HEALTH_RECORD',\r\n  CREATE_HEALTH_RECORD: 'CREATE_HEALTH_RECORD',\r\n  UPDATE_HEALTH_RECORD: 'UPDATE_HEALTH_RECORD',\r\n  DELETE_HEALTH_RECORD: 'DELETE_HEALTH_RECORD',\r\n\r\n  // Medications\r\n  VIEW_MEDICATION: 'VIEW_MEDICATION',\r\n  CREATE_MEDICATION: 'CREATE_MEDICATION',\r\n  UPDATE_MEDICATION: 'UPDATE_MEDICATION',\r\n  DELETE_MEDICATION: 'DELETE_MEDICATION',\r\n  ADMINISTER_MEDICATION: 'ADMINISTER_MEDICATION',\r\n\r\n  // Appointments\r\n  VIEW_APPOINTMENT: 'VIEW_APPOINTMENT',\r\n  LIST_APPOINTMENTS: 'LIST_APPOINTMENTS',\r\n  CREATE_APPOINTMENT: 'CREATE_APPOINTMENT',\r\n  UPDATE_APPOINTMENT: 'UPDATE_APPOINTMENT',\r\n  DELETE_APPOINTMENT: 'DELETE_APPOINTMENT',\r\n  RESCHEDULE_APPOINTMENT: 'RESCHEDULE_APPOINTMENT',\r\n  CANCEL_APPOINTMENT: 'CANCEL_APPOINTMENT',\r\n  COMPLETE_APPOINTMENT: 'COMPLETE_APPOINTMENT',\r\n  CONFIRM_APPOINTMENT: 'CONFIRM_APPOINTMENT',\r\n  NO_SHOW_APPOINTMENT: 'NO_SHOW_APPOINTMENT',\r\n  SEND_APPOINTMENT_REMINDER: 'SEND_APPOINTMENT_REMINDER',\r\n\r\n  // Incidents\r\n  VIEW_INCIDENT: 'VIEW_INCIDENT',\r\n  CREATE_INCIDENT: 'CREATE_INCIDENT',\r\n  UPDATE_INCIDENT: 'UPDATE_INCIDENT',\r\n  DELETE_INCIDENT: 'DELETE_INCIDENT',\r\n\r\n  // Documents\r\n  VIEW_DOCUMENT: 'VIEW_DOCUMENT',\r\n  UPLOAD_DOCUMENT: 'UPLOAD_DOCUMENT',\r\n  DOWNLOAD_DOCUMENT: 'DOWNLOAD_DOCUMENT',\r\n  DELETE_DOCUMENT: 'DELETE_DOCUMENT',\r\n  CREATE_DOCUMENT: 'CREATE_DOCUMENT',\r\n  UPDATE_DOCUMENT: 'UPDATE_DOCUMENT',\r\n  SIGN_DOCUMENT: 'SIGN_DOCUMENT',\r\n  SHARE_DOCUMENT: 'SHARE_DOCUMENT',\r\n\r\n  // PHI Records\r\n  CREATE_PHI_RECORD: 'CREATE_PHI_RECORD',\r\n  ACCESS_PHI_RECORD: 'ACCESS_PHI_RECORD',\r\n\r\n  // User Management\r\n  CREATE_USER: 'CREATE_USER',\r\n  UPDATE_USER: 'UPDATE_USER',\r\n  DELETE_USER: 'DELETE_USER',\r\n\r\n  // Organization Management\r\n  CREATE_ORGANIZATION: 'CREATE_ORGANIZATION',\r\n  UPDATE_ORGANIZATION: 'UPDATE_ORGANIZATION',\r\n\r\n  // Configuration\r\n  UPDATE_CONFIGURATION: 'UPDATE_CONFIGURATION',\r\n\r\n  // Reports\r\n  GENERATE_REPORT: 'GENERATE_REPORT',\r\n  EXPORT_DATA: 'EXPORT_DATA'\r\n} as const;\r\n\r\n/**\r\n * Extract IP address from request or headers\r\n */\r\nexport function extractIPAddress(request: Request | { get(name: string): string | null }): string | undefined {\r\n  // Check various headers for IP address\r\n  const headersList = [\r\n    'x-forwarded-for',\r\n    'x-real-ip',\r\n    'cf-connecting-ip'\r\n  ];\r\n\r\n  const headers = 'headers' in request ? request.headers : request;\r\n\r\n  for (const header of headersList) {\r\n    const value = headers.get(header);\r\n    if (value) {\r\n      // x-forwarded-for can contain multiple IPs, take the first one\r\n      return value.split(',')[0].trim();\r\n    }\r\n  }\r\n\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * Extract user agent from request or headers\r\n */\r\nexport function extractUserAgent(request: Request | { get(name: string): string | null }): string | undefined {\r\n  const headers = 'headers' in request ? request.headers : request;\r\n  return headers.get('user-agent') || undefined;\r\n}\r\n\r\n/**\r\n * Create audit context from request\r\n */\r\nexport function createAuditContext(request: Request, userId?: string) {\r\n  return {\r\n    userId,\r\n    ipAddress: extractIPAddress(request),\r\n    userAgent: extractUserAgent(request)\r\n  };\r\n}\r\n\r\n/**\r\n * Get client IP from Next.js server context\r\n *\r\n * Works in server actions and components.\r\n *\r\n * @returns Client IP address\r\n *\r\n * @example\r\n * ```typescript\r\n * 'use server'\r\n *\r\n * export async function myAction() {\r\n *   const ip = await getClientIP();\r\n *   await auditLog({ ipAddress: ip, ... });\r\n * }\r\n * ```\r\n */\r\nexport async function getClientIP(): Promise<string | undefined> {\r\n  try {\r\n    const { headers } = await import('next/headers');\r\n    const headersList = await headers();\r\n\r\n    // Check common headers for IP\r\n    const ipHeaders = [\r\n      'x-forwarded-for',\r\n      'x-real-ip',\r\n      'cf-connecting-ip',\r\n      'x-client-ip',\r\n      'x-cluster-client-ip'\r\n    ];\r\n\r\n    for (const header of ipHeaders) {\r\n      const value = headersList.get(header);\r\n      if (value) {\r\n        // x-forwarded-for can contain multiple IPs, take the first one\r\n        return value.split(',')[0].trim();\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  } catch (error) {\r\n    // headers() might not be available in all contexts\r\n    return undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Get user agent from Next.js server context\r\n *\r\n * Works in server actions and components.\r\n *\r\n * @returns User agent string\r\n */\r\nexport async function getUserAgent(): Promise<string | undefined> {\r\n  try {\r\n    const { headers } = await import('next/headers');\r\n    const headersList = await headers();\r\n    return headersList.get('user-agent') || undefined;\r\n  } catch (error) {\r\n    // headers() might not be available in all contexts\r\n    return undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Create audit context from Next.js server context\r\n *\r\n * Works in server actions and server components.\r\n *\r\n * @param userId - Optional user ID\r\n * @returns Audit context\r\n *\r\n * @example\r\n * ```typescript\r\n * 'use server'\r\n *\r\n * export async function updateProfile(data: FormData) {\r\n *   const session = await getServerSession();\r\n *   const context = await createAuditContextFromServer(session?.user.id);\r\n *\r\n *   await auditLog({\r\n *     ...context,\r\n *     action: AUDIT_ACTIONS.UPDATE_PROFILE,\r\n *     resource: 'profile',\r\n *     resourceId: session?.user.id\r\n *   });\r\n * }\r\n * ```\r\n */\r\nexport async function createAuditContextFromServer(userId?: string | null) {\r\n  return {\r\n    userId,\r\n    ipAddress: await getClientIP(),\r\n    userAgent: await getUserAgent()\r\n  };\r\n}\r\n\r\n/**\r\n * Log audit event with automatic context detection\r\n *\r\n * Automatically detects IP and user agent from server context.\r\n *\r\n * @param entry - Audit log entry\r\n *\r\n * @example\r\n * ```typescript\r\n * 'use server'\r\n *\r\n * export async function deleteStudent(id: string) {\r\n *   const user = await getServerAuth();\r\n *\r\n *   await auditLogWithContext({\r\n *     userId: user.id,\r\n *     action: AUDIT_ACTIONS.DELETE_STUDENT,\r\n *     resource: 'student',\r\n *     resourceId: id\r\n *   });\r\n * }\r\n * ```\r\n */\r\nexport async function auditLogWithContext(\r\n  entry: Omit<AuditLogEntry, 'ipAddress' | 'userAgent'>\r\n): Promise<void> {\r\n  const context = await createAuditContextFromServer(entry.userId);\r\n\r\n  await auditLog({\r\n    ...entry,\r\n    ipAddress: context.ipAddress,\r\n    userAgent: context.userAgent\r\n  });\r\n}\r\n\r\n/**\r\n * Parse user agent string\r\n *\r\n * Extracts browser, OS, and device information from user agent.\r\n *\r\n * @param userAgent - User agent string\r\n * @returns Parsed user agent info\r\n */\r\nexport function parseUserAgent(userAgent: string): {\r\n  browser: string;\r\n  os: string;\r\n  device: string;\r\n} {\r\n  const ua = userAgent.toLowerCase();\r\n\r\n  // Detect browser\r\n  let browser = 'Unknown';\r\n  if (ua.includes('chrome')) browser = 'Chrome';\r\n  else if (ua.includes('firefox')) browser = 'Firefox';\r\n  else if (ua.includes('safari')) browser = 'Safari';\r\n  else if (ua.includes('edge')) browser = 'Edge';\r\n  else if (ua.includes('opera')) browser = 'Opera';\r\n\r\n  // Detect OS\r\n  let os = 'Unknown';\r\n  if (ua.includes('windows')) os = 'Windows';\r\n  else if (ua.includes('mac')) os = 'macOS';\r\n  else if (ua.includes('linux')) os = 'Linux';\r\n  else if (ua.includes('android')) os = 'Android';\r\n  else if (ua.includes('ios') || ua.includes('iphone') || ua.includes('ipad')) os = 'iOS';\r\n\r\n  // Detect device\r\n  let device = 'Desktop';\r\n  if (ua.includes('mobile') || ua.includes('android')) device = 'Mobile';\r\n  else if (ua.includes('tablet') || ua.includes('ipad')) device = 'Tablet';\r\n\r\n  return { browser, os, device };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1289, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/health-records.utils.ts"],"sourcesContent":["/**\r\n * @fileoverview Utility Functions for Health Records Module\r\n * @module lib/actions/health-records.utils\r\n *\r\n * Shared utility functions for authentication, audit context creation,\r\n * and enhanced fetch operations with Next.js v16 caching capabilities.\r\n * HIPAA CRITICAL: These utilities support mandatory audit logging for PHI access.\r\n *\r\n * NOTE: This file does NOT use 'use server' because it exports constants\r\n * and utility functions that can be used in both server and client contexts.\r\n * Individual async functions can be imported and used in server actions.\r\n */\r\n\r\nimport { cookies } from 'next/headers';\r\nimport { headers } from 'next/headers';\r\nimport {\r\n  extractIPAddress,\r\n  extractUserAgent\r\n} from '@/lib/audit';\r\n\r\n/**\r\n * Backend API base URL\r\n * Uses server-side env variable or falls back to public env or default\r\n */\r\nexport const BACKEND_URL = process.env.API_BASE_URL || process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001';\r\n\r\n/**\r\n * Get authentication token from cookies\r\n * Used by all server actions to authenticate API requests\r\n *\r\n * @returns Promise resolving to auth token string or null if not authenticated\r\n *\r\n * @example\r\n * ```typescript\r\n * const token = await getAuthToken();\r\n * if (!token) {\r\n *   return { errors: { _form: ['Authentication required'] } };\r\n * }\r\n * ```\r\n */\r\nexport async function getAuthToken(): Promise<string | null> {\r\n  const cookieStore = await cookies();\r\n  return cookieStore.get('auth_token')?.value || null;\r\n}\r\n\r\n/**\r\n * Get current user ID from cookies\r\n * Used for audit logging to track which user performed an action\r\n *\r\n * @returns Promise resolving to user ID string or null if not available\r\n *\r\n * @example\r\n * ```typescript\r\n * const userId = await getCurrentUserId();\r\n * await auditLog({ userId, action: 'VIEW_RECORD', ... });\r\n * ```\r\n */\r\nexport async function getCurrentUserId(): Promise<string | null> {\r\n  const cookieStore = await cookies();\r\n  return cookieStore.get('user_id')?.value || null;\r\n}\r\n\r\n/**\r\n * Create audit context from request headers\r\n * HIPAA CRITICAL: Captures IP address and user agent for all PHI access logs\r\n *\r\n * @returns Promise resolving to audit context with userId, ipAddress, and userAgent\r\n *\r\n * @example\r\n * ```typescript\r\n * const auditContext = await createAuditContext();\r\n * await auditLog({\r\n *   ...auditContext,\r\n *   action: AUDIT_ACTIONS.VIEW_HEALTH_RECORD,\r\n *   resource: 'HealthRecord',\r\n *   success: true\r\n * });\r\n * ```\r\n */\r\nexport async function createAuditContext() {\r\n  const headersList = await headers();\r\n  const request = {\r\n    headers: headersList\r\n  } as Request;\r\n\r\n  const userId = await getCurrentUserId();\r\n  return {\r\n    userId,\r\n    ipAddress: extractIPAddress(request),\r\n    userAgent: extractUserAgent(request)\r\n  };\r\n}\r\n\r\n/**\r\n * Enhanced fetch with Next.js v16 capabilities\r\n * Automatically adds authentication headers and caching tags for PHI data\r\n *\r\n * @param url - Full URL to fetch\r\n * @param options - Standard fetch options (method, body, headers, etc.)\r\n * @returns Promise resolving to Response object\r\n *\r\n * @example\r\n * ```typescript\r\n * const response = await enhancedFetch(`${BACKEND_URL}/health-record`, {\r\n *   method: 'POST',\r\n *   body: JSON.stringify(data)\r\n * });\r\n * ```\r\n */\r\nexport async function enhancedFetch(url: string, options: RequestInit = {}) {\r\n  const token = await getAuthToken();\r\n\r\n  return fetch(url, {\r\n    ...options,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': token ? `Bearer ${token}` : '',\r\n      ...options.headers,\r\n    },\r\n    next: {\r\n      revalidate: 300, // 5 minute cache\r\n      tags: ['health-records', 'phi-data']\r\n    }\r\n  });\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;CAWC;;;;;;;;;;;;AAED;AAEA;;;;AASO,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY,iEAAuC;AAgBnF,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,OAAO,YAAY,GAAG,CAAC,eAAe,SAAS;AACjD;AAcO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,OAAO,YAAY,GAAG,CAAC,YAAY,SAAS;AAC9C;AAmBO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,UAAU;QACd,SAAS;IACX;IAEA,MAAM,SAAS,MAAM;IACrB,OAAO;QACL;QACA,WAAW,IAAA,uIAAgB,EAAC;QAC5B,WAAW,IAAA,uIAAgB,EAAC;IAC9B;AACF;AAkBO,eAAe,cAAc,GAAW,EAAE,UAAuB,CAAC,CAAC;IACxE,MAAM,QAAQ,MAAM;IAEpB,OAAO,MAAM,KAAK;QAChB,GAAG,OAAO;QACV,SAAS;YACP,gBAAgB;YAChB,iBAAiB,QAAQ,CAAC,OAAO,EAAE,OAAO,GAAG;YAC7C,GAAG,QAAQ,OAAO;QACpB;QACA,MAAM;YACJ,YAAY;YACZ,MAAM;gBAAC;gBAAkB;aAAW;QACtC;IACF;AACF","debugId":null}},
    {"offset": {"line": 1360, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/health-records.crud.ts"],"sourcesContent":["/**\r\n * @fileoverview CRUD Operations for Health Records\r\n * @module lib/actions/health-records.crud\r\n *\r\n * Core create, read, update, and delete operations for health records.\r\n * HIPAA CRITICAL: ALL operations include mandatory audit logging for PHI access.\r\n * Enhanced with Next.js v16 caching capabilities and revalidation patterns.\r\n */\r\n\r\n'use server';\r\n\r\nimport { revalidatePath, revalidateTag } from 'next/cache';\r\nimport { z, type ZodIssue } from 'zod';\r\nimport { serverGet } from '@/lib/api/nextjs-client';\r\nimport type { ApiResponse } from '@/types';\r\n\r\n// Import schemas\r\nimport {\r\n  healthRecordCreateSchema,\r\n  healthRecordUpdateSchema\r\n} from '@/schemas/health-record.schemas';\r\n\r\n// Import audit logging utilities\r\nimport {\r\n  auditLog,\r\n  AUDIT_ACTIONS\r\n} from '@/lib/audit';\r\n\r\n// Import shared utilities and types\r\nimport {\r\n  getAuthToken,\r\n  createAuditContext,\r\n  enhancedFetch,\r\n  BACKEND_URL\r\n} from './health-records.utils';\r\nimport type { ActionResult } from './health-records.types';\r\n\r\n/**\r\n * Create a new health record with HIPAA audit logging\r\n * Enhanced with Next.js v16 caching and validation\r\n *\r\n * @param prevState - Previous action state (for useActionState hook)\r\n * @param formData - Form data containing health record fields\r\n * @returns ActionResult with created record data or validation errors\r\n *\r\n * @example\r\n * ```typescript\r\n * 'use client';\r\n * import { useActionState } from 'react';\r\n * import { createHealthRecordAction } from '@/lib/actions/health-records.actions';\r\n *\r\n * function HealthRecordForm() {\r\n *   const [state, formAction, isPending] = useActionState(createHealthRecordAction, { errors: {} });\r\n *   return <form action={formAction}>...</form>;\r\n * }\r\n * ```\r\n */\r\nexport async function createHealthRecordAction(\r\n  _prevState: ActionResult,\r\n  formData: FormData\r\n): Promise<ActionResult> {\r\n  const token = await getAuthToken();\r\n  const auditContext = await createAuditContext();\r\n\r\n  if (!token) {\r\n    return {\r\n      errors: {\r\n        _form: ['Authentication required']\r\n      }\r\n    };\r\n  }\r\n\r\n  try {\r\n    // Parse and validate form data\r\n    const rawData = {\r\n      studentId: formData.get('studentId'),\r\n      recordType: formData.get('recordType'),\r\n      title: formData.get('title'),\r\n      description: formData.get('description'),\r\n      recordDate: formData.get('recordDate'),\r\n      provider: formData.get('provider') || undefined,\r\n      providerNpi: formData.get('providerNpi') || '',\r\n      facility: formData.get('facility') || undefined,\r\n      facilityNpi: formData.get('facilityNpi') || '',\r\n      diagnosis: formData.get('diagnosis') || undefined,\r\n      diagnosisCode: formData.get('diagnosisCode') || '',\r\n      treatment: formData.get('treatment') || undefined,\r\n      followUpRequired: formData.get('followUpRequired') === 'true',\r\n      followUpDate: formData.get('followUpDate') || undefined,\r\n      followUpCompleted: formData.get('followUpCompleted') === 'true',\r\n      isConfidential: formData.get('isConfidential') === 'true',\r\n      notes: formData.get('notes') || undefined,\r\n      attachments: []\r\n    };\r\n\r\n    const validatedData = healthRecordCreateSchema.parse(rawData);\r\n\r\n    // Create health record via backend API with enhanced fetch (backend uses /health-record singular)\r\n    const response = await enhancedFetch(`${BACKEND_URL}/health-record`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(validatedData)\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      throw new Error(error.message || 'Failed to create health record');\r\n    }\r\n\r\n    const result = await response.json();\r\n\r\n    // HIPAA AUDIT LOG - Mandatory for PHI creation\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.CREATE_HEALTH_RECORD,\r\n      resource: 'HealthRecord',\r\n      resourceId: result.data.id,\r\n      details: `Created ${validatedData.recordType} health record for student ${validatedData.studentId}`,\r\n      success: true\r\n    });\r\n\r\n    // Enhanced cache invalidation with Next.js v16\r\n    revalidateTag('health-records', 'default');\r\n    revalidateTag(`student-${validatedData.studentId}-health-records`, 'default');\r\n    revalidateTag('phi-data', 'default');\r\n    revalidatePath(`/students/${validatedData.studentId}/health-records`);\r\n    revalidatePath('/health-records');\r\n\r\n    return {\r\n      success: true,\r\n      data: result.data,\r\n      message: 'Health record created successfully'\r\n    };\r\n  } catch (error) {\r\n    if (error instanceof z.ZodError) {\r\n      const fieldErrors: Record<string, string[]> = {};\r\n      error.issues.forEach((err: ZodIssue) => {\r\n        const path = err.path.join('.');\r\n        if (!fieldErrors[path]) {\r\n          fieldErrors[path] = [];\r\n        }\r\n        fieldErrors[path].push(err.message);\r\n      });\r\n\r\n      return {\r\n        errors: fieldErrors\r\n      };\r\n    }\r\n\r\n    // HIPAA AUDIT LOG - Log failed attempt\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.CREATE_HEALTH_RECORD,\r\n      resource: 'HealthRecord',\r\n      details: 'Failed to create health record',\r\n      success: false,\r\n      errorMessage: error instanceof Error ? error.message : 'Unknown error'\r\n    });\r\n\r\n    return {\r\n      errors: {\r\n        _form: [error instanceof Error ? error.message : 'Failed to create health record']\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get health records with enhanced caching\r\n *\r\n * @param studentId - Optional student ID to filter records\r\n * @param recordType - Optional record type to filter\r\n * @returns ActionResult with array of health records or error\r\n *\r\n * @example\r\n * ```typescript\r\n * // Get all records for a student\r\n * const result = await getHealthRecordsAction('student-123');\r\n *\r\n * // Get specific record type for a student\r\n * const immunizations = await getHealthRecordsAction('student-123', 'IMMUNIZATION');\r\n *\r\n * // Get all records across all students\r\n * const allRecords = await getHealthRecordsAction();\r\n * ```\r\n */\r\nexport async function getHealthRecordsAction(studentId?: string, recordType?: string) {\r\n  try {\r\n    // Build endpoint and params based on whether studentId is provided\r\n    let endpoint: string;\r\n    const params: Record<string, string> = {};\r\n\r\n    if (studentId) {\r\n      // Get records for a specific student\r\n      endpoint = `/health-record/student/${studentId}`;\r\n      if (recordType) {\r\n        params.recordType = recordType;\r\n      }\r\n    } else {\r\n      // Get all health records across all students\r\n      endpoint = '/health-record';\r\n      if (recordType) {\r\n        params.type = recordType;\r\n      }\r\n    }\r\n\r\n    console.log('[Health Records] Fetching from:', endpoint, params);\r\n\r\n    const wrappedResponse = await serverGet<ApiResponse<{ data: unknown[] }>>(\r\n      endpoint,\r\n      params,\r\n      {\r\n        cache: 'no-store', // Fresh data for health records\r\n      }\r\n    );\r\n\r\n    console.log('[Health Records] Response structure:', {\r\n      hasData: !!wrappedResponse.data,\r\n      dataType: typeof wrappedResponse.data,\r\n      isArray: Array.isArray(wrappedResponse.data)\r\n    });\r\n\r\n    // HIPAA AUDIT LOG - PHI access\r\n    const auditContext = await createAuditContext();\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.VIEW_HEALTH_RECORD,\r\n      resource: 'HealthRecord',\r\n      details: `Accessed health records for student ${studentId}`,\r\n      success: true\r\n    });\r\n\r\n    // Backend wraps response in ApiResponse format: { success, statusCode, data: {...} }\r\n    // The actual health records might be in wrappedResponse.data.data or wrappedResponse.data\r\n    let healthRecords: unknown[] = [];\r\n\r\n    if (wrappedResponse.data) {\r\n      // If wrappedResponse.data is an array, use it directly\r\n      if (Array.isArray(wrappedResponse.data)) {\r\n        healthRecords = wrappedResponse.data;\r\n      }\r\n      // If wrappedResponse.data has a data property (double-wrapped), extract it\r\n      else if (typeof wrappedResponse.data === 'object' && 'data' in wrappedResponse.data) {\r\n        const nested = wrappedResponse.data as { data?: unknown[] };\r\n        if (nested.data && Array.isArray(nested.data)) {\r\n          healthRecords = nested.data;\r\n        }\r\n      }\r\n      // If wrappedResponse.data is an object with records property\r\n      else if (typeof wrappedResponse.data === 'object' && 'records' in wrappedResponse.data) {\r\n        const nested = wrappedResponse.data as { records?: unknown[] };\r\n        if (nested.records && Array.isArray(nested.records)) {\r\n          healthRecords = nested.records;\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log('[Health Records] Successfully fetched records:', healthRecords.length);\r\n\r\n    return {\r\n      success: true,\r\n      data: healthRecords\r\n    };\r\n  } catch (error) {\r\n    const errorMessage = error instanceof Error ? error.message : 'Failed to fetch health records';\r\n    console.error('[Health Records] Error in getHealthRecordsAction:', errorMessage);\r\n\r\n    // Check if it's a network/connection error\r\n    if (error instanceof TypeError && error.message.includes('fetch')) {\r\n      return {\r\n        success: false,\r\n        error: `Cannot connect to backend server at ${BACKEND_URL}. Please ensure the backend is running.`\r\n      };\r\n    }\r\n\r\n    return {\r\n      success: false,\r\n      error: errorMessage\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Update health record with HIPAA audit logging\r\n *\r\n * @param id - Health record ID to update\r\n * @param prevState - Previous action state (for useActionState hook)\r\n * @param formData - Form data containing updated fields\r\n * @returns ActionResult with updated record data or validation errors\r\n *\r\n * @example\r\n * ```typescript\r\n * const [state, formAction] = useActionState(\r\n *   (prev, data) => updateHealthRecordAction('record-123', prev, data),\r\n *   { errors: {} }\r\n * );\r\n * ```\r\n */\r\nexport async function updateHealthRecordAction(\r\n  id: string,\r\n  _prevState: ActionResult,\r\n  formData: FormData\r\n): Promise<ActionResult> {\r\n  const token = await getAuthToken();\r\n  const auditContext = await createAuditContext();\r\n\r\n  if (!token) {\r\n    return {\r\n      errors: {\r\n        _form: ['Authentication required']\r\n      }\r\n    };\r\n  }\r\n\r\n  try {\r\n    const rawData = {\r\n      recordType: formData.get('recordType') || undefined,\r\n      title: formData.get('title') || undefined,\r\n      description: formData.get('description') || undefined,\r\n      recordDate: formData.get('recordDate') || undefined,\r\n      provider: formData.get('provider') || undefined,\r\n      providerNpi: formData.get('providerNpi') || '',\r\n      facility: formData.get('facility') || undefined,\r\n      facilityNpi: formData.get('facilityNpi') || '',\r\n      diagnosis: formData.get('diagnosis') || undefined,\r\n      diagnosisCode: formData.get('diagnosisCode') || '',\r\n      treatment: formData.get('treatment') || undefined,\r\n      followUpRequired: formData.get('followUpRequired') ? formData.get('followUpRequired') === 'true' : undefined,\r\n      followUpDate: formData.get('followUpDate') || undefined,\r\n      followUpCompleted: formData.get('followUpCompleted') ? formData.get('followUpCompleted') === 'true' : undefined,\r\n      isConfidential: formData.get('isConfidential') ? formData.get('isConfidential') === 'true' : undefined,\r\n      notes: formData.get('notes') || undefined\r\n    };\r\n\r\n    const validatedData = healthRecordUpdateSchema.parse(rawData);\r\n\r\n    const response = await enhancedFetch(`${BACKEND_URL}/health-record/${id}`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(validatedData)\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      throw new Error(error.message || 'Failed to update health record');\r\n    }\r\n\r\n    const result = await response.json();\r\n\r\n    // HIPAA AUDIT LOG - Mandatory for PHI modification\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.UPDATE_HEALTH_RECORD,\r\n      resource: 'HealthRecord',\r\n      resourceId: id,\r\n      details: `Updated health record ${id}`,\r\n      changes: validatedData,\r\n      success: true\r\n    });\r\n\r\n    // Enhanced cache invalidation\r\n    revalidateTag('health-records', 'default');\r\n    revalidateTag(`health-record-${id}`, 'default');\r\n    revalidateTag('phi-data', 'default');\r\n    revalidatePath(`/health-records/${id}`);\r\n    revalidatePath('/health-records');\r\n\r\n    return {\r\n      success: true,\r\n      data: result.data,\r\n      message: 'Health record updated successfully'\r\n    };\r\n  } catch (error) {\r\n    if (error instanceof z.ZodError) {\r\n      const fieldErrors: Record<string, string[]> = {};\r\n      error.issues.forEach((err: ZodIssue) => {\r\n        const path = err.path.join('.');\r\n        if (!fieldErrors[path]) {\r\n          fieldErrors[path] = [];\r\n        }\r\n        fieldErrors[path].push(err.message);\r\n      });\r\n\r\n      return {\r\n        errors: fieldErrors\r\n      };\r\n    }\r\n\r\n    // HIPAA AUDIT LOG - Log failed update attempt\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.UPDATE_HEALTH_RECORD,\r\n      resource: 'HealthRecord',\r\n      resourceId: id,\r\n      details: `Failed to update health record ${id}`,\r\n      success: false,\r\n      errorMessage: error instanceof Error ? error.message : 'Unknown error'\r\n    });\r\n\r\n    return {\r\n      errors: {\r\n        _form: [error instanceof Error ? error.message : 'Failed to update health record']\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete health record with HIPAA audit logging\r\n *\r\n * @param id - Health record ID to delete\r\n * @returns ActionResult with success status or error\r\n *\r\n * @example\r\n * ```typescript\r\n * const result = await deleteHealthRecordAction('record-123');\r\n * if (result.success) {\r\n *   console.log('Record deleted successfully');\r\n * }\r\n * ```\r\n */\r\nexport async function deleteHealthRecordAction(id: string): Promise<ActionResult> {\r\n  const token = await getAuthToken();\r\n  const auditContext = await createAuditContext();\r\n\r\n  if (!token) {\r\n    return {\r\n      errors: {\r\n        _form: ['Authentication required']\r\n      }\r\n    };\r\n  }\r\n\r\n  try {\r\n    const response = await enhancedFetch(`${BACKEND_URL}/health-record/${id}`, {\r\n      method: 'DELETE'\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      throw new Error(error.message || 'Failed to delete health record');\r\n    }\r\n\r\n    // HIPAA AUDIT LOG - Mandatory for PHI deletion\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.DELETE_HEALTH_RECORD,\r\n      resource: 'HealthRecord',\r\n      resourceId: id,\r\n      details: `Deleted health record ${id}`,\r\n      success: true\r\n    });\r\n\r\n    // Enhanced cache invalidation\r\n    revalidateTag('health-records', 'default');\r\n    revalidateTag(`health-record-${id}`, 'default');\r\n    revalidateTag('phi-data', 'default');\r\n    revalidatePath('/health-records');\r\n\r\n    return {\r\n      success: true,\r\n      message: 'Health record deleted successfully'\r\n    };\r\n  } catch (error) {\r\n    // HIPAA AUDIT LOG - Log failed delete attempt\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.DELETE_HEALTH_RECORD,\r\n      resource: 'HealthRecord',\r\n      resourceId: id,\r\n      details: `Failed to delete health record ${id}`,\r\n      success: false,\r\n      errorMessage: error instanceof Error ? error.message : 'Unknown error'\r\n    });\r\n\r\n    return {\r\n      errors: {\r\n        _form: [error instanceof Error ? error.message : 'Failed to delete health record']\r\n      }\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;CAOC;;;;;;;;;;;AAID;AACA;AACA;AAGA,iBAAiB;AACjB;AAKA,iCAAiC;AACjC;AAKA,oCAAoC;AACpC;;;;;;;;;AA4BO,eAAe,yBACpB,UAAwB,EACxB,QAAkB;IAElB,MAAM,QAAQ,MAAM,IAAA,mKAAY;IAChC,MAAM,eAAe,MAAM,IAAA,yKAAkB;IAE7C,IAAI,CAAC,OAAO;QACV,OAAO;YACL,QAAQ;gBACN,OAAO;oBAAC;iBAA0B;YACpC;QACF;IACF;IAEA,IAAI;QACF,+BAA+B;QAC/B,MAAM,UAAU;YACd,WAAW,SAAS,GAAG,CAAC;YACxB,YAAY,SAAS,GAAG,CAAC;YACzB,OAAO,SAAS,GAAG,CAAC;YACpB,aAAa,SAAS,GAAG,CAAC;YAC1B,YAAY,SAAS,GAAG,CAAC;YACzB,UAAU,SAAS,GAAG,CAAC,eAAe;YACtC,aAAa,SAAS,GAAG,CAAC,kBAAkB;YAC5C,UAAU,SAAS,GAAG,CAAC,eAAe;YACtC,aAAa,SAAS,GAAG,CAAC,kBAAkB;YAC5C,WAAW,SAAS,GAAG,CAAC,gBAAgB;YACxC,eAAe,SAAS,GAAG,CAAC,oBAAoB;YAChD,WAAW,SAAS,GAAG,CAAC,gBAAgB;YACxC,kBAAkB,SAAS,GAAG,CAAC,wBAAwB;YACvD,cAAc,SAAS,GAAG,CAAC,mBAAmB;YAC9C,mBAAmB,SAAS,GAAG,CAAC,yBAAyB;YACzD,gBAAgB,SAAS,GAAG,CAAC,sBAAsB;YACnD,OAAO,SAAS,GAAG,CAAC,YAAY;YAChC,aAAa,EAAE;QACjB;QAEA,MAAM,gBAAgB,yKAAwB,CAAC,KAAK,CAAC;QAErD,kGAAkG;QAClG,MAAM,WAAW,MAAM,IAAA,oKAAa,EAAC,GAAG,kKAAW,CAAC,cAAc,CAAC,EAAE;YACnE,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,QAAQ,MAAM,SAAS,IAAI;YACjC,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;QACnC;QAEA,MAAM,SAAS,MAAM,SAAS,IAAI;QAElC,+CAA+C;QAC/C,MAAM,IAAA,+HAAQ,EAAC;YACb,GAAG,YAAY;YACf,QAAQ,oIAAa,CAAC,oBAAoB;YAC1C,UAAU;YACV,YAAY,OAAO,IAAI,CAAC,EAAE;YAC1B,SAAS,CAAC,QAAQ,EAAE,cAAc,UAAU,CAAC,2BAA2B,EAAE,cAAc,SAAS,EAAE;YACnG,SAAS;QACX;QAEA,+CAA+C;QAC/C,IAAA,8IAAa,EAAC,kBAAkB;QAChC,IAAA,8IAAa,EAAC,CAAC,QAAQ,EAAE,cAAc,SAAS,CAAC,eAAe,CAAC,EAAE;QACnE,IAAA,8IAAa,EAAC,YAAY;QAC1B,IAAA,+IAAc,EAAC,CAAC,UAAU,EAAE,cAAc,SAAS,CAAC,eAAe,CAAC;QACpE,IAAA,+IAAc,EAAC;QAEf,OAAO;YACL,SAAS;YACT,MAAM,OAAO,IAAI;YACjB,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,IAAI,iBAAiB,kLAAC,CAAC,QAAQ,EAAE;YAC/B,MAAM,cAAwC,CAAC;YAC/C,MAAM,MAAM,CAAC,OAAO,CAAC,CAAC;gBACpB,MAAM,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC;gBAC3B,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE;oBACtB,WAAW,CAAC,KAAK,GAAG,EAAE;gBACxB;gBACA,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,OAAO;YACpC;YAEA,OAAO;gBACL,QAAQ;YACV;QACF;QAEA,uCAAuC;QACvC,MAAM,IAAA,+HAAQ,EAAC;YACb,GAAG,YAAY;YACf,QAAQ,oIAAa,CAAC,oBAAoB;YAC1C,UAAU;YACV,SAAS;YACT,SAAS;YACT,cAAc,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACzD;QAEA,OAAO;YACL,QAAQ;gBACN,OAAO;oBAAC,iBAAiB,QAAQ,MAAM,OAAO,GAAG;iBAAiC;YACpF;QACF;IACF;AACF;AAqBO,eAAe,uBAAuB,SAAkB,EAAE,UAAmB;IAClF,IAAI;QACF,mEAAmE;QACnE,IAAI;QACJ,MAAM,SAAiC,CAAC;QAExC,IAAI,WAAW;YACb,qCAAqC;YACrC,WAAW,CAAC,uBAAuB,EAAE,WAAW;YAChD,IAAI,YAAY;gBACd,OAAO,UAAU,GAAG;YACtB;QACF,OAAO;YACL,6CAA6C;YAC7C,WAAW;YACX,IAAI,YAAY;gBACd,OAAO,IAAI,GAAG;YAChB;QACF;QAEA,QAAQ,GAAG,CAAC,mCAAmC,UAAU;QAEzD,MAAM,kBAAkB,MAAM,IAAA,kJAAS,EACrC,UACA,QACA;YACE,OAAO;QACT;QAGF,QAAQ,GAAG,CAAC,wCAAwC;YAClD,SAAS,CAAC,CAAC,gBAAgB,IAAI;YAC/B,UAAU,OAAO,gBAAgB,IAAI;YACrC,SAAS,MAAM,OAAO,CAAC,gBAAgB,IAAI;QAC7C;QAEA,+BAA+B;QAC/B,MAAM,eAAe,MAAM,IAAA,yKAAkB;QAC7C,MAAM,IAAA,+HAAQ,EAAC;YACb,GAAG,YAAY;YACf,QAAQ,oIAAa,CAAC,kBAAkB;YACxC,UAAU;YACV,SAAS,CAAC,oCAAoC,EAAE,WAAW;YAC3D,SAAS;QACX;QAEA,qFAAqF;QACrF,0FAA0F;QAC1F,IAAI,gBAA2B,EAAE;QAEjC,IAAI,gBAAgB,IAAI,EAAE;YACxB,uDAAuD;YACvD,IAAI,MAAM,OAAO,CAAC,gBAAgB,IAAI,GAAG;gBACvC,gBAAgB,gBAAgB,IAAI;YACtC,OAEK,IAAI,OAAO,gBAAgB,IAAI,KAAK,YAAY,UAAU,gBAAgB,IAAI,EAAE;gBACnF,MAAM,SAAS,gBAAgB,IAAI;gBACnC,IAAI,OAAO,IAAI,IAAI,MAAM,OAAO,CAAC,OAAO,IAAI,GAAG;oBAC7C,gBAAgB,OAAO,IAAI;gBAC7B;YACF,OAEK,IAAI,OAAO,gBAAgB,IAAI,KAAK,YAAY,aAAa,gBAAgB,IAAI,EAAE;gBACtF,MAAM,SAAS,gBAAgB,IAAI;gBACnC,IAAI,OAAO,OAAO,IAAI,MAAM,OAAO,CAAC,OAAO,OAAO,GAAG;oBACnD,gBAAgB,OAAO,OAAO;gBAChC;YACF;QACF;QAEA,QAAQ,GAAG,CAAC,kDAAkD,cAAc,MAAM;QAElF,OAAO;YACL,SAAS;YACT,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,QAAQ,KAAK,CAAC,qDAAqD;QAEnE,2CAA2C;QAC3C,IAAI,iBAAiB,aAAa,MAAM,OAAO,CAAC,QAAQ,CAAC,UAAU;YACjE,OAAO;gBACL,SAAS;gBACT,OAAO,CAAC,oCAAoC,EAAE,kKAAW,CAAC,uCAAuC,CAAC;YACpG;QACF;QAEA,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF;AAkBO,eAAe,yBACpB,EAAU,EACV,UAAwB,EACxB,QAAkB;IAElB,MAAM,QAAQ,MAAM,IAAA,mKAAY;IAChC,MAAM,eAAe,MAAM,IAAA,yKAAkB;IAE7C,IAAI,CAAC,OAAO;QACV,OAAO;YACL,QAAQ;gBACN,OAAO;oBAAC;iBAA0B;YACpC;QACF;IACF;IAEA,IAAI;QACF,MAAM,UAAU;YACd,YAAY,SAAS,GAAG,CAAC,iBAAiB;YAC1C,OAAO,SAAS,GAAG,CAAC,YAAY;YAChC,aAAa,SAAS,GAAG,CAAC,kBAAkB;YAC5C,YAAY,SAAS,GAAG,CAAC,iBAAiB;YAC1C,UAAU,SAAS,GAAG,CAAC,eAAe;YACtC,aAAa,SAAS,GAAG,CAAC,kBAAkB;YAC5C,UAAU,SAAS,GAAG,CAAC,eAAe;YACtC,aAAa,SAAS,GAAG,CAAC,kBAAkB;YAC5C,WAAW,SAAS,GAAG,CAAC,gBAAgB;YACxC,eAAe,SAAS,GAAG,CAAC,oBAAoB;YAChD,WAAW,SAAS,GAAG,CAAC,gBAAgB;YACxC,kBAAkB,SAAS,GAAG,CAAC,sBAAsB,SAAS,GAAG,CAAC,wBAAwB,SAAS;YACnG,cAAc,SAAS,GAAG,CAAC,mBAAmB;YAC9C,mBAAmB,SAAS,GAAG,CAAC,uBAAuB,SAAS,GAAG,CAAC,yBAAyB,SAAS;YACtG,gBAAgB,SAAS,GAAG,CAAC,oBAAoB,SAAS,GAAG,CAAC,sBAAsB,SAAS;YAC7F,OAAO,SAAS,GAAG,CAAC,YAAY;QAClC;QAEA,MAAM,gBAAgB,yKAAwB,CAAC,KAAK,CAAC;QAErD,MAAM,WAAW,MAAM,IAAA,oKAAa,EAAC,GAAG,kKAAW,CAAC,eAAe,EAAE,IAAI,EAAE;YACzE,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,QAAQ,MAAM,SAAS,IAAI;YACjC,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;QACnC;QAEA,MAAM,SAAS,MAAM,SAAS,IAAI;QAElC,mDAAmD;QACnD,MAAM,IAAA,+HAAQ,EAAC;YACb,GAAG,YAAY;YACf,QAAQ,oIAAa,CAAC,oBAAoB;YAC1C,UAAU;YACV,YAAY;YACZ,SAAS,CAAC,sBAAsB,EAAE,IAAI;YACtC,SAAS;YACT,SAAS;QACX;QAEA,8BAA8B;QAC9B,IAAA,8IAAa,EAAC,kBAAkB;QAChC,IAAA,8IAAa,EAAC,CAAC,cAAc,EAAE,IAAI,EAAE;QACrC,IAAA,8IAAa,EAAC,YAAY;QAC1B,IAAA,+IAAc,EAAC,CAAC,gBAAgB,EAAE,IAAI;QACtC,IAAA,+IAAc,EAAC;QAEf,OAAO;YACL,SAAS;YACT,MAAM,OAAO,IAAI;YACjB,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,IAAI,iBAAiB,kLAAC,CAAC,QAAQ,EAAE;YAC/B,MAAM,cAAwC,CAAC;YAC/C,MAAM,MAAM,CAAC,OAAO,CAAC,CAAC;gBACpB,MAAM,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC;gBAC3B,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE;oBACtB,WAAW,CAAC,KAAK,GAAG,EAAE;gBACxB;gBACA,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,OAAO;YACpC;YAEA,OAAO;gBACL,QAAQ;YACV;QACF;QAEA,8CAA8C;QAC9C,MAAM,IAAA,+HAAQ,EAAC;YACb,GAAG,YAAY;YACf,QAAQ,oIAAa,CAAC,oBAAoB;YAC1C,UAAU;YACV,YAAY;YACZ,SAAS,CAAC,+BAA+B,EAAE,IAAI;YAC/C,SAAS;YACT,cAAc,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACzD;QAEA,OAAO;YACL,QAAQ;gBACN,OAAO;oBAAC,iBAAiB,QAAQ,MAAM,OAAO,GAAG;iBAAiC;YACpF;QACF;IACF;AACF;AAgBO,eAAe,yBAAyB,EAAU;IACvD,MAAM,QAAQ,MAAM,IAAA,mKAAY;IAChC,MAAM,eAAe,MAAM,IAAA,yKAAkB;IAE7C,IAAI,CAAC,OAAO;QACV,OAAO;YACL,QAAQ;gBACN,OAAO;oBAAC;iBAA0B;YACpC;QACF;IACF;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,oKAAa,EAAC,GAAG,kKAAW,CAAC,eAAe,EAAE,IAAI,EAAE;YACzE,QAAQ;QACV;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,QAAQ,MAAM,SAAS,IAAI;YACjC,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;QACnC;QAEA,+CAA+C;QAC/C,MAAM,IAAA,+HAAQ,EAAC;YACb,GAAG,YAAY;YACf,QAAQ,oIAAa,CAAC,oBAAoB;YAC1C,UAAU;YACV,YAAY;YACZ,SAAS,CAAC,sBAAsB,EAAE,IAAI;YACtC,SAAS;QACX;QAEA,8BAA8B;QAC9B,IAAA,8IAAa,EAAC,kBAAkB;QAChC,IAAA,8IAAa,EAAC,CAAC,cAAc,EAAE,IAAI,EAAE;QACrC,IAAA,8IAAa,EAAC,YAAY;QAC1B,IAAA,+IAAc,EAAC;QAEf,OAAO;YACL,SAAS;YACT,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,8CAA8C;QAC9C,MAAM,IAAA,+HAAQ,EAAC;YACb,GAAG,YAAY;YACf,QAAQ,oIAAa,CAAC,oBAAoB;YAC1C,UAAU;YACV,YAAY;YACZ,SAAS,CAAC,+BAA+B,EAAE,IAAI;YAC/C,SAAS;YACT,cAAc,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACzD;QAEA,OAAO;YACL,QAAQ;gBACN,OAAO;oBAAC,iBAAiB,QAAQ,MAAM,OAAO,GAAG;iBAAiC;YACpF;QACF;IACF;AACF;;;IAtasB;IAgIA;IAgHA;IA0HA;;AA1WA,+OAAA;AAgIA,+OAAA;AAgHA,+OAAA;AA0HA,+OAAA","debugId":null}},
    {"offset": {"line": 1736, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/schemas/immunization.schemas.ts"],"sourcesContent":["/**\r\n * Immunization Zod schemas for form validation\r\n *\r\n * @module schemas/immunization\r\n * @description Zod schemas for immunization/vaccination management forms\r\n * HIPAA CRITICAL: All immunization records contain PHI\r\n */\r\n\r\nimport { z } from 'zod';\r\n// import { VaccinationComplianceStatus } from '@/constants/healthRecords';\r\n\r\n/**\r\n * Immunization/Vaccination creation schema\r\n */\r\nexport const immunizationCreateSchema = z.object({\r\n  studentId: z.string().uuid('Invalid student ID'),\r\n  vaccineName: z.string()\r\n    .min(1, 'Vaccine name is required')\r\n    .max(255, 'Vaccine name must be less than 255 characters'),\r\n  vaccineType: z.string().max(100).optional(),\r\n  manufacturer: z.string().max(255).optional(),\r\n  lotNumber: z.string().max(100).optional(),\r\n  cvxCode: z.string()\r\n    .regex(/^\\d{1,3}$/, 'CVX code must be 1-3 digits')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  ndcCode: z.string()\r\n    .regex(/^\\d{5}-\\d{4}-\\d{2}$/, 'NDC code format: 12345-1234-12')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  doseNumber: z.number().int().positive().optional(),\r\n  totalDoses: z.number().int().positive().optional(),\r\n  seriesComplete: z.boolean().default(false),\r\n  administrationDate: z.string().refine((date) => {\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid administration date'),\r\n  administeredBy: z.string()\r\n    .min(1, 'Administrator name is required')\r\n    .max(255, 'Administrator name must be less than 255 characters'),\r\n  administeredByRole: z.string().max(100).optional(),\r\n  facility: z.string().max(255).optional(),\r\n  siteOfAdministration: z.enum([\r\n    'LEFT_ARM',\r\n    'RIGHT_ARM',\r\n    'LEFT_THIGH',\r\n    'RIGHT_THIGH',\r\n    'LEFT_DELTOID',\r\n    'RIGHT_DELTOID',\r\n    'LEFT_VASTUS_LATERALIS',\r\n    'RIGHT_VASTUS_LATERALIS',\r\n    'BUTTOCK',\r\n    'ORAL',\r\n    'NASAL',\r\n    'OTHER'\r\n  ]).optional(),\r\n  routeOfAdministration: z.enum([\r\n    'INTRAMUSCULAR',\r\n    'SUBCUTANEOUS',\r\n    'INTRADERMAL',\r\n    'ORAL',\r\n    'NASAL',\r\n    'TRANSDERMAL',\r\n    'OTHER'\r\n  ]).optional(),\r\n  dosageAmount: z.string().max(50).optional(),\r\n  expirationDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid expiration date'),\r\n  nextDueDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid next due date'),\r\n  reactions: z.string().max(2000).optional(),\r\n  exemptionStatus: z.boolean().default(false),\r\n  exemptionReason: z.enum(['MEDICAL', 'RELIGIOUS', 'PHILOSOPHICAL', 'OTHER']).optional(),\r\n  exemptionDocument: z.string().optional(),\r\n  complianceStatus: z.enum(['COMPLIANT', 'NON_COMPLIANT', 'OVERDUE', 'EXEMPT', 'PENDING'], {\r\n    message: 'Invalid compliance status'\r\n  }).default('COMPLIANT'),\r\n  vfcEligibility: z.boolean().default(false),\r\n  visProvided: z.boolean().default(false),\r\n  visDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid VIS date'),\r\n  consentObtained: z.boolean().default(false),\r\n  consentBy: z.string().max(255).optional(),\r\n  notes: z.string().max(5000).optional()\r\n}).refine((data) => {\r\n  // If series is specified, both dose number and total doses should be provided\r\n  if (data.doseNumber && !data.totalDoses) {\r\n    return false;\r\n  }\r\n  if (data.totalDoses && !data.doseNumber) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'Both dose number and total doses must be provided for series vaccines',\r\n  path: ['doseNumber']\r\n}).refine((data) => {\r\n  // If exemption is granted, reason should be provided\r\n  if (data.exemptionStatus && !data.exemptionReason) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'Exemption reason is required when exemption status is granted',\r\n  path: ['exemptionReason']\r\n}).refine((data) => {\r\n  // If consent is obtained, consentBy should be provided\r\n  if (data.consentObtained && !data.consentBy) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'Consent provider name is required when consent is obtained',\r\n  path: ['consentBy']\r\n}).refine((data) => {\r\n  // If VIS is provided, VIS date should be provided\r\n  if (data.visProvided && !data.visDate) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'VIS date is required when VIS is provided',\r\n  path: ['visDate']\r\n});\r\n\r\nexport type ImmunizationCreateFormData = z.infer<typeof immunizationCreateSchema>;\r\n\r\n/**\r\n * Immunization update schema\r\n */\r\nexport const immunizationUpdateSchema = z.object({\r\n  vaccineName: z.string()\r\n    .min(1, 'Vaccine name is required')\r\n    .max(255, 'Vaccine name must be less than 255 characters')\r\n    .optional(),\r\n  vaccineType: z.string().max(100).optional(),\r\n  manufacturer: z.string().max(255).optional(),\r\n  lotNumber: z.string().max(100).optional(),\r\n  cvxCode: z.string()\r\n    .regex(/^\\d{1,3}$/, 'CVX code must be 1-3 digits')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  ndcCode: z.string()\r\n    .regex(/^\\d{5}-\\d{4}-\\d{2}$/, 'NDC code format: 12345-1234-12')\r\n    .optional()\r\n    .or(z.literal('')),\r\n  doseNumber: z.number().int().positive().optional(),\r\n  totalDoses: z.number().int().positive().optional(),\r\n  seriesComplete: z.boolean().optional(),\r\n  administrationDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid administration date'),\r\n  administeredBy: z.string().max(255).optional(),\r\n  administeredByRole: z.string().max(100).optional(),\r\n  facility: z.string().max(255).optional(),\r\n  siteOfAdministration: z.enum([\r\n    'LEFT_ARM',\r\n    'RIGHT_ARM',\r\n    'LEFT_THIGH',\r\n    'RIGHT_THIGH',\r\n    'LEFT_DELTOID',\r\n    'RIGHT_DELTOID',\r\n    'LEFT_VASTUS_LATERALIS',\r\n    'RIGHT_VASTUS_LATERALIS',\r\n    'BUTTOCK',\r\n    'ORAL',\r\n    'NASAL',\r\n    'OTHER'\r\n  ]).optional(),\r\n  routeOfAdministration: z.enum([\r\n    'INTRAMUSCULAR',\r\n    'SUBCUTANEOUS',\r\n    'INTRADERMAL',\r\n    'ORAL',\r\n    'NASAL',\r\n    'TRANSDERMAL',\r\n    'OTHER'\r\n  ]).optional(),\r\n  dosageAmount: z.string().max(50).optional(),\r\n  expirationDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid expiration date'),\r\n  nextDueDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid next due date'),\r\n  reactions: z.string().max(2000).optional(),\r\n  exemptionStatus: z.boolean().optional(),\r\n  exemptionReason: z.enum(['MEDICAL', 'RELIGIOUS', 'PHILOSOPHICAL', 'OTHER']).optional(),\r\n  exemptionDocument: z.string().optional(),\r\n  complianceStatus: z.enum(['COMPLIANT', 'NON_COMPLIANT', 'OVERDUE', 'EXEMPT', 'PENDING']).optional(),\r\n  vfcEligibility: z.boolean().optional(),\r\n  visProvided: z.boolean().optional(),\r\n  visDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid VIS date'),\r\n  consentObtained: z.boolean().optional(),\r\n  consentBy: z.string().max(255).optional(),\r\n  notes: z.string().max(5000).optional()\r\n});\r\n\r\nexport type ImmunizationUpdateFormData = z.infer<typeof immunizationUpdateSchema>;\r\n\r\n/**\r\n * Immunization search/filter schema\r\n */\r\nexport const immunizationSearchSchema = z.object({\r\n  studentId: z.string().uuid().optional(),\r\n  vaccineName: z.string().optional(),\r\n  vaccineType: z.string().optional(),\r\n  complianceStatus: z.array(z.enum(['COMPLIANT', 'NON_COMPLIANT', 'OVERDUE', 'EXEMPT', 'PENDING'])).optional(),\r\n  exemptionStatus: z.boolean().optional(),\r\n  dateFrom: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid from date'),\r\n  dateTo: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid to date'),\r\n  seriesComplete: z.boolean().optional(),\r\n  nextDueDateFrom: z.string().optional(),\r\n  nextDueDateTo: z.string().optional(),\r\n  page: z.number().int().positive().default(1),\r\n  limit: z.number().int().positive().max(100).default(20),\r\n  sortBy: z.enum(['administrationDate', 'vaccineName', 'nextDueDate', 'complianceStatus']).default('administrationDate'),\r\n  sortDirection: z.enum(['asc', 'desc']).default('desc')\r\n});\r\n\r\nexport type ImmunizationSearchFormData = z.infer<typeof immunizationSearchSchema>;\r\n\r\n/**\r\n * Immunization due date alert schema\r\n */\r\nexport const immunizationDueDateAlertSchema = z.object({\r\n  daysThreshold: z.number().int().positive().max(365).default(30),\r\n  includeOverdue: z.boolean().default(true),\r\n  includeExempt: z.boolean().default(false),\r\n  schoolId: z.string().uuid().optional(),\r\n  gradeLevel: z.string().optional()\r\n});\r\n\r\nexport type ImmunizationDueDateAlertFormData = z.infer<typeof immunizationDueDateAlertSchema>;\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2010, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/health-records.immunizations.ts"],"sourcesContent":["/**\r\n * @fileoverview Immunization Record Operations\r\n * @module lib/actions/health-records.immunizations\r\n *\r\n * Server actions for creating and managing immunization (vaccination) records.\r\n * HIPAA CRITICAL: All operations include mandatory audit logging for PHI access.\r\n * Tracks vaccine details, administration information, and compliance status.\r\n */\r\n\r\n'use server';\r\n\r\nimport { revalidatePath, revalidateTag } from 'next/cache';\r\nimport { z, type ZodIssue } from 'zod';\r\n\r\n// Import schemas\r\nimport {\r\n  immunizationCreateSchema\r\n} from '@/schemas/immunization.schemas';\r\n\r\n// Import audit logging utilities\r\nimport {\r\n  auditLog,\r\n  AUDIT_ACTIONS\r\n} from '@/lib/audit';\r\n\r\n// Import shared utilities and types\r\nimport {\r\n  getAuthToken,\r\n  createAuditContext,\r\n  enhancedFetch,\r\n  BACKEND_URL\r\n} from './health-records.utils';\r\nimport type { ActionResult } from './health-records.types';\r\n\r\n/**\r\n * Create immunization record with HIPAA audit logging\r\n *\r\n * @param prevState - Previous action state (for useActionState hook)\r\n * @param formData - Form data containing immunization record fields\r\n * @returns ActionResult with created immunization record or validation errors\r\n *\r\n * @example\r\n * ```typescript\r\n * 'use client';\r\n * import { useActionState } from 'react';\r\n * import { createImmunizationAction } from '@/lib/actions/health-records.actions';\r\n *\r\n * function ImmunizationForm() {\r\n *   const [state, formAction, isPending] = useActionState(createImmunizationAction, { errors: {} });\r\n *   return <form action={formAction}>...</form>;\r\n * }\r\n * ```\r\n */\r\nexport async function createImmunizationAction(\r\n  _prevState: ActionResult,\r\n  formData: FormData\r\n): Promise<ActionResult> {\r\n  const token = await getAuthToken();\r\n  const auditContext = await createAuditContext();\r\n\r\n  if (!token) {\r\n    return {\r\n      errors: {\r\n        _form: ['Authentication required']\r\n      }\r\n    };\r\n  }\r\n\r\n  try {\r\n    const rawData = {\r\n      studentId: formData.get('studentId'),\r\n      vaccineName: formData.get('vaccineName'),\r\n      vaccineType: formData.get('vaccineType') || undefined,\r\n      manufacturer: formData.get('manufacturer') || undefined,\r\n      lotNumber: formData.get('lotNumber') || undefined,\r\n      cvxCode: formData.get('cvxCode') || '',\r\n      ndcCode: formData.get('ndcCode') || '',\r\n      doseNumber: formData.get('doseNumber') ? Number(formData.get('doseNumber')) : undefined,\r\n      totalDoses: formData.get('totalDoses') ? Number(formData.get('totalDoses')) : undefined,\r\n      seriesComplete: formData.get('seriesComplete') === 'true',\r\n      administrationDate: formData.get('administrationDate'),\r\n      administeredBy: formData.get('administeredBy'),\r\n      administeredByRole: formData.get('administeredByRole') || undefined,\r\n      facility: formData.get('facility') || undefined,\r\n      siteOfAdministration: formData.get('siteOfAdministration') || undefined,\r\n      routeOfAdministration: formData.get('routeOfAdministration') || undefined,\r\n      dosageAmount: formData.get('dosageAmount') || undefined,\r\n      expirationDate: formData.get('expirationDate') || undefined,\r\n      nextDueDate: formData.get('nextDueDate') || undefined,\r\n      reactions: formData.get('reactions') || undefined,\r\n      exemptionStatus: formData.get('exemptionStatus') === 'true',\r\n      exemptionReason: formData.get('exemptionReason') || undefined,\r\n      exemptionDocument: formData.get('exemptionDocument') || undefined,\r\n      complianceStatus: formData.get('complianceStatus') || 'COMPLIANT',\r\n      vfcEligibility: formData.get('vfcEligibility') === 'true',\r\n      visProvided: formData.get('visProvided') === 'true',\r\n      visDate: formData.get('visDate') || undefined,\r\n      consentObtained: formData.get('consentObtained') === 'true',\r\n      consentBy: formData.get('consentBy') || undefined,\r\n      notes: formData.get('notes') || undefined\r\n    };\r\n\r\n    const validatedData = immunizationCreateSchema.parse(rawData);\r\n\r\n    const response = await enhancedFetch(`${BACKEND_URL}/vaccinations`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(validatedData)\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      throw new Error(error.message || 'Failed to create immunization record');\r\n    }\r\n\r\n    const result = await response.json();\r\n\r\n    // HIPAA AUDIT LOG - Mandatory for immunization PHI\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.CREATE_HEALTH_RECORD,\r\n      resource: 'Vaccination',\r\n      resourceId: result.data.id,\r\n      details: `Created ${validatedData.vaccineName} immunization for student ${validatedData.studentId}`,\r\n      success: true\r\n    });\r\n\r\n    // Enhanced cache invalidation\r\n    revalidateTag('health-records', 'default');\r\n    revalidateTag('immunizations', 'default');\r\n    revalidateTag(`student-${validatedData.studentId}-health-records`, 'default');\r\n    revalidateTag('phi-data', 'default');\r\n    revalidatePath(`/students/${validatedData.studentId}/health-records/immunizations`);\r\n    revalidatePath('/health-records');\r\n\r\n    return {\r\n      success: true,\r\n      data: result.data,\r\n      message: 'Immunization record created successfully'\r\n    };\r\n  } catch (error) {\r\n    if (error instanceof z.ZodError) {\r\n      const fieldErrors: Record<string, string[]> = {};\r\n      error.issues.forEach((err: ZodIssue) => {\r\n        const path = err.path.join('.');\r\n        if (!fieldErrors[path]) {\r\n          fieldErrors[path] = [];\r\n        }\r\n        fieldErrors[path].push(err.message);\r\n      });\r\n\r\n      return {\r\n        errors: fieldErrors\r\n      };\r\n    }\r\n\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.CREATE_HEALTH_RECORD,\r\n      resource: 'Vaccination',\r\n      details: 'Failed to create immunization record',\r\n      success: false,\r\n      errorMessage: error instanceof Error ? error.message : 'Unknown error'\r\n    });\r\n\r\n    return {\r\n      errors: {\r\n        _form: [error instanceof Error ? error.message : 'Failed to create immunization record']\r\n      }\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2153, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/schemas/allergy.schemas.ts"],"sourcesContent":["/**\r\n * Allergy Zod schemas for form validation\r\n *\r\n * @module schemas/allergy\r\n * @description Zod schemas for allergy management forms\r\n * HIPAA CRITICAL: All allergy records contain PHI and are EMERGENCY-CRITICAL\r\n */\r\n\r\nimport { z } from 'zod';\r\n// import { AllergyType } from '@/constants/healthRecords';\r\n\r\n/**\r\n * AllergySeverity enum for validation\r\n */\r\nexport const AllergySeverityEnum = z.enum([\r\n  'MILD',\r\n  'MODERATE',\r\n  'SEVERE',\r\n  'LIFE_THREATENING'\r\n], {\r\n  message: 'Invalid allergy severity level'\r\n});\r\n\r\n/**\r\n * Allergy creation schema\r\n */\r\nexport const allergyCreateSchema = z.object({\r\n  studentId: z.string().uuid('Invalid student ID'),\r\n  allergen: z.string()\r\n    .min(1, 'Allergen name is required')\r\n    .max(255, 'Allergen name must be less than 255 characters'),\r\n  allergyType: z.enum(['FOOD', 'MEDICATION', 'ENVIRONMENTAL', 'INSECT', 'LATEX', 'OTHER'], {\r\n    message: 'Invalid allergy type'\r\n  }),\r\n  severity: AllergySeverityEnum,\r\n  symptoms: z.string()\r\n    .max(2000, 'Symptoms description must be less than 2000 characters')\r\n    .optional(),\r\n  treatment: z.string()\r\n    .max(2000, 'Treatment description must be less than 2000 characters')\r\n    .optional(),\r\n  emergencyProtocol: z.string()\r\n    .max(5000, 'Emergency protocol must be less than 5000 characters')\r\n    .optional(),\r\n  onsetDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid onset date'),\r\n  diagnosedDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid diagnosis date'),\r\n  diagnosedBy: z.string()\r\n    .max(255, 'Diagnosed by must be less than 255 characters')\r\n    .optional(),\r\n  verified: z.boolean().default(false),\r\n  verifiedBy: z.string().optional(),\r\n  verificationDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid verification date'),\r\n  active: z.boolean().default(true),\r\n  epiPenRequired: z.boolean().default(false),\r\n  epiPenLocation: z.string()\r\n    .max(255, 'EpiPen location must be less than 255 characters')\r\n    .optional(),\r\n  epiPenExpiration: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid EpiPen expiration date'),\r\n  notes: z.string()\r\n    .max(5000, 'Notes must be less than 5000 characters')\r\n    .optional()\r\n}).refine((data) => {\r\n  // If EpiPen is required, location and expiration should be provided\r\n  if (data.epiPenRequired && !data.epiPenLocation) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'EpiPen location is required when EpiPen is needed',\r\n  path: ['epiPenLocation']\r\n}).refine((data) => {\r\n  // If EpiPen is required, expiration date should be provided\r\n  if (data.epiPenRequired && !data.epiPenExpiration) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'EpiPen expiration date is required when EpiPen is needed',\r\n  path: ['epiPenExpiration']\r\n}).refine((data) => {\r\n  // For SEVERE or LIFE_THREATENING allergies, emergency protocol should be provided\r\n  if ((data.severity === 'SEVERE' || data.severity === 'LIFE_THREATENING') && !data.emergencyProtocol) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'Emergency protocol is required for severe or life-threatening allergies',\r\n  path: ['emergencyProtocol']\r\n}).refine((data) => {\r\n  // If verified, verifiedBy and verificationDate should be provided\r\n  if (data.verified && !data.verifiedBy) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'Verifier information is required when allergy is verified',\r\n  path: ['verifiedBy']\r\n});\r\n\r\nexport type AllergyCreateFormData = z.infer<typeof allergyCreateSchema>;\r\n\r\n/**\r\n * Allergy update schema\r\n */\r\nexport const allergyUpdateSchema = z.object({\r\n  allergen: z.string()\r\n    .min(1, 'Allergen name is required')\r\n    .max(255, 'Allergen name must be less than 255 characters')\r\n    .optional(),\r\n  allergyType: z.enum(['FOOD', 'MEDICATION', 'ENVIRONMENTAL', 'INSECT', 'LATEX', 'OTHER']).optional(),\r\n  severity: AllergySeverityEnum.optional(),\r\n  symptoms: z.string().max(2000).optional(),\r\n  treatment: z.string().max(2000).optional(),\r\n  emergencyProtocol: z.string().max(5000).optional(),\r\n  onsetDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid onset date'),\r\n  diagnosedDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid diagnosis date'),\r\n  diagnosedBy: z.string().max(255).optional(),\r\n  verified: z.boolean().optional(),\r\n  verifiedBy: z.string().optional(),\r\n  verificationDate: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid verification date'),\r\n  active: z.boolean().optional(),\r\n  epiPenRequired: z.boolean().optional(),\r\n  epiPenLocation: z.string().max(255).optional(),\r\n  epiPenExpiration: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid EpiPen expiration date'),\r\n  notes: z.string().max(5000).optional()\r\n});\r\n\r\nexport type AllergyUpdateFormData = z.infer<typeof allergyUpdateSchema>;\r\n\r\n/**\r\n * Allergy search/filter schema\r\n */\r\nexport const allergySearchSchema = z.object({\r\n  studentId: z.string().uuid().optional(),\r\n  allergyType: z.array(z.enum(['FOOD', 'MEDICATION', 'ENVIRONMENTAL', 'INSECT', 'LATEX', 'OTHER'])).optional(),\r\n  severity: z.array(AllergySeverityEnum).optional(),\r\n  active: z.boolean().optional(),\r\n  verified: z.boolean().optional(),\r\n  epiPenRequired: z.boolean().optional(),\r\n  allergen: z.string().optional(),\r\n  page: z.number().int().positive().default(1),\r\n  limit: z.number().int().positive().max(100).default(20),\r\n  sortBy: z.enum(['allergen', 'severity', 'diagnosedDate', 'allergyType']).default('severity'),\r\n  sortDirection: z.enum(['asc', 'desc']).default('desc')\r\n});\r\n\r\nexport type AllergySearchFormData = z.infer<typeof allergySearchSchema>;\r\n\r\n/**\r\n * Allergy reaction incident schema\r\n * For documenting allergic reactions when they occur\r\n */\r\nexport const allergyReactionSchema = z.object({\r\n  allergyId: z.string().uuid('Invalid allergy ID'),\r\n  studentId: z.string().uuid('Invalid student ID'),\r\n  incidentDate: z.string().refine((date) => {\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid incident date'),\r\n  symptoms: z.string()\r\n    .min(1, 'Symptoms description is required')\r\n    .max(2000, 'Symptoms must be less than 2000 characters'),\r\n  severity: AllergySeverityEnum,\r\n  triggerExposure: z.string()\r\n    .min(1, 'Trigger/exposure description is required')\r\n    .max(1000, 'Trigger description must be less than 1000 characters'),\r\n  treatmentGiven: z.string()\r\n    .min(1, 'Treatment description is required')\r\n    .max(2000, 'Treatment description must be less than 2000 characters'),\r\n  epiPenAdministered: z.boolean().default(false),\r\n  epiPenAdministeredBy: z.string().max(255).optional(),\r\n  emergencyServicesContacted: z.boolean().default(false),\r\n  parentNotified: z.boolean().default(false),\r\n  parentNotifiedAt: z.string().optional().refine((date) => {\r\n    if (!date) return true;\r\n    const d = new Date(date);\r\n    return !isNaN(d.getTime());\r\n  }, 'Invalid notification time'),\r\n  outcome: z.enum([\r\n    'RESOLVED_AT_SCHOOL',\r\n    'SENT_HOME',\r\n    'EMERGENCY_TRANSPORT',\r\n    'HOSPITAL_ADMISSION',\r\n    'OTHER'\r\n  ]),\r\n  followUpRequired: z.boolean().default(false),\r\n  notes: z.string().max(5000).optional(),\r\n  witnesses: z.array(z.string()).default([]),\r\n  documentedBy: z.string()\r\n    .min(1, 'Documenter name is required')\r\n    .max(255, 'Documenter name must be less than 255 characters')\r\n}).refine((data) => {\r\n  // If EpiPen was administered, administrator should be documented\r\n  if (data.epiPenAdministered && !data.epiPenAdministeredBy) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'EpiPen administrator name is required when EpiPen was administered',\r\n  path: ['epiPenAdministeredBy']\r\n}).refine((data) => {\r\n  // If parent was notified, notification time should be documented\r\n  if (data.parentNotified && !data.parentNotifiedAt) {\r\n    return false;\r\n  }\r\n  return true;\r\n}, {\r\n  message: 'Parent notification time is required when parent was notified',\r\n  path: ['parentNotifiedAt']\r\n});\r\n\r\nexport type AllergyReactionFormData = z.infer<typeof allergyReactionSchema>;\r\n\r\n/**\r\n * EpiPen expiration check schema\r\n */\r\nexport const epiPenExpirationCheckSchema = z.object({\r\n  daysThreshold: z.number().int().positive().max(365).default(30),\r\n  schoolId: z.string().uuid().optional(),\r\n  includeExpired: z.boolean().default(true)\r\n});\r\n\r\nexport type EpiPenExpirationCheckFormData = z.infer<typeof epiPenExpirationCheckSchema>;\r\n"],"names":[],"mappings":"AAAA;;;;;;CAMC;;;;;;;;;;;;;;AAED;;AAMO,MAAM,sBAAsB,kLAAC,CAAC,IAAI,CAAC;IACxC;IACA;IACA;IACA;CACD,EAAE;IACD,SAAS;AACX;AAKO,MAAM,sBAAsB,kLAAC,CAAC,MAAM,CAAC;IAC1C,WAAW,kLAAC,CAAC,MAAM,GAAG,IAAI,CAAC;IAC3B,UAAU,kLAAC,CAAC,MAAM,GACf,GAAG,CAAC,GAAG,6BACP,GAAG,CAAC,KAAK;IACZ,aAAa,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAQ;QAAc;QAAiB;QAAU;QAAS;KAAQ,EAAE;QACvF,SAAS;IACX;IACA,UAAU;IACV,UAAU,kLAAC,CAAC,MAAM,GACf,GAAG,CAAC,MAAM,0DACV,QAAQ;IACX,WAAW,kLAAC,CAAC,MAAM,GAChB,GAAG,CAAC,MAAM,2DACV,QAAQ;IACX,mBAAmB,kLAAC,CAAC,MAAM,GACxB,GAAG,CAAC,MAAM,wDACV,QAAQ;IACX,WAAW,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,CAAC;QACvC,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,CAAC,MAAM,EAAE,OAAO;IACzB,GAAG;IACH,eAAe,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,CAAC;QAC3C,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,CAAC,MAAM,EAAE,OAAO;IACzB,GAAG;IACH,aAAa,kLAAC,CAAC,MAAM,GAClB,GAAG,CAAC,KAAK,iDACT,QAAQ;IACX,UAAU,kLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;IAC9B,YAAY,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,kBAAkB,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,CAAC;QAC9C,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,CAAC,MAAM,EAAE,OAAO;IACzB,GAAG;IACH,QAAQ,kLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;IAC5B,gBAAgB,kLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;IACpC,gBAAgB,kLAAC,CAAC,MAAM,GACrB,GAAG,CAAC,KAAK,oDACT,QAAQ;IACX,kBAAkB,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,CAAC;QAC9C,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,CAAC,MAAM,EAAE,OAAO;IACzB,GAAG;IACH,OAAO,kLAAC,CAAC,MAAM,GACZ,GAAG,CAAC,MAAM,2CACV,QAAQ;AACb,GAAG,MAAM,CAAC,CAAC;IACT,oEAAoE;IACpE,IAAI,KAAK,cAAc,IAAI,CAAC,KAAK,cAAc,EAAE;QAC/C,OAAO;IACT;IACA,OAAO;AACT,GAAG;IACD,SAAS;IACT,MAAM;QAAC;KAAiB;AAC1B,GAAG,MAAM,CAAC,CAAC;IACT,4DAA4D;IAC5D,IAAI,KAAK,cAAc,IAAI,CAAC,KAAK,gBAAgB,EAAE;QACjD,OAAO;IACT;IACA,OAAO;AACT,GAAG;IACD,SAAS;IACT,MAAM;QAAC;KAAmB;AAC5B,GAAG,MAAM,CAAC,CAAC;IACT,kFAAkF;IAClF,IAAI,CAAC,KAAK,QAAQ,KAAK,YAAY,KAAK,QAAQ,KAAK,kBAAkB,KAAK,CAAC,KAAK,iBAAiB,EAAE;QACnG,OAAO;IACT;IACA,OAAO;AACT,GAAG;IACD,SAAS;IACT,MAAM;QAAC;KAAoB;AAC7B,GAAG,MAAM,CAAC,CAAC;IACT,kEAAkE;IAClE,IAAI,KAAK,QAAQ,IAAI,CAAC,KAAK,UAAU,EAAE;QACrC,OAAO;IACT;IACA,OAAO;AACT,GAAG;IACD,SAAS;IACT,MAAM;QAAC;KAAa;AACtB;AAOO,MAAM,sBAAsB,kLAAC,CAAC,MAAM,CAAC;IAC1C,UAAU,kLAAC,CAAC,MAAM,GACf,GAAG,CAAC,GAAG,6BACP,GAAG,CAAC,KAAK,kDACT,QAAQ;IACX,aAAa,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAQ;QAAc;QAAiB;QAAU;QAAS;KAAQ,EAAE,QAAQ;IACjG,UAAU,oBAAoB,QAAQ;IACtC,UAAU,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,QAAQ;IACvC,WAAW,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,QAAQ;IACxC,mBAAmB,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,QAAQ;IAChD,WAAW,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,CAAC;QACvC,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,CAAC,MAAM,EAAE,OAAO;IACzB,GAAG;IACH,eAAe,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,CAAC;QAC3C,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,CAAC,MAAM,EAAE,OAAO;IACzB,GAAG;IACH,aAAa,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,KAAK,QAAQ;IACzC,UAAU,kLAAC,CAAC,OAAO,GAAG,QAAQ;IAC9B,YAAY,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,kBAAkB,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,CAAC;QAC9C,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,CAAC,MAAM,EAAE,OAAO;IACzB,GAAG;IACH,QAAQ,kLAAC,CAAC,OAAO,GAAG,QAAQ;IAC5B,gBAAgB,kLAAC,CAAC,OAAO,GAAG,QAAQ;IACpC,gBAAgB,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,KAAK,QAAQ;IAC5C,kBAAkB,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,CAAC;QAC9C,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,CAAC,MAAM,EAAE,OAAO;IACzB,GAAG;IACH,OAAO,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,QAAQ;AACtC;AAOO,MAAM,sBAAsB,kLAAC,CAAC,MAAM,CAAC;IAC1C,WAAW,kLAAC,CAAC,MAAM,GAAG,IAAI,GAAG,QAAQ;IACrC,aAAa,kLAAC,CAAC,KAAK,CAAC,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAQ;QAAc;QAAiB;QAAU;QAAS;KAAQ,GAAG,QAAQ;IAC1G,UAAU,kLAAC,CAAC,KAAK,CAAC,qBAAqB,QAAQ;IAC/C,QAAQ,kLAAC,CAAC,OAAO,GAAG,QAAQ;IAC5B,UAAU,kLAAC,CAAC,OAAO,GAAG,QAAQ;IAC9B,gBAAgB,kLAAC,CAAC,OAAO,GAAG,QAAQ;IACpC,UAAU,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC7B,MAAM,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ,GAAG,OAAO,CAAC;IAC1C,OAAO,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ,GAAG,GAAG,CAAC,KAAK,OAAO,CAAC;IACpD,QAAQ,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAY;QAAY;QAAiB;KAAc,EAAE,OAAO,CAAC;IACjF,eAAe,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAO;KAAO,EAAE,OAAO,CAAC;AACjD;AAQO,MAAM,wBAAwB,kLAAC,CAAC,MAAM,CAAC;IAC5C,WAAW,kLAAC,CAAC,MAAM,GAAG,IAAI,CAAC;IAC3B,WAAW,kLAAC,CAAC,MAAM,GAAG,IAAI,CAAC;IAC3B,cAAc,kLAAC,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC;QAC/B,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,CAAC,MAAM,EAAE,OAAO;IACzB,GAAG;IACH,UAAU,kLAAC,CAAC,MAAM,GACf,GAAG,CAAC,GAAG,oCACP,GAAG,CAAC,MAAM;IACb,UAAU;IACV,iBAAiB,kLAAC,CAAC,MAAM,GACtB,GAAG,CAAC,GAAG,4CACP,GAAG,CAAC,MAAM;IACb,gBAAgB,kLAAC,CAAC,MAAM,GACrB,GAAG,CAAC,GAAG,qCACP,GAAG,CAAC,MAAM;IACb,oBAAoB,kLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;IACxC,sBAAsB,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,KAAK,QAAQ;IAClD,4BAA4B,kLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;IAChD,gBAAgB,kLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;IACpC,kBAAkB,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,CAAC;QAC9C,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,IAAI,IAAI,KAAK;QACnB,OAAO,CAAC,MAAM,EAAE,OAAO;IACzB,GAAG;IACH,SAAS,kLAAC,CAAC,IAAI,CAAC;QACd;QACA;QACA;QACA;QACA;KACD;IACD,kBAAkB,kLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;IACtC,OAAO,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,QAAQ;IACpC,WAAW,kLAAC,CAAC,KAAK,CAAC,kLAAC,CAAC,MAAM,IAAI,OAAO,CAAC,EAAE;IACzC,cAAc,kLAAC,CAAC,MAAM,GACnB,GAAG,CAAC,GAAG,+BACP,GAAG,CAAC,KAAK;AACd,GAAG,MAAM,CAAC,CAAC;IACT,iEAAiE;IACjE,IAAI,KAAK,kBAAkB,IAAI,CAAC,KAAK,oBAAoB,EAAE;QACzD,OAAO;IACT;IACA,OAAO;AACT,GAAG;IACD,SAAS;IACT,MAAM;QAAC;KAAuB;AAChC,GAAG,MAAM,CAAC,CAAC;IACT,iEAAiE;IACjE,IAAI,KAAK,cAAc,IAAI,CAAC,KAAK,gBAAgB,EAAE;QACjD,OAAO;IACT;IACA,OAAO;AACT,GAAG;IACD,SAAS;IACT,MAAM;QAAC;KAAmB;AAC5B;AAOO,MAAM,8BAA8B,kLAAC,CAAC,MAAM,CAAC;IAClD,eAAe,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ,GAAG,GAAG,CAAC,KAAK,OAAO,CAAC;IAC5D,UAAU,kLAAC,CAAC,MAAM,GAAG,IAAI,GAAG,QAAQ;IACpC,gBAAgB,kLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;AACtC","debugId":null}},
    {"offset": {"line": 2405, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/health-records.allergies.ts"],"sourcesContent":["/**\r\n * @fileoverview Allergy Record Operations\r\n * @module lib/actions/health-records.allergies\r\n *\r\n * Server actions for creating and managing allergy records.\r\n * CRITICAL: Allergies are emergency-critical PHI requiring immediate access capabilities.\r\n * HIPAA CRITICAL: All operations include mandatory audit logging.\r\n * Enhanced with shorter cache TTL (60s) for emergency data access.\r\n */\r\n\r\n'use server';\r\n\r\nimport { revalidatePath, revalidateTag } from 'next/cache';\r\nimport { z, type ZodIssue } from 'zod';\r\n\r\n// Import schemas\r\nimport {\r\n  allergyCreateSchema\r\n} from '@/schemas/allergy.schemas';\r\n\r\n// Import audit logging utilities\r\nimport {\r\n  auditLog,\r\n  AUDIT_ACTIONS\r\n} from '@/lib/audit';\r\n\r\n// Import shared utilities and types\r\nimport {\r\n  getAuthToken,\r\n  createAuditContext,\r\n  enhancedFetch,\r\n  BACKEND_URL\r\n} from './health-records.utils';\r\nimport type { ActionResult } from './health-records.types';\r\n\r\n/**\r\n * Create allergy record with HIPAA audit logging\r\n * CRITICAL: Allergies are emergency-critical PHI\r\n *\r\n * @param prevState - Previous action state (for useActionState hook)\r\n * @param formData - Form data containing allergy record fields\r\n * @returns ActionResult with created allergy record or validation errors\r\n *\r\n * @example\r\n * ```typescript\r\n * 'use client';\r\n * import { useActionState } from 'react';\r\n * import { createAllergyAction } from '@/lib/actions/health-records.actions';\r\n *\r\n * function AllergyForm() {\r\n *   const [state, formAction, isPending] = useActionState(createAllergyAction, { errors: {} });\r\n *   return <form action={formAction}>...</form>;\r\n * }\r\n * ```\r\n */\r\nexport async function createAllergyAction(\r\n  _prevState: ActionResult,\r\n  formData: FormData\r\n): Promise<ActionResult> {\r\n  const token = await getAuthToken();\r\n  const auditContext = await createAuditContext();\r\n\r\n  if (!token) {\r\n    return {\r\n      errors: {\r\n        _form: ['Authentication required']\r\n      }\r\n    };\r\n  }\r\n\r\n  try {\r\n    const rawData = {\r\n      studentId: formData.get('studentId'),\r\n      allergen: formData.get('allergen'),\r\n      allergyType: formData.get('allergyType'),\r\n      severity: formData.get('severity'),\r\n      symptoms: formData.get('symptoms') || undefined,\r\n      treatment: formData.get('treatment') || undefined,\r\n      emergencyProtocol: formData.get('emergencyProtocol') || undefined,\r\n      onsetDate: formData.get('onsetDate') || undefined,\r\n      diagnosedDate: formData.get('diagnosedDate') || undefined,\r\n      diagnosedBy: formData.get('diagnosedBy') || undefined,\r\n      verified: formData.get('verified') === 'true',\r\n      verifiedBy: formData.get('verifiedBy') || undefined,\r\n      verificationDate: formData.get('verificationDate') || undefined,\r\n      active: formData.get('active') === 'true',\r\n      epiPenRequired: formData.get('epiPenRequired') === 'true',\r\n      epiPenLocation: formData.get('epiPenLocation') || undefined,\r\n      epiPenExpiration: formData.get('epiPenExpiration') || undefined,\r\n      notes: formData.get('notes') || undefined\r\n    };\r\n\r\n    const validatedData = allergyCreateSchema.parse(rawData);\r\n\r\n    const response = await enhancedFetch(`${BACKEND_URL}/allergies`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(validatedData)\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      throw new Error(error.message || 'Failed to create allergy record');\r\n    }\r\n\r\n    const result = await response.json();\r\n\r\n    // HIPAA AUDIT LOG - CRITICAL: Emergency information\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.CREATE_HEALTH_RECORD,\r\n      resource: 'Allergy',\r\n      resourceId: result.data.id,\r\n      details: `Created ${validatedData.severity} ${validatedData.allergyType} allergy (${validatedData.allergen}) for student ${validatedData.studentId}`,\r\n      success: true\r\n    });\r\n\r\n    // Enhanced cache invalidation with immediate revalidation for emergency data\r\n    revalidateTag('health-records', 'default');\r\n    revalidateTag('allergies', 'default');\r\n    revalidateTag(`student-${validatedData.studentId}-allergies`, 'default');\r\n    revalidateTag(`student-${validatedData.studentId}-health-records`, 'default');\r\n    revalidateTag('emergency-phi-data', 'default');\r\n    revalidateTag('phi-data', 'default');\r\n    revalidatePath(`/students/${validatedData.studentId}/health-records/allergies`);\r\n    revalidatePath('/health-records');\r\n\r\n    return {\r\n      success: true,\r\n      data: result.data,\r\n      message: 'Allergy record created successfully'\r\n    };\r\n  } catch (error) {\r\n    if (error instanceof z.ZodError) {\r\n      const fieldErrors: Record<string, string[]> = {};\r\n      error.issues.forEach((err: ZodIssue) => {\r\n        const path = err.path.join('.');\r\n        if (!fieldErrors[path]) {\r\n          fieldErrors[path] = [];\r\n        }\r\n        fieldErrors[path].push(err.message);\r\n      });\r\n\r\n      return {\r\n        errors: fieldErrors\r\n      };\r\n    }\r\n\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.CREATE_HEALTH_RECORD,\r\n      resource: 'Allergy',\r\n      details: 'Failed to create allergy record',\r\n      success: false,\r\n      errorMessage: error instanceof Error ? error.message : 'Unknown error'\r\n    });\r\n\r\n    return {\r\n      errors: {\r\n        _form: [error instanceof Error ? error.message : 'Failed to create allergy record']\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get student allergies with enhanced caching for emergency access\r\n * Uses shorter cache TTL (60 seconds) for emergency-critical data\r\n *\r\n * @param studentId - Student ID to fetch allergies for\r\n * @returns ActionResult with array of allergy records or error\r\n *\r\n * @example\r\n * ```typescript\r\n * const result = await getStudentAllergiesAction('student-123');\r\n * if (result.success) {\r\n *   console.log('Student allergies:', result.data);\r\n * }\r\n * ```\r\n */\r\nexport async function getStudentAllergiesAction(studentId: string) {\r\n  try {\r\n    const token = await getAuthToken();\r\n    if (!token) {\r\n      throw new Error('Authentication required');\r\n    }\r\n\r\n    const response = await enhancedFetch(`${BACKEND_URL}/allergies?studentId=${studentId}`, {\r\n      method: 'GET',\r\n      next: {\r\n        revalidate: 60, // 1-minute cache for emergency data\r\n        tags: ['allergies', `student-${studentId}-allergies`, 'emergency-phi-data']\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error('Failed to fetch student allergies');\r\n    }\r\n\r\n    const result = await response.json();\r\n\r\n    // HIPAA AUDIT LOG - Emergency PHI access\r\n    const auditContext = await createAuditContext();\r\n    await auditLog({\r\n      ...auditContext,\r\n      action: AUDIT_ACTIONS.VIEW_HEALTH_RECORD,\r\n      resource: 'Allergy',\r\n      details: `Accessed emergency allergy information for student ${studentId}`,\r\n      success: true\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: result.data || result\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to fetch student allergies'\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2590, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/health-records.stats.ts"],"sourcesContent":["/**\r\n * @fileoverview Health Records Statistics and Dashboard Data\r\n * @module lib/actions/health-records.stats\r\n *\r\n * Server actions for retrieving health records statistics and dashboard metrics.\r\n * Enhanced with Next.js v16 'use cache' directive and cacheLife for optimal performance.\r\n * Provides aggregate data for dashboards and reporting interfaces.\r\n */\r\n\r\n'use server';\r\n\r\nimport { cacheLife, cacheTag } from 'next/cache';\r\nimport type { HealthRecordsStats } from './health-records.types';\r\n\r\n/**\r\n * Get Health Records Statistics\r\n * Dashboard overview of health records metrics\r\n * Uses Next.js v16 cache directives for optimal performance\r\n *\r\n * @returns Promise resolving to HealthRecordsStats object\r\n *\r\n * @example\r\n * ```typescript\r\n * const stats = await getHealthRecordsStats();\r\n * console.log('Total records:', stats.totalRecords);\r\n * console.log('Compliance:', stats.compliance, '%');\r\n * ```\r\n */\r\nexport async function getHealthRecordsStats(): Promise<HealthRecordsStats> {\r\n  'use cache';\r\n  cacheLife('medium');\r\n  cacheTag('health-records-stats');\r\n\r\n  try {\r\n    console.log('[Health Records] Loading health records statistics');\r\n\r\n    // In production, this would aggregate data from database\r\n    const stats: HealthRecordsStats = {\r\n      totalRecords: 2847,\r\n      activeConditions: 156,\r\n      criticalAllergies: 28,\r\n      pendingImmunizations: 42,\r\n      recentUpdates: 89,\r\n      compliance: 94.2,\r\n      urgentFollowUps: 12,\r\n      recordTypes: {\r\n        immunizations: 1250,\r\n        allergies: 287,\r\n        conditions: 456,\r\n        vitalSigns: 534,\r\n        medications: 320\r\n      }\r\n    };\r\n\r\n    console.log('[Health Records] Health records statistics loaded successfully');\r\n    return stats;\r\n\r\n  } catch (error) {\r\n    console.error('[Health Records] Failed to load health records statistics:', error);\r\n\r\n    // Return safe defaults on error\r\n    return {\r\n      totalRecords: 0,\r\n      activeConditions: 0,\r\n      criticalAllergies: 0,\r\n      pendingImmunizations: 0,\r\n      recentUpdates: 0,\r\n      compliance: 0,\r\n      urgentFollowUps: 0,\r\n      recordTypes: {\r\n        immunizations: 0,\r\n        allergies: 0,\r\n        conditions: 0,\r\n        vitalSigns: 0,\r\n        medications: 0\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Health Records Dashboard Data\r\n * Combined dashboard data for health records overview\r\n * Uses Next.js v16 cache directives with medium cache life\r\n *\r\n * @returns Promise resolving to object with stats property\r\n *\r\n * @example\r\n * ```typescript\r\n * const dashboard = await getHealthRecordsDashboardData();\r\n * console.log('Dashboard stats:', dashboard.stats);\r\n * ```\r\n */\r\nexport async function getHealthRecordsDashboardData() {\r\n  try {\r\n    console.log('[Health Records] Loading dashboard data');\r\n\r\n    const stats = await getHealthRecordsStats();\r\n\r\n    console.log('[Health Records] Dashboard data loaded successfully');\r\n    return { stats };\r\n\r\n  } catch (error) {\r\n    console.error('[Health Records] Failed to load dashboard data:', error);\r\n\r\n    return {\r\n      stats: await getHealthRecordsStats() // Will return safe defaults\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;CAOC;;;;;;;;;;AAID;;;;;IAiBO,6SAAA,eAAe;IAEpB,IAAA,0IAAS,EAAC;IACV,IAAA,yIAAQ,EAAC;IAET,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,yDAAyD;QACzD,MAAM,QAA4B;YAChC,cAAc;YACd,kBAAkB;YAClB,mBAAmB;YACnB,sBAAsB;YACtB,eAAe;YACf,YAAY;YACZ,iBAAiB;YACjB,aAAa;gBACX,eAAe;gBACf,WAAW;gBACX,YAAY;gBACZ,YAAY;gBACZ,aAAa;YACf;QACF;QAEA,QAAQ,GAAG,CAAC;QACZ,OAAO;IAET,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8DAA8D;QAE5E,gCAAgC;QAChC,OAAO;YACL,cAAc;YACd,kBAAkB;YAClB,mBAAmB;YACnB,sBAAsB;YACtB,eAAe;YACf,YAAY;YACZ,iBAAiB;YACjB,aAAa;gBACX,eAAe;gBACf,WAAW;gBACX,YAAY;gBACZ,YAAY;gBACZ,aAAa;YACf;QACF;IACF;AACF;;;;;;IAlDsB;AAiEf,eAAe;IACpB,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,MAAM,QAAQ,MAAM;QAEpB,QAAQ,GAAG,CAAC;QACZ,OAAO;YAAE;QAAM;IAEjB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mDAAmD;QAEjE,OAAO;YACL,OAAO,MAAM,wBAAwB,4BAA4B;QACnE;IACF;AACF;;;IAhBsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 2687, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/health-records.actions.ts"],"sourcesContent":["/**\r\n * @fileoverview Server Actions for Health Records Module\r\n * @module app/health-records/actions\r\n *\r\n * Next.js v16 App Router Server Actions for health records, immunizations, allergies, vital signs, and conditions.\r\n * HIPAA CRITICAL: ALL operations include mandatory audit logging for PHI access.\r\n * Enhanced with Next.js v16 caching capabilities and revalidation patterns.\r\n *\r\n * This module serves as the main entry point and re-exports specialized modules:\r\n * - health-records.types.ts - Type definitions and interfaces\r\n * - health-records.utils.ts - Shared utilities and authentication helpers\r\n * - health-records.crud.ts - Core CRUD operations for health records\r\n * - health-records.immunizations.ts - Immunization/vaccination record operations\r\n * - health-records.allergies.ts - Allergy record operations (emergency-critical PHI)\r\n * - health-records.stats.ts - Statistics and dashboard data operations\r\n *\r\n * NOTE: This file does NOT have 'use server' directive because it only re-exports\r\n * server actions from other files. The 'use server' directive is in the individual\r\n * implementation files (crud, immunizations, allergies, stats).\r\n *\r\n * @example\r\n * ```typescript\r\n * 'use client';\r\n *\r\n * import { useActionState } from 'react';\r\n * import { createHealthRecordAction } from '@/lib/actions/health-records.actions';\r\n *\r\n * function HealthRecordForm() {\r\n *   const [state, formAction, isPending] = useActionState(createHealthRecordAction, { errors: {} });\r\n *   return <form action={formAction}>...</form>;\r\n * }\r\n * ```\r\n */\r\n\r\n// ==========================================\r\n// TYPE DEFINITIONS\r\n// ==========================================\r\n\r\nexport type { ActionResult, HealthRecordsStats } from './health-records.types';\r\n\r\n// ==========================================\r\n// NOTE: Utility functions and constants are NOT re-exported here\r\n// because \"use server\" files can only export async functions.\r\n// Import directly from './health-records.utils' if needed.\r\n// ==========================================\r\n\r\n// ==========================================\r\n// HEALTH RECORD CRUD ACTIONS\r\n// ==========================================\r\n\r\nexport {\r\n  createHealthRecordAction,\r\n  getHealthRecordsAction,\r\n  updateHealthRecordAction,\r\n  deleteHealthRecordAction\r\n} from './health-records.crud';\r\n\r\n// ==========================================\r\n// IMMUNIZATION ACTIONS\r\n// ==========================================\r\n\r\nexport {\r\n  createImmunizationAction\r\n} from './health-records.immunizations';\r\n\r\n// ==========================================\r\n// ALLERGY ACTIONS\r\n// ==========================================\r\n\r\nexport {\r\n  createAllergyAction,\r\n  getStudentAllergiesAction\r\n} from './health-records.allergies';\r\n\r\n// ==========================================\r\n// STATISTICS AND DASHBOARD ACTIONS\r\n// ==========================================\r\n\r\nexport {\r\n  getHealthRecordsStats,\r\n  getHealthRecordsDashboardData\r\n} from './health-records.stats';\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAgCC,GAED,6CAA6C;AAC7C,mBAAmB;AACnB,6CAA6C;;AAI7C,6CAA6C;AAC7C,iEAAiE;AACjE,8DAA8D;AAC9D,2DAA2D;AAC3D,6CAA6C;AAE7C,6CAA6C;AAC7C,6BAA6B;AAC7B,6CAA6C;AAE7C;AAOA,6CAA6C;AAC7C,uBAAuB;AACvB,6CAA6C;AAE7C;AAIA,6CAA6C;AAC7C,kBAAkB;AAClB,6CAA6C;AAE7C;AAKA,6CAA6C;AAC7C,mCAAmC;AACnC,6CAA6C;AAE7C","debugId":null}},
    {"offset": {"line": 2752, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/app/%28dashboard%29/health-records/page.tsx"],"sourcesContent":["/**\r\n * @fileoverview Health Records Page - Comprehensive health record management\r\n * @module app/(dashboard)/health-records/page\r\n * @category Health Records - Main Page\r\n */\r\n\r\nimport { Metadata } from 'next';\r\nimport { Suspense } from 'react';\r\nimport Link from 'next/link';\r\nimport { PageHeader } from '@/components/layouts/PageHeader';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Plus, FileHeart, BarChart3 } from 'lucide-react';\r\nimport { HealthRecordsContent } from './_components/HealthRecordsContent';\r\nimport { HealthRecordsFilters } from './_components/HealthRecordsFilters';\r\nimport { getHealthRecordsAction } from '@/lib/actions/health-records.actions';\r\n\r\nexport const metadata: Metadata = {\r\n  title: 'Health Records',\r\n  description: 'Comprehensive health record management system for student healthcare with medical history, immunizations, allergies, vital signs, and HIPAA-compliant documentation.',\r\n  keywords: [\r\n    'health records',\r\n    'medical history',\r\n    'immunizations',\r\n    'allergies',\r\n    'vital signs',\r\n    'medical documentation',\r\n    'HIPAA compliant',\r\n    'health tracking'\r\n  ],\r\n  openGraph: {\r\n    title: 'Health Records | White Cross Healthcare',\r\n    description: 'Secure health record management system with comprehensive medical documentation and HIPAA compliance.',\r\n    type: 'website',\r\n  },\r\n  robots: {\r\n    index: false,\r\n    follow: false,\r\n  },\r\n};\r\n\r\ninterface HealthRecordsPageProps {\r\n  searchParams: Promise<{\r\n    page?: string;\r\n    limit?: string;\r\n    type?: string;\r\n    status?: string;\r\n    priority?: string;\r\n    search?: string;\r\n    dateFrom?: string;\r\n    dateTo?: string;\r\n    studentId?: string;\r\n    recordedBy?: string;\r\n  }>;\r\n}\r\n\r\nfunction HealthRecordsPageSkeleton() {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"space-y-4\">\r\n            <Skeleton className=\"h-8 w-48\" />\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n              {[1, 2, 3].map((i) => (\r\n                <Skeleton key={i} className=\"h-20 w-full\" />\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n      \r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <Skeleton className=\"h-96 w-full\" />\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\nasync function HealthRecordsFiltersWrapper({ searchParams }: { searchParams: HealthRecordsPageProps['searchParams'] }) {\r\n  // Await the searchParams Promise\r\n  const resolvedSearchParams = await searchParams;\r\n  \r\n  // Fetch health records to get the total count\r\n  const result = await getHealthRecordsAction(resolvedSearchParams.studentId, resolvedSearchParams.type);\r\n  const totalCount = result.success ? (result.data?.length || 0) : 0;\r\n  \r\n  return <HealthRecordsFilters totalCount={totalCount} />;\r\n}\r\n\r\nexport default async function HealthRecordsPage({ searchParams }: HealthRecordsPageProps) {\r\n  const resolvedSearchParams = await searchParams;\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Health Records\"\r\n        description=\"Comprehensive health record management for student healthcare\"\r\n        actions={\r\n          <div className=\"flex gap-2\">\r\n            <Link href=\"/health-records/reports\">\r\n              <Button variant=\"outline\" size=\"sm\">\r\n                <BarChart3 className=\"h-4 w-4 mr-2\" />\r\n                Reports\r\n              </Button>\r\n            </Link>\r\n            <Link href=\"/health-records/timeline\">\r\n              <Button variant=\"outline\" size=\"sm\">\r\n                <FileHeart className=\"h-4 w-4 mr-2\" />\r\n                Timeline\r\n              </Button>\r\n            </Link>\r\n            <Link href=\"/health-records/new\">\r\n              <Button size=\"sm\">\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                New Record\r\n              </Button>\r\n            </Link>\r\n          </div>\r\n        }\r\n      />\r\n\r\n      <div className=\"space-y-6\">\r\n        <Suspense fallback={<Skeleton className=\"h-32 w-full\" />}>\r\n          <HealthRecordsFiltersWrapper searchParams={searchParams} />\r\n        </Suspense>\r\n\r\n        <Suspense fallback={<HealthRecordsPageSkeleton />}>\r\n          <HealthRecordsContent searchParams={resolvedSearchParams} />\r\n        </Suspense>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;AAEO,MAAM,WAAqB;IAChC,OAAO;IACP,aAAa;IACb,UAAU;QACR;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,WAAW;QACT,OAAO;QACP,aAAa;QACb,MAAM;IACR;IACA,QAAQ;QACN,OAAO;QACP,QAAQ;IACV;AACF;AAiBA,SAAS;IACP,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC,wIAAI;0BACH,cAAA,8OAAC,+IAAW;oBAAC,WAAU;8BACrB,cAAA,8OAAC;wBAAI,WAAU;;0CACb,8OAAC,gJAAQ;gCAAC,WAAU;;;;;;0CACpB,8OAAC;gCAAI,WAAU;0CACZ;oCAAC;oCAAG;oCAAG;iCAAE,CAAC,GAAG,CAAC,CAAC,kBACd,8OAAC,gJAAQ;wCAAS,WAAU;uCAAb;;;;;;;;;;;;;;;;;;;;;;;;;;0BAOzB,8OAAC,wIAAI;0BACH,cAAA,8OAAC,+IAAW;oBAAC,WAAU;8BACrB,cAAA,8OAAC,gJAAQ;wBAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;AAK9B;AAEA,eAAe,4BAA4B,EAAE,YAAY,EAA4D;IACnH,iCAAiC;IACjC,MAAM,uBAAuB,MAAM;IAEnC,8CAA8C;IAC9C,MAAM,SAAS,MAAM,IAAA,4KAAsB,EAAC,qBAAqB,SAAS,EAAE,qBAAqB,IAAI;IACrG,MAAM,aAAa,OAAO,OAAO,GAAI,OAAO,IAAI,EAAE,UAAU,IAAK;IAEjE,qBAAO,8OAAC,gNAAoB;QAAC,YAAY;;;;;;AAC3C;AAEe,eAAe,kBAAkB,EAAE,YAAY,EAA0B;IACtF,MAAM,uBAAuB,MAAM;IACnC,qBACE;;0BACE,8OAAC,yJAAU;gBACT,OAAM;gBACN,aAAY;gBACZ,uBACE,8OAAC;oBAAI,WAAU;;sCACb,8OAAC,0LAAI;4BAAC,MAAK;sCACT,cAAA,8OAAC,4IAAM;gCAAC,SAAQ;gCAAU,MAAK;;kDAC7B,8OAAC,+NAAS;wCAAC,WAAU;;;;;;oCAAiB;;;;;;;;;;;;sCAI1C,8OAAC,0LAAI;4BAAC,MAAK;sCACT,cAAA,8OAAC,4IAAM;gCAAC,SAAQ;gCAAU,MAAK;;kDAC7B,8OAAC,6NAAS;wCAAC,WAAU;;;;;;oCAAiB;;;;;;;;;;;;sCAI1C,8OAAC,0LAAI;4BAAC,MAAK;sCACT,cAAA,8OAAC,4IAAM;gCAAC,MAAK;;kDACX,8OAAC,0MAAI;wCAAC,WAAU;;;;;;oCAAiB;;;;;;;;;;;;;;;;;;;;;;;0BAQ3C,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,iNAAQ;wBAAC,wBAAU,8OAAC,gJAAQ;4BAAC,WAAU;;;;;;kCACtC,cAAA,8OAAC;4BAA4B,cAAc;;;;;;;;;;;kCAG7C,8OAAC,iNAAQ;wBAAC,wBAAU,8OAAC;;;;;kCACnB,cAAA,8OAAC,gNAAoB;4BAAC,cAAc;;;;;;;;;;;;;;;;;;;AAK9C","debugId":null}}]
}