{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/identity-access/lib/config/cookies.ts"],"sourcesContent":["/**\r\n * @fileoverview Centralized Cookie Configuration\r\n * @module lib/config/cookies\r\n *\r\n * Single source of truth for all authentication cookie settings.\r\n * Implements security best practices including:\r\n * - __Host- prefix for maximum security\r\n * - Consistent naming across the application\r\n * - Secure defaults for production environments\r\n * - HIPAA-compliant session management\r\n *\r\n * Security Features:\r\n * - __Host- prefix prevents subdomain and path manipulation\r\n * - httpOnly prevents XSS attacks\r\n * - secure ensures HTTPS-only transmission\r\n * - sameSite prevents CSRF attacks\r\n * - Appropriate maxAge for healthcare security requirements\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie\r\n * @see https://web.dev/first-party-cookie-recipes/\r\n */\r\n\r\nimport { ResponseCookie } from 'next/dist/compiled/@edge-runtime/cookies';\r\n\r\n/**\r\n * Cookie names with __Host- prefix for maximum security\r\n *\r\n * The __Host- prefix ensures:\r\n * - Cookie must be set with Secure flag\r\n * - Cookie must be set from a secure origin (HTTPS)\r\n * - Cookie must NOT have a Domain attribute (preventing subdomain access)\r\n * - Cookie path must be /\r\n *\r\n * NOTE: __Host- prefix requires HTTPS. In development (localhost), we use\r\n * regular cookie names without the prefix.\r\n */\r\nexport const COOKIE_NAMES = {\r\n  /** Access token for API authentication */\r\n  ACCESS_TOKEN: process.env.NODE_ENV === 'production' ? '__Host-auth.token' : 'auth.token',\r\n\r\n  /** Refresh token for obtaining new access tokens */\r\n  REFRESH_TOKEN: process.env.NODE_ENV === 'production' ? '__Host-auth.refresh' : 'auth.refresh',\r\n\r\n  /** Session identifier (if using session-based auth alongside JWT) */\r\n  SESSION_ID: process.env.NODE_ENV === 'production' ? '__Host-auth.session' : 'auth.session',\r\n} as const;\r\n\r\n/**\r\n * Cookie expiration times in seconds\r\n */\r\nexport const COOKIE_MAX_AGE = {\r\n  /** Access token: 1 hour (short-lived for security) */\r\n  ACCESS_TOKEN: 60 * 60,\r\n\r\n  /** Refresh token: 7 days (allows persistent login) */\r\n  REFRESH_TOKEN: 7 * 24 * 60 * 60,\r\n\r\n  /** Session: 24 hours (daily re-authentication for HIPAA compliance) */\r\n  SESSION: 24 * 60 * 60,\r\n} as const;\r\n\r\n/**\r\n * Base cookie options for all authentication cookies\r\n * These settings ensure maximum security\r\n */\r\nconst BASE_COOKIE_OPTIONS: Partial<ResponseCookie> = {\r\n  /** Path where cookie is valid */\r\n  path: '/',\r\n\r\n  /** Prevent JavaScript access (XSS protection) */\r\n  httpOnly: true,\r\n\r\n  /** Strict CSRF protection - cookie only sent to same-site requests */\r\n  sameSite: 'strict',\r\n\r\n  /** Only send over HTTPS in production */\r\n  secure: process.env.NODE_ENV === 'production',\r\n} as const;\r\n\r\n/**\r\n * Get cookie options for access token\r\n *\r\n * @param overrides - Optional overrides for specific use cases\r\n * @returns Complete cookie configuration for access token\r\n *\r\n * @example\r\n * ```typescript\r\n * import { cookies } from 'next/headers';\r\n * import { getAccessTokenCookieOptions, COOKIE_NAMES } from './config/cookies';\r\n *\r\n * const cookieStore = await cookies();\r\n * cookieStore.set(COOKIE_NAMES.ACCESS_TOKEN, token, getAccessTokenCookieOptions());\r\n * ```\r\n */\r\nexport function getAccessTokenCookieOptions(\r\n  overrides?: Partial<ResponseCookie>\r\n): ResponseCookie {\r\n  return {\r\n    ...BASE_COOKIE_OPTIONS,\r\n    maxAge: COOKIE_MAX_AGE.ACCESS_TOKEN,\r\n    ...overrides,\r\n  } as ResponseCookie;\r\n}\r\n\r\n/**\r\n * Get cookie options for refresh token\r\n *\r\n * @param overrides - Optional overrides for specific use cases\r\n * @returns Complete cookie configuration for refresh token\r\n *\r\n * @example\r\n * ```typescript\r\n * cookieStore.set(COOKIE_NAMES.REFRESH_TOKEN, refreshToken, getRefreshTokenCookieOptions());\r\n * ```\r\n */\r\nexport function getRefreshTokenCookieOptions(\r\n  overrides?: Partial<ResponseCookie>\r\n): ResponseCookie {\r\n  return {\r\n    ...BASE_COOKIE_OPTIONS,\r\n    maxAge: COOKIE_MAX_AGE.REFRESH_TOKEN,\r\n    ...overrides,\r\n  } as ResponseCookie;\r\n}\r\n\r\n/**\r\n * Get cookie options for session identifier\r\n *\r\n * @param overrides - Optional overrides for specific use cases\r\n * @returns Complete cookie configuration for session\r\n *\r\n * @example\r\n * ```typescript\r\n * cookieStore.set(COOKIE_NAMES.SESSION_ID, sessionId, getSessionCookieOptions());\r\n * ```\r\n */\r\nexport function getSessionCookieOptions(\r\n  overrides?: Partial<ResponseCookie>\r\n): ResponseCookie {\r\n  return {\r\n    ...BASE_COOKIE_OPTIONS,\r\n    maxAge: COOKIE_MAX_AGE.SESSION,\r\n    ...overrides,\r\n  } as ResponseCookie;\r\n}\r\n\r\n/**\r\n * Legacy cookie names for migration support\r\n * These should be removed in a future version\r\n *\r\n * @deprecated Use COOKIE_NAMES instead\r\n */\r\nexport const LEGACY_COOKIE_NAMES = {\r\n  auth_token: 'auth_token',\r\n  refresh_token: 'refresh_token',\r\n  authToken: 'authToken',\r\n  refreshToken: 'refreshToken',\r\n} as const;\r\n\r\n/**\r\n * Clear all authentication cookies\r\n * Useful for logout operations\r\n *\r\n * @param cookieStore - Next.js cookies() instance\r\n *\r\n * @example\r\n * ```typescript\r\n * import { cookies } from 'next/headers';\r\n * import { clearAuthCookies } from './config/cookies';\r\n *\r\n * export async function logout() {\r\n *   const cookieStore = await cookies();\r\n *   clearAuthCookies(cookieStore);\r\n * }\r\n * ```\r\n */\r\nexport async function clearAuthCookies(\r\n  cookieStore: Awaited<ReturnType<typeof import('next/headers').cookies>>\r\n): Promise<void> {\r\n  // Clear current cookies\r\n  cookieStore.delete(COOKIE_NAMES.ACCESS_TOKEN);\r\n  cookieStore.delete(COOKIE_NAMES.REFRESH_TOKEN);\r\n  cookieStore.delete(COOKIE_NAMES.SESSION_ID);\r\n\r\n  // Clear legacy cookies for migration\r\n  Object.values(LEGACY_COOKIE_NAMES).forEach((name) => {\r\n    cookieStore.delete(name);\r\n  });\r\n}\r\n\r\n/**\r\n * Get token from cookies with fallback to legacy names\r\n * This supports migration from old cookie names to new secure names\r\n *\r\n * @param cookieStore - Next.js cookies() instance\r\n * @returns Access token if found, null otherwise\r\n *\r\n * @example\r\n * ```typescript\r\n * const token = getAccessTokenFromCookies(await cookies());\r\n * if (token) {\r\n *   // Verify and use token\r\n * }\r\n * ```\r\n */\r\nexport function getAccessTokenFromCookies(\r\n  cookieStore: Awaited<ReturnType<typeof import('next/headers').cookies>>\r\n): string | null {\r\n  // Try new secure cookie name first\r\n  let token = cookieStore.get(COOKIE_NAMES.ACCESS_TOKEN)?.value;\r\n\r\n  if (token) {\r\n    return token;\r\n  }\r\n\r\n  // Fall back to legacy names for migration\r\n  for (const legacyName of Object.values(LEGACY_COOKIE_NAMES)) {\r\n    token = cookieStore.get(legacyName)?.value;\r\n    if (token) {\r\n      console.warn(\r\n        `[Cookie Migration] Found token in legacy cookie '${legacyName}'. ` +\r\n        `Please migrate to '${COOKIE_NAMES.ACCESS_TOKEN}' for improved security.`\r\n      );\r\n      return token;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Get refresh token from cookies with fallback to legacy names\r\n *\r\n * @param cookieStore - Next.js cookies() instance\r\n * @returns Refresh token if found, null otherwise\r\n */\r\nexport function getRefreshTokenFromCookies(\r\n  cookieStore: Awaited<ReturnType<typeof import('next/headers').cookies>>\r\n): string | null {\r\n  // Try new secure cookie name first\r\n  const token = cookieStore.get(COOKIE_NAMES.REFRESH_TOKEN)?.value;\r\n\r\n  if (token) {\r\n    return token;\r\n  }\r\n\r\n  // Fall back to legacy refresh_token\r\n  const legacyToken = cookieStore.get(LEGACY_COOKIE_NAMES.refresh_token)?.value ||\r\n                      cookieStore.get(LEGACY_COOKIE_NAMES.refreshToken)?.value;\r\n\r\n  if (legacyToken) {\r\n    console.warn(\r\n      '[Cookie Migration] Found refresh token in legacy cookie. ' +\r\n      `Please migrate to '${COOKIE_NAMES.REFRESH_TOKEN}' for improved security.`\r\n    );\r\n  }\r\n\r\n  return legacyToken || null;\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;CAoBC;;;;;;;;;;;;;;;;;;;;AAgBM,MAAM,eAAe;IAC1B,wCAAwC,GACxC,cAAc,sCAAwC,0BAAsB;IAE5E,kDAAkD,GAClD,eAAe,sCAAwC,0BAAwB;IAE/E,mEAAmE,GACnE,YAAY,sCAAwC,0BAAwB;AAC9E;AAKO,MAAM,iBAAiB;IAC5B,oDAAoD,GACpD,cAAc,KAAK;IAEnB,oDAAoD,GACpD,eAAe,IAAI,KAAK,KAAK;IAE7B,qEAAqE,GACrE,SAAS,KAAK,KAAK;AACrB;AAEA;;;CAGC,GACD,MAAM,sBAA+C;IACnD,+BAA+B,GAC/B,MAAM;IAEN,+CAA+C,GAC/C,UAAU;IAEV,oEAAoE,GACpE,UAAU;IAEV,uCAAuC,GACvC,QAAQ,oDAAyB;AACnC;AAiBO,SAAS,4BACd,SAAmC;IAEnC,OAAO;QACL,GAAG,mBAAmB;QACtB,QAAQ,eAAe,YAAY;QACnC,GAAG,SAAS;IACd;AACF;AAaO,SAAS,6BACd,SAAmC;IAEnC,OAAO;QACL,GAAG,mBAAmB;QACtB,QAAQ,eAAe,aAAa;QACpC,GAAG,SAAS;IACd;AACF;AAaO,SAAS,wBACd,SAAmC;IAEnC,OAAO;QACL,GAAG,mBAAmB;QACtB,QAAQ,eAAe,OAAO;QAC9B,GAAG,SAAS;IACd;AACF;AAQO,MAAM,sBAAsB;IACjC,YAAY;IACZ,eAAe;IACf,WAAW;IACX,cAAc;AAChB;AAmBO,eAAe,iBACpB,WAAuE;IAEvE,wBAAwB;IACxB,YAAY,MAAM,CAAC,aAAa,YAAY;IAC5C,YAAY,MAAM,CAAC,aAAa,aAAa;IAC7C,YAAY,MAAM,CAAC,aAAa,UAAU;IAE1C,qCAAqC;IACrC,OAAO,MAAM,CAAC,qBAAqB,OAAO,CAAC,CAAC;QAC1C,YAAY,MAAM,CAAC;IACrB;AACF;AAiBO,SAAS,0BACd,WAAuE;IAEvE,mCAAmC;IACnC,IAAI,QAAQ,YAAY,GAAG,CAAC,aAAa,YAAY,GAAG;IAExD,IAAI,OAAO;QACT,OAAO;IACT;IAEA,0CAA0C;IAC1C,KAAK,MAAM,cAAc,OAAO,MAAM,CAAC,qBAAsB;QAC3D,QAAQ,YAAY,GAAG,CAAC,aAAa;QACrC,IAAI,OAAO;YACT,QAAQ,IAAI,CACV,CAAC,iDAAiD,EAAE,WAAW,GAAG,CAAC,GACnE,CAAC,mBAAmB,EAAE,aAAa,YAAY,CAAC,wBAAwB,CAAC;YAE3E,OAAO;QACT;IACF;IAEA,OAAO;AACT;AAQO,SAAS,2BACd,WAAuE;IAEvE,mCAAmC;IACnC,MAAM,QAAQ,YAAY,GAAG,CAAC,aAAa,aAAa,GAAG;IAE3D,IAAI,OAAO;QACT,OAAO;IACT;IAEA,oCAAoC;IACpC,MAAM,cAAc,YAAY,GAAG,CAAC,oBAAoB,aAAa,GAAG,SACpD,YAAY,GAAG,CAAC,oBAAoB,YAAY,GAAG;IAEvE,IAAI,aAAa;QACf,QAAQ,IAAI,CACV,8DACA,CAAC,mBAAmB,EAAE,aAAa,aAAa,CAAC,wBAAwB,CAAC;IAE9E;IAEA,OAAO,eAAe;AACxB","debugId":null}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/api/nextjs-client.ts"],"sourcesContent":["/**\r\n * @fileoverview Next.js Fetch-Based API Client\r\n * @module lib/api/nextjs-client\r\n * @category API Client\r\n *\r\n * Enterprise-grade HTTP client built on Next.js native fetch API with comprehensive\r\n * caching, revalidation, and error handling capabilities.\r\n *\r\n * Key Features:\r\n * - Native Next.js fetch with automatic request deduplication\r\n * - Cache configuration (cache, revalidate, tags)\r\n * - cacheLife support for Next.js 15+\r\n * - Type-safe HTTP methods (GET, POST, PUT, PATCH, DELETE)\r\n * - Automatic authentication token injection\r\n * - CSRF protection headers\r\n * - Comprehensive error handling and retry logic\r\n * - Request ID generation for tracing\r\n * - HIPAA-compliant audit logging integration\r\n *\r\n * This client is designed to replace axios-based clients in Server Components\r\n * and Server Actions, enabling full integration with Next.js caching system.\r\n *\r\n * @example\r\n * ```typescript\r\n * // In a Server Component\r\n * const students = await serverGet<Student[]>('/api/students', {\r\n *   cache: 'force-cache',\r\n *   next: {\r\n *     revalidate: CACHE_TTL.PHI_STANDARD,\r\n *     tags: [CACHE_TAGS.STUDENTS, CACHE_TAGS.PHI]\r\n *   }\r\n * });\r\n *\r\n * // In a Server Action\r\n * const result = await serverPost<Student>('/api/students', data, {\r\n *   cache: 'no-store',\r\n *   next: { tags: [CACHE_TAGS.STUDENTS] }\r\n * });\r\n * ```\r\n *\r\n * @version 1.0.0\r\n * @since 2025-10-31\r\n */\r\n\r\nimport { cookies, headers } from 'next/headers';\r\nimport { redirect } from 'next/navigation';\r\nimport { COOKIE_NAMES } from '@/identity-access/lib/config/cookies';\r\n\r\n// ==========================================\r\n// TYPE DEFINITIONS\r\n// ==========================================\r\n\r\n/**\r\n * Simple API client options for basic HTTP requests\r\n * @deprecated Consider using NextFetchOptions for new code\r\n */\r\nexport interface ApiClientOptions {\r\n  method?: string\r\n  body?: unknown\r\n  headers?: Record<string, string>\r\n}\r\n\r\n/**\r\n * Next.js cache configuration options\r\n */\r\nexport interface NextCacheConfig {\r\n  /**\r\n   * Cache behavior\r\n   * - 'force-cache': Cache the response (default for GET)\r\n   * - 'no-store': Never cache the response (default for mutations)\r\n   * - 'reload': Bypass cache and revalidate\r\n   * - 'no-cache': Cache but always revalidate\r\n   * - 'force-cache': Use cache if available, fetch if not\r\n   * - 'only-if-cached': Use cache only, fail if not cached\r\n   */\r\n  cache?: RequestCache;\r\n\r\n  /**\r\n   * Next.js-specific cache options\r\n   */\r\n  next?: {\r\n    /**\r\n     * Time in seconds to revalidate cache\r\n     * - number: Revalidate after N seconds\r\n     * - false: Never revalidate (cache indefinitely)\r\n     * - 0: Revalidate immediately (effectively no-store)\r\n     */\r\n    revalidate?: number | false;\r\n\r\n    /**\r\n     * Cache tags for granular invalidation via revalidateTag()\r\n     * @example ['students', 'phi-data']\r\n     */\r\n    tags?: string[];\r\n  };\r\n}\r\n\r\n/**\r\n * cacheLife profiles for Next.js 15+ advanced caching\r\n * @see https://nextjs.org/docs/app/api-reference/next-config-js/cacheLife\r\n */\r\nexport interface CacheLifeConfig {\r\n  /**\r\n   * Time to live in seconds\r\n   */\r\n  ttl: number;\r\n\r\n  /**\r\n   * Stale-while-revalidate window in seconds\r\n   */\r\n  stale?: number;\r\n\r\n  /**\r\n   * Maximum age in cache regardless of revalidation\r\n   */\r\n  max?: number;\r\n}\r\n\r\n/**\r\n * Extended fetch options with Next.js caching and authentication\r\n */\r\nexport interface NextFetchOptions extends RequestInit {\r\n  /**\r\n   * Whether to include authentication token\r\n   * @default true\r\n   */\r\n  requiresAuth?: boolean;\r\n\r\n  /**\r\n   * Cache behavior configuration\r\n   */\r\n  cache?: RequestCache;\r\n\r\n  /**\r\n   * Next.js-specific cache options\r\n   */\r\n  next?: {\r\n    revalidate?: number | false;\r\n    tags?: string[];\r\n  };\r\n\r\n  /**\r\n   * cacheLife profile (Next.js 15+)\r\n   */\r\n  cacheLife?: string | CacheLifeConfig;\r\n\r\n  /**\r\n   * Retry configuration\r\n   */\r\n  retry?: {\r\n    attempts: number;\r\n    delay: number;\r\n  };\r\n\r\n  /**\r\n   * Custom error handler\r\n   */\r\n  onError?: (error: Error) => void;\r\n\r\n  /**\r\n   * Request timeout in milliseconds\r\n   */\r\n  timeout?: number;\r\n}\r\n\r\n/**\r\n * Standardized API response wrapper\r\n */\r\nexport interface ApiResponse<T = unknown> {\r\n  success: boolean;\r\n  data: T;\r\n  message?: string;\r\n  errors?: Record<string, string[]>;\r\n}\r\n\r\n/**\r\n * API error response structure\r\n */\r\nexport interface ApiErrorResponse {\r\n  message: string;\r\n  code?: string;\r\n  status?: number;\r\n  details?: unknown;\r\n  field?: string;\r\n  traceId?: string;\r\n  timestamp?: string;\r\n}\r\n\r\n/**\r\n * Custom error class for Next.js API client errors\r\n *\r\n * @class\r\n * @extends Error\r\n * @classdesc Wraps API errors with metadata and automatic classification\r\n */\r\nexport class NextApiClientError extends Error {\r\n  public readonly code?: string;\r\n  public readonly status?: number;\r\n  public readonly details?: unknown;\r\n  public readonly traceId?: string;\r\n  public readonly isNetworkError: boolean;\r\n  public readonly isServerError: boolean;\r\n  public readonly isValidationError: boolean;\r\n\r\n  constructor(error: ApiErrorResponse) {\r\n    super(error.message);\r\n    this.name = 'NextApiClientError';\r\n    this.code = error.code;\r\n    this.status = error.status;\r\n    this.details = error.details;\r\n    this.traceId = error.traceId;\r\n\r\n    // Classify error types\r\n    this.isNetworkError = error.code === 'NETWORK_ERROR';\r\n    this.isServerError = (error.status ?? 0) >= 500;\r\n    this.isValidationError = error.status === 400;\r\n\r\n    // Maintain proper stack trace\r\n    if (typeof Error.captureStackTrace === 'function') {\r\n      Error.captureStackTrace(this, NextApiClientError);\r\n    }\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// CONFIGURATION\r\n// ==========================================\r\n\r\n/**\r\n * Get API base URL from environment\r\n */\r\nfunction getApiBaseUrl(): string {\r\n  return process.env.API_BASE_URL ||\r\n         process.env.NEXT_PUBLIC_API_URL ||\r\n         'http://localhost:3001';\r\n}\r\n\r\n/**\r\n * Get authentication token from production-ready httpOnly cookies\r\n * Uses the existing JWT-based authentication system\r\n */\r\nasync function getAuthToken(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await cookies();\r\n    \r\n    // Try multiple cookie names that might be used for the auth token\r\n    const token = cookieStore.get(COOKIE_NAMES.ACCESS_TOKEN)?.value ||\r\n                  cookieStore.get('auth.token')?.value ||\r\n                  cookieStore.get('auth_token')?.value ||\r\n                  cookieStore.get('accessToken')?.value;\r\n    \r\n    return token || null;\r\n  } catch (error) {\r\n    console.error('[Next API Client] Failed to get auth token:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Generate unique request ID for tracing\r\n * Made dynamic to avoid prerendering issues\r\n */\r\nfunction generateRequestId(): string {\r\n  // Access headers first to make this function dynamic during prerendering\r\n  headers();\r\n  return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Get CSRF token from cookies\r\n */\r\nasync function getCsrfToken(): Promise<string | null> {\r\n  try {\r\n    const cookieStore = await cookies();\r\n    return cookieStore.get('csrf-token')?.value || null;\r\n  } catch (error) {\r\n    console.error('[Next API Client] Failed to get CSRF token:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// CORE FETCH FUNCTION\r\n// ==========================================\r\n\r\n/**\r\n * Core fetch function with Next.js caching, authentication, and error handling\r\n *\r\n * @template T - The expected response data type\r\n * @param endpoint - API endpoint (relative or absolute URL)\r\n * @param options - Fetch options with Next.js caching configuration\r\n * @returns Promise resolving to typed API response\r\n *\r\n * @throws {NextApiClientError} On request failure\r\n *\r\n * @example\r\n * ```typescript\r\n * const response = await nextFetch<Student[]>('/api/students', {\r\n *   cache: 'force-cache',\r\n *   next: { revalidate: 60, tags: ['students'] }\r\n * });\r\n * ```\r\n */\r\nexport async function nextFetch<T>(\r\n  endpoint: string,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  const {\r\n    requiresAuth = true, // Enable authentication by default\r\n    onError,\r\n    retry = { attempts: 3, delay: 1000 },\r\n    timeout = 30000,\r\n    cache = 'force-cache',\r\n    next,\r\n    cacheLife,\r\n    ...fetchOptions\r\n  } = options;\r\n\r\n  // Build full URL\r\n  const url = endpoint.startsWith('http')\r\n    ? endpoint\r\n    : `${getApiBaseUrl()}${endpoint}`;\r\n\r\n  // Prepare headers\r\n  const headers: Record<string, string> = {\r\n    'Content-Type': 'application/json',\r\n  };\r\n\r\n  // Merge additional headers\r\n  if (fetchOptions.headers) {\r\n    Object.entries(fetchOptions.headers).forEach(([key, value]) => {\r\n      if (typeof value === 'string') {\r\n        headers[key] = value;\r\n      }\r\n    });\r\n  }\r\n\r\n  // Add authentication if required\r\n  if (requiresAuth) {\r\n    const token = await getAuthToken();\r\n\r\n    // Don't redirect during login/auth endpoints\r\n    const isAuthEndpoint = endpoint.includes('/auth/') || \r\n                          endpoint.includes('/login') || \r\n                          endpoint.includes('/register') ||\r\n                          endpoint.includes('/forgot-password') ||\r\n                          endpoint.includes('/reset-password');\r\n\r\n    console.log('[Next API Client] Auth check:', {\r\n      endpoint,\r\n      hasToken: !!token,\r\n      tokenStart: token?.substring(0, 20),\r\n      isAuthEndpoint,\r\n      requiresAuth\r\n    });\r\n\r\n    if (!token && !isAuthEndpoint) {\r\n      // Redirect to login if no token (but not during auth operations)\r\n      console.error('[Next API Client] No auth token found for protected endpoint:', endpoint);\r\n      // Note: redirect() in server components/actions can cause issues\r\n      // Consider using middleware for auth protection instead\r\n      redirect('/login');\r\n    }\r\n\r\n    if (token) {\r\n      headers['Authorization'] = `Bearer ${token}`;\r\n      console.log('[Next API Client] Added Authorization header:', {\r\n        authHeaderStart: headers['Authorization'].substring(0, 30),\r\n        fullAuthHeaderLength: headers['Authorization'].length\r\n      });\r\n    }\r\n  }\r\n\r\n  // Add CSRF token for mutations\r\n  if (fetchOptions.method && ['POST', 'PUT', 'PATCH', 'DELETE'].includes(fetchOptions.method)) {\r\n    const csrfToken = await getCsrfToken();\r\n    if (csrfToken) {\r\n      headers['X-CSRF-Token'] = csrfToken;\r\n    }\r\n  }\r\n\r\n  // Add request ID for tracing\r\n  headers['X-Request-ID'] = generateRequestId();\r\n\r\n  // Add security headers for HIPAA compliance\r\n  headers['X-Content-Type-Options'] = 'nosniff';\r\n  headers['X-Frame-Options'] = 'DENY';\r\n  headers['X-XSS-Protection'] = '1; mode=block';\r\n\r\n  // Build Next.js cache configuration\r\n  const nextConfig: Record<string, unknown> = {};\r\n\r\n  if (next?.revalidate !== undefined) {\r\n    nextConfig.revalidate = next.revalidate;\r\n  }\r\n\r\n  if (next?.tags && next.tags.length > 0) {\r\n    nextConfig.tags = next.tags;\r\n  }\r\n\r\n  // Execute fetch with retry logic\r\n  let lastError: Error | null = null;\r\n\r\n  for (let attempt = 0; attempt < retry.attempts; attempt++) {\r\n    try {\r\n      // Create abort controller for timeout\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n\r\n      const response = await fetch(url, {\r\n        ...fetchOptions,\r\n        headers,\r\n        cache,\r\n        next: Object.keys(nextConfig).length > 0 ? nextConfig : undefined,\r\n        signal: controller.signal,\r\n      });\r\n\r\n      clearTimeout(timeoutId);\r\n\r\n      // Handle different response status codes\r\n      if (!response.ok) {\r\n        // Log 401 errors for debugging before consuming the response\r\n        if (response.status === 401) {\r\n          console.error('[Next API Client] 401 Unauthorized:', {\r\n            endpoint,\r\n            status: response.status,\r\n            statusText: response.statusText,\r\n            hasAuthHeader: !!headers['Authorization'],\r\n            authHeaderStart: headers['Authorization']?.substring(0, 30)\r\n          });\r\n        }\r\n        \r\n        const error = await handleErrorResponse(response);\r\n\r\n        // Handle specific errors with redirects\r\n        // Don't redirect on login/auth endpoints to avoid redirect loops\r\n        const isAuthEndpoint = endpoint.includes('/auth/login') || endpoint.includes('/auth/register');\r\n        \r\n        // Note: Redirects in Server Components/Actions can be tricky\r\n        // These will throw NEXT_REDIRECT which Next.js catches\r\n        // Consider using middleware for auth protection instead\r\n        if (response.status === 401 && !isAuthEndpoint) {\r\n          console.error('[Next API Client] 401 error - authentication required');\r\n          redirect('/login');\r\n        } else if (response.status === 403) {\r\n          console.error('[Next API Client] 403 error - access denied');\r\n          redirect('/access-denied');\r\n        }\r\n\r\n        throw error;\r\n      }\r\n\r\n      // Parse response\r\n      const contentType = response.headers.get('content-type');\r\n      if (contentType?.includes('application/json')) {\r\n        return await response.json() as T;\r\n      }\r\n\r\n      return await response.text() as unknown as T;\r\n\r\n    } catch (error) {\r\n      // Re-throw Next.js redirect errors immediately - they should not be caught\r\n      if (error && typeof error === 'object' && 'digest' in error) {\r\n        const errorWithDigest = error as { digest: unknown };\r\n        if (typeof errorWithDigest.digest === 'string' && \r\n            errorWithDigest.digest.startsWith('NEXT_REDIRECT')) {\r\n          throw error;\r\n        }\r\n      }\r\n\r\n      lastError = error as Error;\r\n\r\n      // Don't retry on client errors (except 408, 429)\r\n      if (error instanceof NextApiClientError) {\r\n        const status = error.status;\r\n        if (status && status >= 400 && status < 500 && status !== 408 && status !== 429) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      // Wait before retry (exponential backoff)\r\n      if (attempt < retry.attempts - 1) {\r\n        await new Promise(resolve =>\r\n          setTimeout(resolve, retry.delay * Math.pow(2, attempt))\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  // All retries failed\r\n  const finalError = lastError || new Error('Unknown error');\r\n\r\n  if (onError) {\r\n    onError(finalError);\r\n  }\r\n\r\n  throw finalError;\r\n}\r\n\r\n/**\r\n * Handle error responses and create normalized error objects\r\n */\r\nasync function handleErrorResponse(response: Response): Promise<NextApiClientError> {\r\n  let details: unknown;\r\n\r\n  try {\r\n    const contentType = response.headers.get('content-type');\r\n    if (contentType?.includes('application/json')) {\r\n      details = await response.json();\r\n    } else {\r\n      details = await response.text();\r\n    }\r\n  } catch {\r\n    details = null;\r\n  }\r\n\r\n  const error: ApiErrorResponse = {\r\n    message: typeof details === 'object' && details !== null && 'message' in details\r\n      ? (details as { message: string }).message\r\n      : response.statusText || 'Request failed',\r\n    status: response.status,\r\n    code: typeof details === 'object' && details !== null && 'code' in details\r\n      ? (details as { code: string }).code\r\n      : undefined,\r\n    details,\r\n    traceId: response.headers.get('x-trace-id') || undefined,\r\n  };\r\n\r\n  return new NextApiClientError(error);\r\n}\r\n\r\n// ==========================================\r\n// CONVENIENCE METHODS\r\n// ==========================================\r\n\r\n/**\r\n * GET request with Next.js caching support\r\n *\r\n * @template T - Expected response data type\r\n * @param endpoint - API endpoint\r\n * @param params - Query parameters\r\n * @param options - Fetch options with cache configuration\r\n * @returns Promise resolving to response data\r\n *\r\n * @example\r\n * ```typescript\r\n * const students = await serverGet<Student[]>('/api/students',\r\n *   { status: 'active' },\r\n *   {\r\n *     cache: 'force-cache',\r\n *     next: { revalidate: 60, tags: ['students'] }\r\n *   }\r\n * );\r\n * ```\r\n */\r\nexport async function serverGet<T>(\r\n  endpoint: string,\r\n  params?: Record<string, string | number | boolean>,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  const queryString = params\r\n    ? '?' + new URLSearchParams(\r\n        Object.entries(params).map(([k, v]) => [k, String(v)])\r\n      ).toString()\r\n    : '';\r\n\r\n  return nextFetch<T>(`${endpoint}${queryString}`, {\r\n    ...options,\r\n    method: 'GET',\r\n  });\r\n}\r\n\r\n/**\r\n * POST request (typically with no-store for mutations)\r\n *\r\n * @template T - Expected response data type\r\n * @param endpoint - API endpoint\r\n * @param data - Request body data\r\n * @param options - Fetch options (defaults to no-store for mutations)\r\n * @returns Promise resolving to response data\r\n *\r\n * @example\r\n * ```typescript\r\n * const newStudent = await serverPost<Student>('/api/students',\r\n *   { name: 'John Doe', grade: '5' },\r\n *   {\r\n *     cache: 'no-store',\r\n *     next: { tags: ['students'] }\r\n *   }\r\n * );\r\n * ```\r\n */\r\nexport async function serverPost<T>(\r\n  endpoint: string,\r\n  data?: unknown,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  return nextFetch<T>(endpoint, {\r\n    ...options,\r\n    method: 'POST',\r\n    body: data ? JSON.stringify(data) : undefined,\r\n    cache: options.cache ?? 'no-store', // Mutations typically no-store\r\n  });\r\n}\r\n\r\n/**\r\n * PUT request (typically with no-store for mutations)\r\n *\r\n * @template T - Expected response data type\r\n * @param endpoint - API endpoint\r\n * @param data - Request body data\r\n * @param options - Fetch options (defaults to no-store for mutations)\r\n * @returns Promise resolving to response data\r\n */\r\nexport async function serverPut<T>(\r\n  endpoint: string,\r\n  data?: unknown,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  return nextFetch<T>(endpoint, {\r\n    ...options,\r\n    method: 'PUT',\r\n    body: data ? JSON.stringify(data) : undefined,\r\n    cache: options.cache ?? 'no-store',\r\n  });\r\n}\r\n\r\n/**\r\n * PATCH request (typically with no-store for mutations)\r\n *\r\n * @template T - Expected response data type\r\n * @param endpoint - API endpoint\r\n * @param data - Request body data\r\n * @param options - Fetch options (defaults to no-store for mutations)\r\n * @returns Promise resolving to response data\r\n */\r\nexport async function serverPatch<T>(\r\n  endpoint: string,\r\n  data?: unknown,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  return nextFetch<T>(endpoint, {\r\n    ...options,\r\n    method: 'PATCH',\r\n    body: data ? JSON.stringify(data) : undefined,\r\n    cache: options.cache ?? 'no-store',\r\n  });\r\n}\r\n\r\n/**\r\n * DELETE request (typically with no-store for mutations)\r\n *\r\n * @template T - Expected response data type\r\n * @param endpoint - API endpoint\r\n * @param options - Fetch options (defaults to no-store for mutations)\r\n * @returns Promise resolving to response data\r\n */\r\nexport async function serverDelete<T>(\r\n  endpoint: string,\r\n  options: NextFetchOptions = {}\r\n): Promise<T> {\r\n  return nextFetch<T>(endpoint, {\r\n    ...options,\r\n    method: 'DELETE',\r\n    cache: options.cache ?? 'no-store',\r\n  });\r\n}\r\n\r\n// ==========================================\r\n// UTILITY FUNCTIONS\r\n// ==========================================\r\n\r\n/**\r\n * Build cache tags for a resource\r\n *\r\n * @param resourceType - Type of resource (e.g., 'students', 'medications')\r\n * @param isPHI - Whether the data contains PHI\r\n * @param additionalTags - Additional tags to include\r\n * @returns Array of cache tags\r\n *\r\n * @example\r\n * ```typescript\r\n * const tags = buildCacheTags('students', true, ['active']);\r\n * // Returns: ['students', 'phi-data', 'active']\r\n * ```\r\n */\r\nexport function buildCacheTags(\r\n  resourceType: string,\r\n  isPHI: boolean = true,\r\n  additionalTags: string[] = []\r\n): string[] {\r\n  const tags: string[] = [resourceType];\r\n\r\n  if (isPHI) {\r\n    tags.push('phi-data');\r\n  }\r\n\r\n  return [...tags, ...additionalTags];\r\n}\r\n\r\n/**\r\n * Build resource-specific cache tag\r\n *\r\n * @param resourceType - Type of resource\r\n * @param resourceId - ID of specific resource\r\n * @returns Cache tag string\r\n *\r\n * @example\r\n * ```typescript\r\n * const tag = buildResourceTag('student', '123');\r\n * // Returns: 'student-123'\r\n * ```\r\n */\r\nexport function buildResourceTag(\r\n  resourceType: string,\r\n  resourceId: string\r\n): string {\r\n  return `${resourceType}-${resourceId}`;\r\n}\r\n\r\n// ==========================================\r\n// LEGACY CLIENT SUPPORT\r\n// ==========================================\r\n\r\n/**\r\n * Simple API client for basic HTTP requests (legacy support)\r\n * \r\n * @deprecated This is a legacy client merged from client.ts. \r\n * For new development, prefer the Next.js-specific methods:\r\n * - serverGet() for GET requests\r\n * - serverPost() for POST requests\r\n * - serverPut() for PUT requests\r\n * - serverPatch() for PATCH requests\r\n * - serverDelete() for DELETE requests\r\n * \r\n * @param endpoint - API endpoint (relative or absolute URL)\r\n * @param options - Basic request options\r\n * @returns Promise resolving to parsed JSON response\r\n * \r\n * @example\r\n * ```typescript\r\n * // Legacy usage (consider migrating to serverGet/serverPost)\r\n * const data = await apiClient('/api/users', {\r\n *   method: 'POST',\r\n *   body: { name: 'John' }\r\n * });\r\n * ```\r\n */\r\nexport async function apiClient(endpoint: string, options: ApiClientOptions = {}) {\r\n  const { method = 'GET', body, headers = {} } = options\r\n\r\n  const config: RequestInit = {\r\n    method,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      ...headers\r\n    }\r\n  }\r\n\r\n  if (body) {\r\n    config.body = JSON.stringify(body)\r\n  }\r\n\r\n  const url = endpoint.startsWith('http') ? endpoint : `${getApiBaseUrl()}${endpoint}`\r\n  const response = await fetch(url, config)\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`API Error: ${response.statusText}`)\r\n  }\r\n\r\n  return response.json()\r\n}\r\n\r\n/**\r\n * Alias for apiClient (legacy support)\r\n * @deprecated Use apiClient directly or migrate to Next.js-specific methods\r\n */\r\nexport const fetchApi = apiClient\r\n\r\n// ==========================================\r\n// EXPORTS\r\n// ==========================================\r\n\r\nconst nextjsClient = {\r\n  nextFetch,\r\n  serverGet,\r\n  serverPost,\r\n  serverPut,\r\n  serverPatch,\r\n  serverDelete,\r\n  buildCacheTags,\r\n  buildResourceTag,\r\n  // Legacy exports\r\n  apiClient,\r\n  fetchApi,\r\n};\r\n\r\nexport default nextjsClient;\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 544, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/dashboard.statistics.ts"],"sourcesContent":["/**\r\n * @fileoverview Dashboard Statistics Module\r\n * @module app/dashboard/statistics\r\n * @category Dashboard - Statistics\r\n * @version 2.0.0\r\n *\r\n * Handles fetching and processing dashboard statistics.\r\n * Integrates with backend API to retrieve core metrics.\r\n */\r\n\r\n'use server';\r\n\r\nimport { serverGet } from '@/lib/api/nextjs-client';\r\nimport type { ApiResponse } from '@/types';\r\nimport type { DashboardStats, DashboardFilters } from './dashboard.types';\r\n\r\n/**\r\n * Get Dashboard Statistics\r\n * Retrieves core dashboard metrics with caching\r\n *\r\n * @param filters - Optional filters for statistics\r\n * @returns Promise<DashboardStats>\r\n */\r\nexport async function getDashboardStats(filters: DashboardFilters = {}): Promise<DashboardStats> {\r\n  try {\r\n    console.log('[Dashboard] Loading dashboard statistics from backend with filters:', filters);\r\n\r\n    const wrappedResponse = await serverGet<ApiResponse<any>>('/api/v1/dashboard/stats', undefined, {\r\n      cache: 'no-store', // Fresh data for dashboard\r\n    });\r\n\r\n    const backendStats = wrappedResponse?.data || {};\r\n\r\n    // Map backend response to frontend interface\r\n    const stats: DashboardStats = {\r\n      totalStudents: backendStats.totalStudents || 0,\r\n      activeStudents: backendStats.activeStudents || 0,\r\n      healthAlerts: backendStats.criticalHealthAlerts || 0,\r\n      pendingMedications: backendStats.activeMedications || 0,\r\n      appointmentsToday: backendStats.todaysAppointments || 0,\r\n      completedScreenings: backendStats.completedScreenings || 0,\r\n      immunizationCompliance: backendStats.immunizationCompliance || 0,\r\n      emergencyContacts: backendStats.emergencyContacts || 0\r\n    };\r\n\r\n    console.log('[Dashboard] Dashboard statistics loaded successfully from backend');\r\n    return stats;\r\n\r\n  } catch (error) {\r\n    console.error('[Dashboard] Failed to load dashboard statistics:', error);\r\n\r\n    // Return safe defaults on error\r\n    return {\r\n      totalStudents: 0,\r\n      activeStudents: 0,\r\n      healthAlerts: 0,\r\n      pendingMedications: 0,\r\n      appointmentsToday: 0,\r\n      completedScreenings: 0,\r\n      immunizationCompliance: 0,\r\n      emergencyContacts: 0\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;CAQC;;;;;AAID;;;;AAWO,eAAe,kBAAkB,UAA4B,CAAC,CAAC;IACpE,IAAI;QACF,QAAQ,GAAG,CAAC,uEAAuE;QAEnF,MAAM,kBAAkB,MAAM,IAAA,kJAAS,EAAmB,2BAA2B,WAAW;YAC9F,OAAO;QACT;QAEA,MAAM,eAAe,iBAAiB,QAAQ,CAAC;QAE/C,6CAA6C;QAC7C,MAAM,QAAwB;YAC5B,eAAe,aAAa,aAAa,IAAI;YAC7C,gBAAgB,aAAa,cAAc,IAAI;YAC/C,cAAc,aAAa,oBAAoB,IAAI;YACnD,oBAAoB,aAAa,iBAAiB,IAAI;YACtD,mBAAmB,aAAa,kBAAkB,IAAI;YACtD,qBAAqB,aAAa,mBAAmB,IAAI;YACzD,wBAAwB,aAAa,sBAAsB,IAAI;YAC/D,mBAAmB,aAAa,iBAAiB,IAAI;QACvD;QAEA,QAAQ,GAAG,CAAC;QACZ,OAAO;IAET,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oDAAoD;QAElE,gCAAgC;QAChC,OAAO;YACL,eAAe;YACf,gBAAgB;YAChB,cAAc;YACd,oBAAoB;YACpB,mBAAmB;YACnB,qBAAqB;YACrB,wBAAwB;YACxB,mBAAmB;QACrB;IACF;AACF;;;IAxCsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 605, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/dashboard.alerts.ts"],"sourcesContent":["/**\r\n * @fileoverview Dashboard Health Alerts Module\r\n * @module app/dashboard/alerts\r\n * @category Dashboard - Alerts\r\n * @version 2.0.0\r\n *\r\n * HIPAA Compliance Features:\r\n * - PHI protection in alert data\r\n * - Audit logging for alert acknowledgment\r\n * - Proper authorization for emergency alerts\r\n *\r\n * Manages health alerts and notifications for the dashboard.\r\n */\r\n\r\n'use server';\r\n\r\nimport { revalidatePath } from 'next/cache';\r\nimport { headers } from 'next/headers';\r\nimport type { HealthAlert, DashboardFilters } from './dashboard.types';\r\n\r\n/**\r\n * Get Health Alerts\r\n * Retrieves active health alerts and notifications\r\n *\r\n * @param filters - Alert filtering options\r\n * @returns Promise<HealthAlert[]>\r\n */\r\nexport async function getHealthAlerts(filters: DashboardFilters = {}): Promise<HealthAlert[]> {\r\n  // Access headers to enable dynamic rendering (required before using Date)\r\n  await headers();\r\n  \r\n  try {\r\n    console.log('[Dashboard] Loading health alerts with filters:', filters);\r\n\r\n    // In production, this would query alerts from database\r\n    const alerts: HealthAlert[] = [\r\n      {\r\n        id: '1',\r\n        studentName: 'Student A', // PHI protected in real implementation\r\n        type: 'medication',\r\n        severity: 'critical',\r\n        message: 'Missed insulin dose - requires immediate attention',\r\n        timestamp: new Date().toISOString(),\r\n        status: 'new',\r\n        requiresAction: true\r\n      },\r\n      {\r\n        id: '2',\r\n        studentName: 'Student B',\r\n        type: 'allergy',\r\n        severity: 'high',\r\n        message: 'Severe peanut allergy - cafeteria alert required',\r\n        timestamp: new Date(Date.now() - 30 * 60 * 1000).toISOString(),\r\n        status: 'acknowledged',\r\n        assignedTo: 'Nurse Johnson'\r\n      },\r\n      {\r\n        id: '3',\r\n        studentName: 'Student C',\r\n        type: 'condition',\r\n        severity: 'medium',\r\n        message: 'Asthma inhaler needed for PE class',\r\n        timestamp: new Date(Date.now() - 60 * 60 * 1000).toISOString(),\r\n        status: 'new'\r\n      },\r\n      {\r\n        id: '4',\r\n        studentName: 'Student D',\r\n        type: 'emergency',\r\n        severity: 'high',\r\n        message: 'Emergency contact information missing',\r\n        timestamp: new Date(Date.now() - 90 * 60 * 1000).toISOString(),\r\n        status: 'new',\r\n        requiresAction: true\r\n      }\r\n    ];\r\n\r\n    // Apply severity filter\r\n    if (filters.alertSeverity && filters.alertSeverity !== 'all') {\r\n      return alerts.filter(alert => alert.severity === filters.alertSeverity);\r\n    }\r\n\r\n    console.log('[Dashboard] Health alerts loaded successfully');\r\n    return alerts;\r\n\r\n  } catch (error) {\r\n    console.error('[Dashboard] Failed to load health alerts:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Acknowledge Health Alert\r\n * Mark a health alert as acknowledged by a user\r\n *\r\n * @param alertId - The ID of the alert to acknowledge\r\n * @param userId - The ID of the user acknowledging the alert\r\n * @returns Promise<boolean>\r\n */\r\nexport async function acknowledgeHealthAlert(alertId: string, userId: string): Promise<boolean> {\r\n  try {\r\n    console.log(`[Dashboard] Acknowledging health alert ${alertId} by user ${userId}`);\r\n\r\n    // In production, this would update the alert in the database\r\n    // and create an audit log entry for HIPAA compliance\r\n\r\n    // Revalidate dashboard cache\r\n    revalidatePath('/(dashboard)/dashboard');\r\n\r\n    console.log(`[Dashboard] Health alert ${alertId} acknowledged successfully`);\r\n    return true;\r\n\r\n  } catch (error) {\r\n    console.error(`[Dashboard] Failed to acknowledge health alert ${alertId}:`, error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;CAYC;;;;;;;AAID;AACA;;;;;AAUO,eAAe,gBAAgB,UAA4B,CAAC,CAAC;IAClE,0EAA0E;IAC1E,MAAM,IAAA,0IAAO;IAEb,IAAI;QACF,QAAQ,GAAG,CAAC,mDAAmD;QAE/D,uDAAuD;QACvD,MAAM,SAAwB;YAC5B;gBACE,IAAI;gBACJ,aAAa;gBACb,MAAM;gBACN,UAAU;gBACV,SAAS;gBACT,WAAW,IAAI,OAAO,WAAW;gBACjC,QAAQ;gBACR,gBAAgB;YAClB;YACA;gBACE,IAAI;gBACJ,aAAa;gBACb,MAAM;gBACN,UAAU;gBACV,SAAS;gBACT,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,MAAM,WAAW;gBAC5D,QAAQ;gBACR,YAAY;YACd;YACA;gBACE,IAAI;gBACJ,aAAa;gBACb,MAAM;gBACN,UAAU;gBACV,SAAS;gBACT,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,MAAM,WAAW;gBAC5D,QAAQ;YACV;YACA;gBACE,IAAI;gBACJ,aAAa;gBACb,MAAM;gBACN,UAAU;gBACV,SAAS;gBACT,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,MAAM,WAAW;gBAC5D,QAAQ;gBACR,gBAAgB;YAClB;SACD;QAED,wBAAwB;QACxB,IAAI,QAAQ,aAAa,IAAI,QAAQ,aAAa,KAAK,OAAO;YAC5D,OAAO,OAAO,MAAM,CAAC,CAAA,QAAS,MAAM,QAAQ,KAAK,QAAQ,aAAa;QACxE;QAEA,QAAQ,GAAG,CAAC;QACZ,OAAO;IAET,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6CAA6C;QAC3D,OAAO,EAAE;IACX;AACF;AAUO,eAAe,uBAAuB,OAAe,EAAE,MAAc;IAC1E,IAAI;QACF,QAAQ,GAAG,CAAC,CAAC,uCAAuC,EAAE,QAAQ,SAAS,EAAE,QAAQ;QAEjF,6DAA6D;QAC7D,qDAAqD;QAErD,6BAA6B;QAC7B,IAAA,+IAAc,EAAC;QAEf,QAAQ,GAAG,CAAC,CAAC,yBAAyB,EAAE,QAAQ,0BAA0B,CAAC;QAC3E,OAAO;IAET,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,+CAA+C,EAAE,QAAQ,CAAC,CAAC,EAAE;QAC5E,OAAO;IACT;AACF;;;IAzFsB;IAwEA;;AAxEA,+OAAA;AAwEA,+OAAA","debugId":null}},
    {"offset": {"line": 713, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/dashboard.activities.ts"],"sourcesContent":["/**\r\n * @fileoverview Dashboard Activities Module\r\n * @module app/dashboard/activities\r\n * @category Dashboard - Activities\r\n * @version 2.0.0\r\n *\r\n * Tracks and retrieves recent system activities for dashboard display.\r\n * Includes filtering by activity type and time-based limits.\r\n */\r\n\r\n'use server';\r\n\r\nimport { headers } from 'next/headers';\r\nimport type { RecentActivity, DashboardFilters } from './dashboard.types';\r\n\r\n/**\r\n * Get Recent Activities\r\n * Retrieves recent system activities for dashboard overview\r\n *\r\n * @param filters - Activity filtering options\r\n * @param limit - Maximum number of activities to return\r\n * @returns Promise<RecentActivity[]>\r\n */\r\nexport async function getRecentActivities(filters: DashboardFilters = {}, limit: number = 10): Promise<RecentActivity[]> {\r\n  // Access headers to enable dynamic rendering (required before using Date)\r\n  await headers();\r\n  \r\n  try {\r\n    console.log('[Dashboard] Loading recent activities with filters:', filters);\r\n\r\n    // In production, this would query activity logs\r\n    const activities: RecentActivity[] = [\r\n      {\r\n        id: '1',\r\n        type: 'medication_administered',\r\n        description: 'Insulin administered to Student A',\r\n        timestamp: new Date(Date.now() - 15 * 60 * 1000).toISOString(),\r\n        performedBy: 'Nurse Johnson',\r\n        studentAffected: 'Student A',\r\n        priority: 'high',\r\n        status: 'completed'\r\n      },\r\n      {\r\n        id: '2',\r\n        type: 'appointment_scheduled',\r\n        description: 'Vision screening scheduled',\r\n        timestamp: new Date(Date.now() - 30 * 60 * 1000).toISOString(),\r\n        performedBy: 'Admin Smith',\r\n        studentAffected: 'Student B',\r\n        priority: 'normal',\r\n        status: 'completed'\r\n      },\r\n      {\r\n        id: '3',\r\n        type: 'emergency_contact',\r\n        description: 'Emergency contact updated',\r\n        timestamp: new Date(Date.now() - 45 * 60 * 1000).toISOString(),\r\n        performedBy: 'Secretary Davis',\r\n        studentAffected: 'Student C',\r\n        priority: 'normal',\r\n        status: 'completed'\r\n      },\r\n      {\r\n        id: '4',\r\n        type: 'health_record_update',\r\n        description: 'Allergy information updated',\r\n        timestamp: new Date(Date.now() - 60 * 60 * 1000).toISOString(),\r\n        performedBy: 'Nurse Wilson',\r\n        studentAffected: 'Student D',\r\n        priority: 'high',\r\n        status: 'completed'\r\n      }\r\n    ];\r\n\r\n    // Apply activity type filter\r\n    if (filters.activityType && filters.activityType !== 'all') {\r\n      const filteredActivities = activities.filter(activity => {\r\n        switch (filters.activityType) {\r\n          case 'health':\r\n            return ['medication_administered', 'health_record_update'].includes(activity.type);\r\n          case 'administrative':\r\n            return ['student_enrollment', 'appointment_scheduled', 'document_upload'].includes(activity.type);\r\n          case 'emergency':\r\n            return ['emergency_contact', 'system_alert'].includes(activity.type);\r\n          default:\r\n            return true;\r\n        }\r\n      });\r\n      return filteredActivities.slice(0, limit);\r\n    }\r\n\r\n    console.log('[Dashboard] Recent activities loaded successfully');\r\n    return activities.slice(0, limit);\r\n\r\n  } catch (error) {\r\n    console.error('[Dashboard] Failed to load recent activities:', error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;CAQC;;;;;AAID;;;;AAWO,eAAe,oBAAoB,UAA4B,CAAC,CAAC,EAAE,QAAgB,EAAE;IAC1F,0EAA0E;IAC1E,MAAM,IAAA,0IAAO;IAEb,IAAI;QACF,QAAQ,GAAG,CAAC,uDAAuD;QAEnE,gDAAgD;QAChD,MAAM,aAA+B;YACnC;gBACE,IAAI;gBACJ,MAAM;gBACN,aAAa;gBACb,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,MAAM,WAAW;gBAC5D,aAAa;gBACb,iBAAiB;gBACjB,UAAU;gBACV,QAAQ;YACV;YACA;gBACE,IAAI;gBACJ,MAAM;gBACN,aAAa;gBACb,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,MAAM,WAAW;gBAC5D,aAAa;gBACb,iBAAiB;gBACjB,UAAU;gBACV,QAAQ;YACV;YACA;gBACE,IAAI;gBACJ,MAAM;gBACN,aAAa;gBACb,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,MAAM,WAAW;gBAC5D,aAAa;gBACb,iBAAiB;gBACjB,UAAU;gBACV,QAAQ;YACV;YACA;gBACE,IAAI;gBACJ,MAAM;gBACN,aAAa;gBACb,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,MAAM,WAAW;gBAC5D,aAAa;gBACb,iBAAiB;gBACjB,UAAU;gBACV,QAAQ;YACV;SACD;QAED,6BAA6B;QAC7B,IAAI,QAAQ,YAAY,IAAI,QAAQ,YAAY,KAAK,OAAO;YAC1D,MAAM,qBAAqB,WAAW,MAAM,CAAC,CAAA;gBAC3C,OAAQ,QAAQ,YAAY;oBAC1B,KAAK;wBACH,OAAO;4BAAC;4BAA2B;yBAAuB,CAAC,QAAQ,CAAC,SAAS,IAAI;oBACnF,KAAK;wBACH,OAAO;4BAAC;4BAAsB;4BAAyB;yBAAkB,CAAC,QAAQ,CAAC,SAAS,IAAI;oBAClG,KAAK;wBACH,OAAO;4BAAC;4BAAqB;yBAAe,CAAC,QAAQ,CAAC,SAAS,IAAI;oBACrE;wBACE,OAAO;gBACX;YACF;YACA,OAAO,mBAAmB,KAAK,CAAC,GAAG;QACrC;QAEA,QAAQ,GAAG,CAAC;QACZ,OAAO,WAAW,KAAK,CAAC,GAAG;IAE7B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iDAAiD;QAC/D,OAAO,EAAE;IACX;AACF;;;IA3EsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 820, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/dashboard.system.ts"],"sourcesContent":["/**\r\n * @fileoverview Dashboard System Status Module\r\n * @module app/dashboard/system\r\n * @category Dashboard - System\r\n * @version 2.0.0\r\n *\r\n * Platform health and performance monitoring.\r\n * Provides real-time system status for operational awareness.\r\n */\r\n\r\n'use server';\r\n\r\nimport { headers } from 'next/headers';\r\nimport type { SystemStatus } from './dashboard.types';\r\n\r\n/**\r\n * Get System Status\r\n * Retrieves platform health and performance metrics\r\n *\r\n * @returns Promise<SystemStatus>\r\n */\r\nexport async function getSystemStatus(): Promise<SystemStatus> {\r\n  // Access headers to enable dynamic rendering (required before using Date)\r\n  await headers();\r\n  \r\n  try {\r\n    console.log('[Dashboard] Loading system status');\r\n\r\n    // In production, this would check actual system health\r\n    const status: SystemStatus = {\r\n      apiHealth: 'healthy',\r\n      databaseHealth: 'healthy',\r\n      integrationStatus: 'connected',\r\n      backupStatus: 'current',\r\n      securityStatus: 'secure',\r\n      lastHealthCheck: new Date().toISOString(),\r\n      activeUsers: 45,\r\n      systemLoad: 23.5,\r\n      uptime: '99.8%'\r\n    };\r\n\r\n    console.log('[Dashboard] System status loaded successfully');\r\n    return status;\r\n\r\n  } catch (error) {\r\n    console.error('[Dashboard] Failed to load system status:', error);\r\n\r\n    return {\r\n      apiHealth: 'down',\r\n      databaseHealth: 'down',\r\n      integrationStatus: 'disconnected',\r\n      backupStatus: 'failed',\r\n      securityStatus: 'warning',\r\n      lastHealthCheck: new Date().toISOString(),\r\n      activeUsers: 0,\r\n      systemLoad: 0,\r\n      uptime: 'Unknown'\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;CAQC;;;;;AAID;;;;AASO,eAAe;IACpB,0EAA0E;IAC1E,MAAM,IAAA,0IAAO;IAEb,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,uDAAuD;QACvD,MAAM,SAAuB;YAC3B,WAAW;YACX,gBAAgB;YAChB,mBAAmB;YACnB,cAAc;YACd,gBAAgB;YAChB,iBAAiB,IAAI,OAAO,WAAW;YACvC,aAAa;YACb,YAAY;YACZ,QAAQ;QACV;QAEA,QAAQ,GAAG,CAAC;QACZ,OAAO;IAET,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6CAA6C;QAE3D,OAAO;YACL,WAAW;YACX,gBAAgB;YAChB,mBAAmB;YACnB,cAAc;YACd,gBAAgB;YAChB,iBAAiB,IAAI,OAAO,WAAW;YACvC,aAAa;YACb,YAAY;YACZ,QAAQ;QACV;IACF;AACF;;;IAtCsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 880, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/dashboard.aggregation.ts"],"sourcesContent":["/**\r\n * @fileoverview Dashboard Data Aggregation Module\r\n * @module app/dashboard/aggregation\r\n * @category Dashboard - Aggregation\r\n * @version 2.0.0\r\n *\r\n * Combines multiple dashboard data sources into a single optimized call.\r\n * Uses parallel execution for improved performance.\r\n */\r\n\r\n'use server';\r\n\r\nimport { getDashboardStats } from './dashboard.statistics';\r\nimport { getHealthAlerts } from './dashboard.alerts';\r\nimport { getRecentActivities } from './dashboard.activities';\r\nimport { getSystemStatus } from './dashboard.system';\r\nimport type { DashboardFilters } from './dashboard.types';\r\n\r\n/**\r\n * Get Combined Dashboard Data\r\n * Retrieves all dashboard data in a single optimized call\r\n *\r\n * @param filters - Dashboard filtering options\r\n * @returns Promise<{stats: DashboardStats, alerts: HealthAlert[], activities: RecentActivity[], systemStatus: SystemStatus}>\r\n */\r\nexport const getDashboardData = async (filters: DashboardFilters = {}) => {\r\n  try {\r\n    console.log('[Dashboard] Loading combined dashboard data');\r\n\r\n    // Execute all dashboard data fetches in parallel for performance\r\n    const [stats, alerts, activities, systemStatus] = await Promise.all([\r\n      getDashboardStats(filters),\r\n      getHealthAlerts(filters),\r\n      getRecentActivities(filters, 10),\r\n      getSystemStatus()\r\n    ]);\r\n\r\n    console.log('[Dashboard] Combined dashboard data loaded successfully');\r\n\r\n    // Ensure data is fully serializable by removing any non-serializable properties\r\n    const serializedData = {\r\n      stats: JSON.parse(JSON.stringify(stats)),\r\n      alerts: JSON.parse(JSON.stringify(alerts)),\r\n      activities: JSON.parse(JSON.stringify(activities)),\r\n      systemStatus: JSON.parse(JSON.stringify(systemStatus))\r\n    };\r\n\r\n    return serializedData;\r\n\r\n  } catch (error) {\r\n    console.error('[Dashboard] Failed to load combined dashboard data:', error);\r\n\r\n    // Return safe defaults on error\r\n    return {\r\n      stats: JSON.parse(JSON.stringify(await getDashboardStats({}))),\r\n      alerts: [],\r\n      activities: [],\r\n      systemStatus: JSON.parse(JSON.stringify(await getSystemStatus()))\r\n    };\r\n  }\r\n};\r\n"],"names":[],"mappings":"AAAA;;;;;;;;CAQC;;;;;AAID;AACA;AACA;AACA;;;;;;;AAUO,MAAM,mBAAmB,OAAO,UAA4B,CAAC,CAAC;IACnE,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,iEAAiE;QACjE,MAAM,CAAC,OAAO,QAAQ,YAAY,aAAa,GAAG,MAAM,QAAQ,GAAG,CAAC;YAClE,IAAA,qKAAiB,EAAC;YAClB,IAAA,+JAAe,EAAC;YAChB,IAAA,uKAAmB,EAAC,SAAS;YAC7B,IAAA,+JAAe;SAChB;QAED,QAAQ,GAAG,CAAC;QAEZ,gFAAgF;QAChF,MAAM,iBAAiB;YACrB,OAAO,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;YACjC,QAAQ,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;YAClC,YAAY,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;YACtC,cAAc,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;QAC1C;QAEA,OAAO;IAET,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uDAAuD;QAErE,gCAAgC;QAChC,OAAO;YACL,OAAO,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC,MAAM,IAAA,qKAAiB,EAAC,CAAC;YAC1D,QAAQ,EAAE;YACV,YAAY,EAAE;YACd,cAAc,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC,MAAM,IAAA,+JAAe;QAC/D;IACF;AACF;;;IAnCa;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 942, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/dashboard.utils.ts"],"sourcesContent":["/**\r\n * @fileoverview Dashboard Utilities Module\r\n * @module app/dashboard/utils\r\n * @category Dashboard - Utilities\r\n * @version 2.0.0\r\n *\r\n * Utility functions for dashboard data management.\r\n * Includes cache management and data refresh operations.\r\n */\r\n\r\n'use server';\r\n\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Refresh Dashboard Data\r\n * Force refresh all dashboard data by invalidating caches\r\n *\r\n * @returns Promise<void>\r\n */\r\nexport async function refreshDashboardData(): Promise<void> {\r\n  try {\r\n    console.log('[Dashboard] Refreshing all dashboard data');\r\n\r\n    // Revalidate dashboard path to refresh all cached data\r\n    revalidatePath('/(dashboard)/dashboard');\r\n\r\n    console.log('[Dashboard] Dashboard data refreshed successfully');\r\n\r\n  } catch (error) {\r\n    console.error('[Dashboard] Failed to refresh dashboard data:', error);\r\n    throw error;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;CAQC;;;;;AAID;;;;AAQO,eAAe;IACpB,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,uDAAuD;QACvD,IAAA,+IAAc,EAAC;QAEf,QAAQ,GAAG,CAAC;IAEd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iDAAiD;QAC/D,MAAM;IACR;AACF;;;IAbsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 979, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/.next-internal/server/app/%28dashboard%29/dashboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getDashboardData as '7fe22b086e54131e2da80588001a3fca4cc808b133'} from 'ACTIONS_MODULE0'\nexport {acknowledgeHealthAlert as '60ee91299b8808aaf85eb687fb9823b31fc246c44b'} from 'ACTIONS_MODULE1'\nexport {refreshDashboardData as '00e6964bfa542a0ea937f9c5fab5df3458e87f668a'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":";AAAA;AACA;AACA","debugId":null}}]
}