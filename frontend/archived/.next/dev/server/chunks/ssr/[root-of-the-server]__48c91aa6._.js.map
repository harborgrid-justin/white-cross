{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/components/ui/badge.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Badge = registerClientReference(\n    function() { throw new Error(\"Attempted to call Badge() from the server but Badge is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/badge.tsx <module evaluation>\",\n    \"Badge\",\n);\nexport const badgeVariants = registerClientReference(\n    function() { throw new Error(\"Attempted to call badgeVariants() from the server but badgeVariants is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/badge.tsx <module evaluation>\",\n    \"badgeVariants\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;;;AACvE;;AACO,MAAM,QAAQ,IAAA,wQAAuB,EACxC;IAAa,MAAM,IAAI,MAAM;AAA0N,GACvP,6DACA;AAEG,MAAM,gBAAgB,IAAA,wQAAuB,EAChD;IAAa,MAAM,IAAI,MAAM;AAA0O,GACvQ,6DACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/components/ui/badge.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Badge = registerClientReference(\n    function() { throw new Error(\"Attempted to call Badge() from the server but Badge is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/badge.tsx\",\n    \"Badge\",\n);\nexport const badgeVariants = registerClientReference(\n    function() { throw new Error(\"Attempted to call badgeVariants() from the server but badgeVariants is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/badge.tsx\",\n    \"badgeVariants\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;;;AACvE;;AACO,MAAM,QAAQ,IAAA,wQAAuB,EACxC;IAAa,MAAM,IAAI,MAAM;AAA0N,GACvP,yCACA;AAEG,MAAM,gBAAgB,IAAA,wQAAuB,EAChD;IAAa,MAAM,IAAI,MAAM;AAA0O,GACvQ,yCACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/compliance.types.ts"],"sourcesContent":["/**\r\n * @fileoverview Compliance Types - Next.js v16 App Router\r\n *\r\n * Type definitions for compliance management including audit logs,\r\n * policies, reports, and training compliance.\r\n */\r\n\r\nimport type {\r\n  AuditActionTypeEnum,\r\n  AuditSeverityEnum,\r\n  ResourceTypeEnum,\r\n} from '@/schemas/compliance/compliance.schemas';\r\n\r\n// ============================================================================\r\n// Types\r\n// ============================================================================\r\n\r\n/**\r\n * Action Result Type - Matches ApiResponse pattern from @/lib/api\r\n * but named ActionResult to distinguish server actions from API calls\r\n */\r\nexport interface ActionResult<T> {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: string;\r\n  message?: string;\r\n}\r\n\r\nexport interface AuditLogContext {\r\n  userId: string;\r\n  userName: string;\r\n  userRole: string;\r\n  sessionId: string;\r\n  ipAddress: string;\r\n  userAgent: string;\r\n}\r\n\r\nexport interface CreateAuditLogInput {\r\n  action: AuditActionTypeEnum;\r\n  severity?: AuditSeverityEnum;\r\n  resourceType?: ResourceTypeEnum;\r\n  resourceId?: string;\r\n  resourceName?: string;\r\n  details?: Record<string, unknown>;\r\n  changes?: {\r\n    before?: Record<string, unknown>;\r\n    after?: Record<string, unknown>;\r\n  };\r\n  status?: 'SUCCESS' | 'FAILURE' | 'PARTIAL';\r\n  errorMessage?: string;\r\n  phiAccessed?: boolean;\r\n  complianceFlags?: string[];\r\n}\r\n\r\nexport interface UIComplianceReport {\r\n  id: string;\r\n  title: string;\r\n  type: string;\r\n  status: string;\r\n  generatedAt: string;\r\n  generatedBy: string;\r\n  period: { start: string; end: string };\r\n}\r\n\r\nexport interface UIReportTemplate {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  category: string;\r\n  requiredParams: string[];\r\n}\r\n\r\nexport interface UIPolicy {\r\n  id: string;\r\n  title: string;\r\n  category: string;\r\n  status: string;\r\n  version: string;\r\n  effectiveDate: string;\r\n  reviewDate: string;\r\n  acknowledgments: {\r\n    completed: number;\r\n    pending: number;\r\n    total: number;\r\n  };\r\n}\r\n\r\nexport interface PaginatedResult<T> {\r\n  data: T[];\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}"],"names":[],"mappings":"AAAA;;;;;CAKC","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/compliance.cache.ts"],"sourcesContent":["/**\r\n * @fileoverview Compliance Cache & Configuration - Next.js v16 App Router\r\n *\r\n * Configuration and cache functions for compliance management.\r\n */\r\n\r\nimport type { AuditLog } from '@/schemas/compliance/compliance.schemas';\r\n\r\n// ============================================================================\r\n// Configuration\r\n// ============================================================================\r\n\r\nexport const BACKEND_URL = process.env.BACKEND_URL || process.env.API_BASE_URL || 'http://localhost:3001';\r\nexport const SECONDARY_LOG_ENABLED = process.env.ENABLE_SECONDARY_LOGGING === 'true';\r\nexport const AWS_S3_BUCKET = process.env.AWS_AUDIT_LOG_BUCKET;\r\nexport const AWS_REGION = process.env.AWS_REGION || 'us-east-1';\r\n\r\n// Retry configuration\r\nexport const MAX_RETRIES = 3;\r\nexport const RETRY_DELAY_MS = 1000;\r\nexport const RETRYABLE_STATUS_CODES = [408, 429, 500, 502, 503, 504];\r\n\r\n// ============================================================================\r\n// Cache Functions\r\n// ============================================================================\r\n\r\n/**\r\n * Get authentication token for API calls\r\n */\r\nexport async function getAuthToken(): Promise<string> {\r\n  // Implementation would get token from auth context\r\n  return 'token-placeholder';\r\n}\r\n\r\n/**\r\n * Get the most recent audit log for hash chaining\r\n */\r\nexport async function getLatestAuditLog(): Promise<AuditLog | null> {\r\n  // Implementation would fetch latest audit log\r\n  return null;\r\n}\r\n\r\n/**\r\n * Log HIPAA compliance audit entry\r\n */\r\nexport async function logHIPAAAuditEntry(entry: Record<string, unknown>): Promise<void> {\r\n  // Implementation would log HIPAA audit entry\r\n  console.log('HIPAA Audit:', entry);\r\n}\r\n\r\n/**\r\n * Log to secondary storage (fire-and-forget)\r\n */\r\nexport async function logToSecondaryStore(entry: Record<string, unknown>): Promise<void> {\r\n  if (!SECONDARY_LOG_ENABLED) return;\r\n\r\n  // Implementation would log to secondary store\r\n  console.log('Secondary log:', entry);\r\n}\r\n\r\n/**\r\n * Detect and log compliance violations\r\n */\r\nexport async function detectAndLogViolations(entry: Record<string, unknown>): Promise<void> {\r\n  // Implementation would detect violations\r\n  console.log('Violation check:', entry);\r\n}\r\n\r\n/**\r\n * Get current user context for audit logging\r\n */\r\nexport async function getCurrentUserContext(): Promise<{ userId: string; ipAddress: string; userName: string; userRole: string }> {\r\n  return {\r\n    userId: 'current-user-id',\r\n    ipAddress: '127.0.0.1',\r\n    userName: 'Current User',\r\n    userRole: 'admin'\r\n  };\r\n}\r\n\r\n/**\r\n * Get current user ID for audit logging\r\n */\r\nexport async function getCurrentUserId(): Promise<string> {\r\n  const context = await getCurrentUserContext();\r\n  return context.userId;\r\n}"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQM,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI,QAAQ,GAAG,CAAC,YAAY,IAAI;AAC3E,MAAM,wBAAwB,QAAQ,GAAG,CAAC,wBAAwB,KAAK;AACvE,MAAM,gBAAgB,QAAQ,GAAG,CAAC,oBAAoB;AACtD,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAG7C,MAAM,cAAc;AACpB,MAAM,iBAAiB;AACvB,MAAM,yBAAyB;IAAC;IAAK;IAAK;IAAK;IAAK;IAAK;CAAI;AAS7D,eAAe;IACpB,mDAAmD;IACnD,OAAO;AACT;AAKO,eAAe;IACpB,8CAA8C;IAC9C,OAAO;AACT;AAKO,eAAe,mBAAmB,KAA8B;IACrE,6CAA6C;IAC7C,QAAQ,GAAG,CAAC,gBAAgB;AAC9B;AAKO,eAAe,oBAAoB,KAA8B;IACtE,IAAI,CAAC,uBAAuB;IAE5B,8CAA8C;IAC9C,QAAQ,GAAG,CAAC,kBAAkB;AAChC;AAKO,eAAe,uBAAuB,KAA8B;IACzE,yCAAyC;IACzC,QAAQ,GAAG,CAAC,oBAAoB;AAClC;AAKO,eAAe;IACpB,OAAO;QACL,QAAQ;QACR,WAAW;QACX,UAAU;QACV,UAAU;IACZ;AACF;AAKO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,OAAO,QAAQ,MAAM;AACvB","debugId":null}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/compliance/audit.ts"],"sourcesContent":["import crypto from 'crypto';\r\nimport type {\r\n  AuditLog,\r\n  AuditActionTypeEnum,\r\n  AuditSeverityEnum,\r\n  ResourceTypeEnum,\r\n} from '@/schemas/compliance/compliance.schemas';\r\n\r\n/**\r\n * Audit Logging Utility\r\n * Provides cryptographically-secure audit logging with tamper detection\r\n */\r\n\r\ninterface AuditLogContext {\r\n  userId: string;\r\n  userName: string;\r\n  userRole: string;\r\n  sessionId: string;\r\n  ipAddress: string;\r\n  userAgent: string;\r\n}\r\n\r\ninterface AuditLogEntry {\r\n  action: AuditActionTypeEnum;\r\n  severity?: AuditSeverityEnum;\r\n  resourceType?: ResourceTypeEnum;\r\n  resourceId?: string;\r\n  resourceName?: string;\r\n  details?: Record<string, any>;\r\n  changes?: {\r\n    before?: Record<string, any>;\r\n    after?: Record<string, any>;\r\n  };\r\n  status?: 'SUCCESS' | 'FAILURE' | 'PARTIAL';\r\n  errorMessage?: string;\r\n  phiAccessed?: boolean;\r\n  complianceFlags?: string[];\r\n}\r\n\r\n/**\r\n * Generate cryptographic hash for audit log entry\r\n * Uses SHA-256 to create tamper-proof verification hash\r\n */\r\nexport function generateAuditHash(\r\n  entry: Partial<AuditLog>,\r\n  previousHash?: string\r\n): string {\r\n  const dataToHash = {\r\n    timestamp: entry.timestamp,\r\n    action: entry.action,\r\n    userId: entry.userId,\r\n    resourceType: entry.resourceType,\r\n    resourceId: entry.resourceId,\r\n    details: entry.details,\r\n    changes: entry.changes,\r\n    previousHash: previousHash || '',\r\n  };\r\n\r\n  const hash = crypto\r\n    .createHash('sha256')\r\n    .update(JSON.stringify(dataToHash))\r\n    .digest('hex');\r\n\r\n  return hash;\r\n}\r\n\r\n/**\r\n * Verify audit log integrity by checking hash chain\r\n */\r\n// Overload signatures\r\nexport function verifyAuditChain(\r\n  currentLog: AuditLog,\r\n  previousLog?: AuditLog\r\n): boolean;\r\nexport function verifyAuditChain(\r\n  logs: AuditLog[]\r\n): { valid: boolean; firstInvalidIndex?: number };\r\n\r\n// Implementation\r\nexport function verifyAuditChain(\r\n  currentLogOrLogs: AuditLog | AuditLog[],\r\n  previousLog?: AuditLog\r\n): boolean | { valid: boolean; firstInvalidIndex?: number } {\r\n  // Handle array case\r\n  if (Array.isArray(currentLogOrLogs)) {\r\n    const logs = currentLogOrLogs;\r\n    for (let i = 0; i < logs.length; i++) {\r\n      const currentLog = logs[i];\r\n      const prevLog = i > 0 ? logs[i - 1] : undefined;\r\n\r\n      // Verify current log hash\r\n      const expectedHash = generateAuditHash(currentLog, prevLog?.verificationHash);\r\n      if (currentLog.verificationHash !== expectedHash) {\r\n        return { valid: false, firstInvalidIndex: i };\r\n      }\r\n\r\n      // Verify chain integrity\r\n      if (prevLog && currentLog.previousHash !== prevLog.verificationHash) {\r\n        return { valid: false, firstInvalidIndex: i };\r\n      }\r\n    }\r\n    return { valid: true };\r\n  }\r\n\r\n  // Handle single log case\r\n  const currentLog = currentLogOrLogs;\r\n\r\n  // Verify current log hash\r\n  const expectedHash = generateAuditHash(currentLog, previousLog?.verificationHash);\r\n  if (currentLog.verificationHash !== expectedHash) {\r\n    return false;\r\n  }\r\n\r\n  // Verify chain integrity\r\n  if (previousLog && currentLog.previousHash !== previousLog.verificationHash) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Create audit log entry with automatic hash generation\r\n */\r\nexport function createAuditLogEntry(\r\n  context: AuditLogContext,\r\n  entry: AuditLogEntry,\r\n  previousHash?: string\r\n): Omit<AuditLog, 'id'> {\r\n  const timestamp = new Date().toISOString();\r\n\r\n  const auditLog: Omit<AuditLog, 'id'> = {\r\n    timestamp,\r\n    action: entry.action,\r\n    severity: entry.severity || inferSeverity(entry.action),\r\n    userId: context.userId,\r\n    userName: context.userName,\r\n    userRole: context.userRole,\r\n    resourceType: entry.resourceType,\r\n    resourceId: entry.resourceId,\r\n    resourceName: entry.resourceName,\r\n    ipAddress: context.ipAddress,\r\n    userAgent: context.userAgent,\r\n    sessionId: context.sessionId,\r\n    details: sanitizeDetails(entry.details),\r\n    changes: sanitizeChanges(entry.changes),\r\n    status: entry.status || 'SUCCESS',\r\n    errorMessage: entry.errorMessage,\r\n    phiAccessed: entry.phiAccessed || isPHIAction(entry.action),\r\n    complianceFlags: entry.complianceFlags || [],\r\n    verificationHash: '',\r\n    previousHash,\r\n  };\r\n\r\n  // Generate hash after all fields are set\r\n  auditLog.verificationHash = generateAuditHash(auditLog, previousHash);\r\n\r\n  return auditLog;\r\n}\r\n\r\n/**\r\n * Infer severity level based on action type\r\n */\r\nfunction inferSeverity(action: AuditActionTypeEnum): AuditSeverityEnum {\r\n  const criticalActions: AuditActionTypeEnum[] = [\r\n    'DATA_BREACH',\r\n    'UNAUTHORIZED_ACCESS',\r\n    'EMERGENCY_OVERRIDE',\r\n    'BREAK_GLASS',\r\n    'PHI_BULK_ACCESS',\r\n  ];\r\n\r\n  const securityActions: AuditActionTypeEnum[] = [\r\n    'LOGIN_FAILED',\r\n    'SESSION_EXPIRED',\r\n    'PERMISSION_CHANGE',\r\n    'ROLE_CHANGE',\r\n    'SECURITY_ALERT',\r\n  ];\r\n\r\n  const warningActions: AuditActionTypeEnum[] = [\r\n    'PHI_EXPORT',\r\n    'PHI_PRINT',\r\n    'PHI_DELETE',\r\n    'RECORD_DELETE',\r\n    'EMERGENCY_ACCESS',\r\n  ];\r\n\r\n  if (criticalActions.includes(action)) return 'CRITICAL';\r\n  if (securityActions.includes(action)) return 'SECURITY';\r\n  if (warningActions.includes(action)) return 'WARNING';\r\n  return 'INFO';\r\n}\r\n\r\n/**\r\n * Determine if action involves PHI access\r\n */\r\nfunction isPHIAction(action: AuditActionTypeEnum): boolean {\r\n  const phiActions: AuditActionTypeEnum[] = [\r\n    'PHI_VIEW',\r\n    'PHI_CREATE',\r\n    'PHI_UPDATE',\r\n    'PHI_DELETE',\r\n    'PHI_EXPORT',\r\n    'PHI_PRINT',\r\n    'PHI_SEARCH',\r\n    'PHI_BULK_ACCESS',\r\n  ];\r\n\r\n  return phiActions.includes(action);\r\n}\r\n\r\n/**\r\n * Sanitize details to remove sensitive information from logs\r\n */\r\nfunction sanitizeDetails(details?: Record<string, any>): Record<string, any> | undefined {\r\n  if (!details) return undefined;\r\n\r\n  const sanitized = { ...details };\r\n  const sensitiveFields = ['password', 'ssn', 'creditCard', 'token', 'secret', 'apiKey'];\r\n\r\n  for (const field of sensitiveFields) {\r\n    if (field in sanitized) {\r\n      sanitized[field] = '[REDACTED]';\r\n    }\r\n  }\r\n\r\n  return sanitized;\r\n}\r\n\r\n/**\r\n * Sanitize changes object to prevent logging sensitive data\r\n */\r\nfunction sanitizeChanges(changes?: {\r\n  before?: Record<string, any>;\r\n  after?: Record<string, any>;\r\n}): typeof changes {\r\n  if (!changes) return undefined;\r\n\r\n  return {\r\n    before: sanitizeDetails(changes.before),\r\n    after: sanitizeDetails(changes.after),\r\n  };\r\n}\r\n\r\n/**\r\n * Detect PHI in data fields\r\n */\r\nexport function detectPHI(data: Record<string, any>): boolean {\r\n  const phiFields = [\r\n    'ssn',\r\n    'dateOfBirth',\r\n    'medicalRecordNumber',\r\n    'diagnosis',\r\n    'medication',\r\n    'allergy',\r\n    'condition',\r\n    'prescription',\r\n    'treatment',\r\n    'labResult',\r\n    'immunization',\r\n    'insurance',\r\n  ];\r\n\r\n  for (const field of phiFields) {\r\n    if (field in data) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Generate compliance flags based on audit context\r\n */\r\nexport function generateComplianceFlags(\r\n  action: AuditActionTypeEnum,\r\n  context: AuditLogContext,\r\n  details?: Record<string, any>\r\n): string[] {\r\n  const flags: string[] = [];\r\n\r\n  // Check for after-hours access\r\n  const hour = new Date().getHours();\r\n  if (hour < 6 || hour > 22) {\r\n    flags.push('AFTER_HOURS_ACCESS');\r\n  }\r\n\r\n  // Check for bulk operations\r\n  if (details?.recordCount && details.recordCount > 50) {\r\n    flags.push('BULK_OPERATION');\r\n  }\r\n\r\n  // Check for emergency access\r\n  if (action === 'EMERGENCY_ACCESS' || action === 'BREAK_GLASS') {\r\n    flags.push('EMERGENCY_ACCESS_USED');\r\n  }\r\n\r\n  // Check for failed actions\r\n  if (details?.status === 'FAILURE') {\r\n    flags.push('FAILED_ACTION');\r\n  }\r\n\r\n  // Check for export actions\r\n  if (action === 'PHI_EXPORT' || action === 'DOCUMENT_DOWNLOAD') {\r\n    flags.push('DATA_EXPORT');\r\n  }\r\n\r\n  return flags;\r\n}\r\n\r\n/**\r\n * Export audit logs with encryption\r\n */\r\nexport async function exportAuditLogs(\r\n  logs: AuditLog[],\r\n  format: 'JSON' | 'CSV' | 'PDF' | 'XLSX',\r\n  encrypt = true,\r\n  password?: string\r\n): Promise<{ data: string | Buffer; encrypted: boolean }> {\r\n  let data: string | Buffer;\r\n\r\n  switch (format) {\r\n    case 'JSON':\r\n      data = JSON.stringify(logs, null, 2);\r\n      break;\r\n    case 'CSV':\r\n      data = convertToCSV(logs);\r\n      break;\r\n    case 'PDF':\r\n      // In production, use a PDF library like pdfkit or puppeteer\r\n      data = `PDF export not implemented in this example`;\r\n      break;\r\n    case 'XLSX':\r\n      // In production, use a library like xlsx or exceljs\r\n      // For now, export as CSV with .xlsx extension\r\n      data = convertToCSV(logs);\r\n      break;\r\n    default:\r\n      throw new Error(`Unsupported format: ${format}`);\r\n  }\r\n\r\n  if (encrypt && password) {\r\n    data = encryptData(data, password);\r\n    return { data, encrypted: true };\r\n  }\r\n\r\n  return { data, encrypted: false };\r\n}\r\n\r\n/**\r\n * Convert audit logs to CSV format\r\n */\r\nfunction convertToCSV(logs: AuditLog[]): string {\r\n  const headers = [\r\n    'Timestamp',\r\n    'Action',\r\n    'Severity',\r\n    'User',\r\n    'Role',\r\n    'Resource Type',\r\n    'Resource ID',\r\n    'IP Address',\r\n    'Status',\r\n    'PHI Accessed',\r\n    'Verification Hash',\r\n  ];\r\n\r\n  const rows = logs.map((log) => [\r\n    log.timestamp,\r\n    log.action,\r\n    log.severity,\r\n    log.userName,\r\n    log.userRole,\r\n    log.resourceType || '',\r\n    log.resourceId || '',\r\n    log.ipAddress,\r\n    log.status,\r\n    log.phiAccessed ? 'Yes' : 'No',\r\n    log.verificationHash.substring(0, 16) + '...',\r\n  ]);\r\n\r\n  const csvContent = [\r\n    headers.join(','),\r\n    ...rows.map((row) => row.map((cell) => `\"${cell}\"`).join(',')),\r\n  ].join('\\n');\r\n\r\n  return csvContent;\r\n}\r\n\r\n/**\r\n * Encrypt data using AES-256-GCM\r\n */\r\nfunction encryptData(data: string | Buffer, password: string): Buffer {\r\n  const algorithm = 'aes-256-gcm';\r\n  const key = crypto.scryptSync(password, 'salt', 32);\r\n  const iv = crypto.randomBytes(16);\r\n  const cipher = crypto.createCipheriv(algorithm, key, iv);\r\n\r\n  let encrypted = cipher.update(\r\n    typeof data === 'string' ? data : data.toString(),\r\n    'utf8',\r\n    'hex'\r\n  );\r\n  encrypted += cipher.final('hex');\r\n\r\n  const authTag = cipher.getAuthTag();\r\n\r\n  // Combine IV, encrypted data, and auth tag\r\n  return Buffer.concat([\r\n    iv,\r\n    Buffer.from(encrypted, 'hex'),\r\n    authTag,\r\n  ]);\r\n}\r\n\r\n/**\r\n * Audit log retention checker\r\n */\r\nexport function shouldRetainLog(log: AuditLog, retentionYears = 6): boolean {\r\n  const logDate = new Date(log.timestamp);\r\n  const now = new Date();\r\n  const yearsDiff = (now.getTime() - logDate.getTime()) / (1000 * 60 * 60 * 24 * 365);\r\n\r\n  // HIPAA requires 6 years minimum retention\r\n  if (yearsDiff < retentionYears) {\r\n    return true;\r\n  }\r\n\r\n  // Extended retention for critical events\r\n  if (log.severity === 'CRITICAL' || log.severity === 'SECURITY') {\r\n    return yearsDiff < retentionYears + 1; // Extra year for critical logs\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Batch audit log creation for high-volume operations\r\n */\r\nexport function createBatchAuditLogs(\r\n  context: AuditLogContext,\r\n  entries: AuditLogEntry[],\r\n  previousHash?: string\r\n): Omit<AuditLog, 'id'>[] {\r\n  const logs: Omit<AuditLog, 'id'>[] = [];\r\n  let currentHash = previousHash;\r\n\r\n  for (const entry of entries) {\r\n    const log = createAuditLogEntry(context, entry, currentHash);\r\n    logs.push(log);\r\n    currentHash = log.verificationHash;\r\n  }\r\n\r\n  return logs;\r\n}\r\n\r\n/**\r\n * Validate audit log completeness\r\n */\r\nexport function validateAuditLog(log: Partial<AuditLog>): {\r\n  valid: boolean;\r\n  errors: string[];\r\n} {\r\n  const errors: string[] = [];\r\n\r\n  if (!log.timestamp) errors.push('Missing timestamp');\r\n  if (!log.action) errors.push('Missing action');\r\n  if (!log.userId) errors.push('Missing userId');\r\n  if (!log.userName) errors.push('Missing userName');\r\n  if (!log.ipAddress) errors.push('Missing ipAddress');\r\n  if (!log.verificationHash) errors.push('Missing verificationHash');\r\n\r\n  return {\r\n    valid: errors.length === 0,\r\n    errors,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 510, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/compliance.audit.ts"],"sourcesContent":["/**\r\n * @fileoverview Compliance Audit Actions - Next.js v16 App Router\r\n *\r\n * Server actions for audit log management including creation,\r\n * retrieval, export, and integrity verification.\r\n */\r\n\r\n'use server';\r\n\r\nimport { revalidatePath, revalidateTag } from 'next/cache';\r\nimport type {\r\n  AuditLog,\r\n  AuditLogFilter,\r\n  AuditLogExport,\r\n} from '@/schemas/compliance/compliance.schemas';\r\nimport { createAuditLogEntry, exportAuditLogs, verifyAuditChain } from '@/lib/compliance/audit';\r\n\r\nimport type {\r\n  ActionResult,\r\n  AuditLogContext,\r\n  CreateAuditLogInput,\r\n  PaginatedResult\r\n} from './compliance.types';\r\nimport {\r\n  BACKEND_URL,\r\n  getAuthToken,\r\n  getLatestAuditLog,\r\n  logHIPAAAuditEntry,\r\n  logToSecondaryStore,\r\n  detectAndLogViolations,\r\n  getCurrentUserId,\r\n} from './compliance.cache';\r\n\r\n// ============================================================================\r\n// Audit Log Actions\r\n// ============================================================================\r\n\r\n/**\r\n * Create Audit Log Entry\r\n * Cache: 1 minute for created audit logs\r\n */\r\nexport async function createAuditLogAction(\r\n  context: AuditLogContext,\r\n  input: CreateAuditLogInput\r\n): Promise<ActionResult<AuditLog>> {\r\n  'use cache';\r\n\r\n  try {\r\n    // Log HIPAA compliance audit entry\r\n    await logHIPAAAuditEntry({\r\n      userId: context.userId,\r\n      action: 'AUDIT_LOG_CREATE',\r\n      resourceType: input.resourceType || 'SYSTEM',\r\n      resourceId: input.resourceId || crypto.randomUUID(),\r\n      details: {\r\n        action: input.action,\r\n        severity: input.severity,\r\n        phiAccessed: input.phiAccessed || false,\r\n        complianceFlags: input.complianceFlags || []\r\n      },\r\n      ipAddress: context.ipAddress,\r\n      userAgent: context.userAgent\r\n    });\r\n\r\n    // Get the most recent audit log to chain hashes\r\n    const previousLog = await getLatestAuditLog();\r\n    const previousHash = previousLog?.verificationHash;\r\n\r\n    // Create audit log entry with automatic hash generation\r\n    const auditLogEntry = createAuditLogEntry(context, input, previousHash);\r\n\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/audit-logs`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID(),\r\n        'X-Source': 'compliance-actions'\r\n      },\r\n      body: JSON.stringify(auditLogEntry),\r\n      next: {\r\n        revalidate: 60,\r\n        tags: ['audit-logs']\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const createdLog = await response.json() as AuditLog;\r\n\r\n    // Revalidate caches\r\n    revalidateTag('audit-logs', 'compliance');\r\n    revalidateTag('compliance-metrics', 'compliance');\r\n    revalidatePath('/compliance/audits');\r\n\r\n    // Fire-and-forget secondary logging (never fails the operation)\r\n    await logToSecondaryStore(auditLogEntry).catch(() => {});\r\n\r\n    // Check for compliance violations\r\n    await detectAndLogViolations(auditLogEntry).catch(() => {});\r\n\r\n    return {\r\n      success: true,\r\n      data: createdLog,\r\n      message: 'Audit log created successfully',\r\n    };\r\n  } catch (error) {\r\n    console.error('Create audit log error:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to create audit log',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Audit Logs with hash chain verification\r\n * Cache: 2 minutes for audit log queries\r\n */\r\nexport async function getAuditLogsAction(\r\n  filters: Partial<AuditLogFilter>\r\n): Promise<ActionResult<PaginatedResult<AuditLog> & { chainStatus: { valid: boolean; firstInvalidIndex?: number } }>> {\r\n  'use cache';\r\n\r\n  try {\r\n    // Build query parameters\r\n    const params = new URLSearchParams();\r\n    Object.entries(filters).forEach(([key, value]) => {\r\n      if (value !== undefined && value !== null) {\r\n        params.append(key, String(value));\r\n      }\r\n    });\r\n\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/audit-logs?${params}`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID(),\r\n        'X-Cache-Control': 'max-age=120'\r\n      },\r\n      next: {\r\n        revalidate: 120,\r\n        tags: ['audit-logs']\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const result = await response.json();\r\n\r\n            // Verify audit chain integrity\r\n    const chainResult = verifyAuditChain(result.data);\r\n    const chainStatus = typeof chainResult === 'object' ? chainResult : { valid: chainResult, firstInvalidIndex: undefined };\r\n\r\n    // Log PHI access if accessing audit logs containing PHI\r\n    const containsPHI = result.data.some((log: AuditLog) => log.phiAccessed);\r\n    if (containsPHI) {\r\n      await logHIPAAAuditEntry({\r\n        userId: await getCurrentUserId(),\r\n        action: 'PHI_ACCESS',\r\n        resourceType: 'AUDIT_LOG',\r\n        details: {\r\n          action: 'view_audit_logs_with_phi',\r\n          logCount: result.data.length,\r\n          containsPHI: true\r\n        }\r\n      });\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: {\r\n        ...result,\r\n        chainStatus,\r\n      },\r\n    };\r\n  } catch (error) {\r\n    console.error('Get audit logs error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to retrieve audit logs',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Export Audit Logs with encryption\r\n * Cache: No cache for exports (always fresh)\r\n */\r\nexport async function exportAuditLogsAction(\r\n  exportConfig: AuditLogExport\r\n): Promise<ActionResult<{ data: string | Buffer; encrypted: boolean; filename: string }>> {\r\n  try {\r\n    // Log PHI export attempt\r\n    await logHIPAAAuditEntry({\r\n      userId: await getCurrentUserId(),\r\n      action: 'PHI_EXPORT',\r\n      resourceType: 'AUDIT_LOG',\r\n      details: {\r\n        format: exportConfig.format,\r\n        encrypted: exportConfig.encryptOutput || false,\r\n        filters: exportConfig.filters\r\n      }\r\n    });\r\n\r\n    // Get filtered audit logs\r\n    const logsResult = await getAuditLogsAction(exportConfig.filters);\r\n    if (!logsResult.success || !logsResult.data) {\r\n      throw new Error('Failed to retrieve logs for export');\r\n    }\r\n\r\n    // Export with encryption\r\n    const exportData = await exportAuditLogs(\r\n      logsResult.data.data,\r\n      exportConfig.format,\r\n      exportConfig.encryptOutput,\r\n      exportConfig.password\r\n    );\r\n\r\n    const timestamp = new Date().toISOString().split('T')[0];\r\n    const filename = `audit-logs-${timestamp}.${exportConfig.format.toLowerCase()}${exportData.encrypted ? '.enc' : ''}`;\r\n\r\n    // Revalidate export tracking\r\n    revalidateTag('audit-exports', 'compliance');\r\n\r\n    return {\r\n      success: true,\r\n      data: {\r\n        ...exportData,\r\n        filename,\r\n      },\r\n      message: 'Audit logs exported successfully',\r\n    };\r\n  } catch (error) {\r\n    console.error('Export audit logs error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to export audit logs',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Verify Audit Chain Integrity\r\n * Cache: 5 minutes for integrity verification\r\n */\r\nexport async function verifyAuditIntegrityAction(\r\n  startDate?: string,\r\n  endDate?: string\r\n): Promise<ActionResult<{ valid: boolean; totalLogs: number; verifiedLogs: number; firstInvalidIndex?: number }>> {\r\n  'use cache';\r\n\r\n  try {\r\n    const logsResult = await getAuditLogsAction({\r\n      startDate,\r\n      endDate,\r\n      sortBy: 'timestamp',\r\n      sortOrder: 'asc',\r\n    });\r\n\r\n    if (!logsResult.success || !logsResult.data) {\r\n      throw new Error('Failed to retrieve logs for verification');\r\n    }\r\n\r\n    const { valid, firstInvalidIndex } = verifyAuditChain(logsResult.data.data);\r\n\r\n    // Log verification action\r\n    await logHIPAAAuditEntry({\r\n      userId: await getCurrentUserId(),\r\n      action: valid ? 'SECURITY_VERIFICATION' : 'SECURITY_ALERT',\r\n      resourceType: 'SYSTEM',\r\n      details: {\r\n        verificationResult: valid,\r\n        logsVerified: logsResult.data.data.length,\r\n        firstInvalidIndex,\r\n        integrityStatus: valid ? 'INTACT' : 'COMPROMISED'\r\n      }\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: {\r\n        valid,\r\n        totalLogs: logsResult.data.pagination.total,\r\n        verifiedLogs: logsResult.data.data.length,\r\n        firstInvalidIndex,\r\n      },\r\n      message: valid ? 'Audit chain verified successfully' : 'Audit chain integrity compromised',\r\n    };\r\n  } catch (error) {\r\n    console.error('Verify audit integrity error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to verify audit chain integrity',\r\n    };\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 777, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/compliance.policy.ts"],"sourcesContent":["/**\r\n * @fileoverview Compliance Policy Actions - Next.js v16 App Router\r\n *\r\n * Server actions for policy management including creation,\r\n * acknowledgment, and retrieval.\r\n */\r\n\r\n'use server';\r\n\r\nimport { revalidatePath, revalidateTag } from 'next/cache';\r\nimport type {\r\n  PolicyDocument,\r\n  PolicyAcknowledgment,\r\n} from '@/schemas/compliance/compliance.schemas';\r\n\r\nimport type {\r\n  ActionResult,\r\n  PaginatedResult,\r\n  UIPolicy\r\n} from './compliance.types';\r\nimport {\r\n  BACKEND_URL,\r\n  getAuthToken,\r\n  logHIPAAAuditEntry,\r\n  getCurrentUserContext,\r\n} from './compliance.cache';\r\n\r\n// ============================================================================\r\n// Policy Management Actions\r\n// ============================================================================\r\n\r\n/**\r\n * Create Policy Document\r\n * Cache: 5 minutes for created policies\r\n */\r\nexport async function createPolicyAction(\r\n  policyData: Omit<PolicyDocument, 'id' | 'createdAt' | 'updatedAt'>\r\n): Promise<ActionResult<PolicyDocument>> {\r\n  'use cache';\r\n\r\n  try {\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/policies`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      body: JSON.stringify(policyData),\r\n      next: {\r\n        revalidate: 300,\r\n        tags: ['policies']\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const createdPolicy = await response.json() as PolicyDocument;\r\n\r\n    // Revalidate policy caches\r\n    revalidateTag('policies', 'compliance');\r\n    revalidatePath('/compliance/policies');\r\n\r\n    // Log policy creation\r\n    await logHIPAAAuditEntry({\r\n      userId: await getCurrentUserContext().then(ctx => ctx.userId),\r\n      action: 'RECORD_CREATE',\r\n      resourceType: 'POLICY',\r\n      resourceId: createdPolicy.id,\r\n      details: {\r\n        policyTitle: createdPolicy.title,\r\n        policyType: createdPolicy.policyType,\r\n        version: createdPolicy.version\r\n      }\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: createdPolicy,\r\n      message: 'Policy created successfully',\r\n    };\r\n  } catch (error) {\r\n    console.error('Create policy error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to create policy',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Acknowledge Policy\r\n * Cache: 10 minutes for acknowledgments\r\n */\r\nexport async function acknowledgePolicyAction(\r\n  policyId: string,\r\n  userId: string\r\n): Promise<ActionResult<PolicyAcknowledgment>> {\r\n  'use cache';\r\n\r\n  try {\r\n    const context = await getCurrentUserContext();\r\n\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/policies/${policyId}/acknowledge`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      body: JSON.stringify({\r\n        userId,\r\n        acknowledgedAt: new Date().toISOString(),\r\n        ipAddress: context.ipAddress,\r\n      }),\r\n      next: {\r\n        revalidate: 600,\r\n        tags: ['policies', `policy-${policyId}`]\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const acknowledgment = await response.json() as PolicyAcknowledgment;\r\n\r\n    // Revalidate related caches\r\n    revalidateTag('policies', 'compliance');\r\n    revalidateTag(`policy-${policyId}`, 'compliance');\r\n    revalidatePath('/compliance/policies');\r\n\r\n    // Log policy acknowledgment\r\n    await logHIPAAAuditEntry({\r\n      userId: context.userId,\r\n      action: 'POLICY_ACKNOWLEDGMENT',\r\n      resourceType: 'POLICY',\r\n      resourceId: policyId,\r\n      details: { acknowledgedUserId: userId }\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: acknowledgment,\r\n      message: 'Policy acknowledged successfully',\r\n    };\r\n  } catch (error) {\r\n    console.error('Acknowledge policy error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to acknowledge policy',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Policy Acknowledgments\r\n * Cache: 5 minutes for acknowledgment lists\r\n */\r\nexport async function getPolicyAcknowledgmentsAction(\r\n  policyId: string\r\n): Promise<ActionResult<PolicyAcknowledgment[]>> {\r\n  'use cache';\r\n\r\n  try {\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/policies/${policyId}/acknowledgments`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      next: {\r\n        revalidate: 300,\r\n        tags: ['policies', `policy-${policyId}`]\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const acknowledgments = await response.json() as PolicyAcknowledgment[];\r\n\r\n    return {\r\n      success: true,\r\n      data: acknowledgments,\r\n    };\r\n  } catch (error) {\r\n    console.error('Get policy acknowledgments error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to retrieve policy acknowledgments',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Policies with filtering and pagination\r\n * Cache: 5 minutes for policy lists\r\n */\r\nexport async function getPoliciesAction(\r\n  filters?: {\r\n    category?: string;\r\n    status?: string;\r\n    search?: string;\r\n    page?: number;\r\n    pageSize?: number;\r\n  }\r\n): Promise<ActionResult<PaginatedResult<UIPolicy> & { stats: { active: number; total: number; acknowledgmentRate: number; acknowledged: number; required: number; pending: number; reviewDue: number } }>> {\r\n\r\n  try {\r\n    // Build query parameters\r\n    const params = new URLSearchParams();\r\n    if (filters) {\r\n      Object.entries(filters).forEach(([key, value]) => {\r\n        if (value !== undefined && value !== null) {\r\n          params.append(key, String(value));\r\n        }\r\n      });\r\n    }\r\n\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/policies?${params}`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID(),\r\n        'X-Cache-Control': 'max-age=300'\r\n      },\r\n      next: {\r\n        revalidate: 300,\r\n        tags: ['policies']\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const result = await response.json() as PaginatedResult<PolicyDocument>;\r\n\r\n    // Transform policies to match UI expectations\r\n    const transformedPolicies: UIPolicy[] = result.data.map((policy: PolicyDocument) => ({\r\n      id: policy.id,\r\n      title: policy.title,\r\n      category: policy.policyType.replace('_', ' ').toLowerCase().replace(/\\b\\w/g, (l: string) => l.toUpperCase()),\r\n      status: policy.status,\r\n      version: policy.version,\r\n      effectiveDate: policy.effectiveDate,\r\n      reviewDate: policy.reviewDate,\r\n      acknowledgments: {\r\n        completed: 0, // TODO: Calculate from acknowledgments API\r\n        pending: 0,   // TODO: Calculate from acknowledgments API\r\n        total: 0,     // TODO: Calculate from applicable users\r\n      },\r\n    }));\r\n\r\n    // Get policy statistics\r\n    const statsResponse = await fetch(`${BACKEND_URL}/compliance/policies/stats`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      next: {\r\n        revalidate: 300,\r\n        tags: ['policies', 'compliance-stats']\r\n      }\r\n    });\r\n\r\n    let stats = {\r\n      active: 0,\r\n      total: 0,\r\n      acknowledgmentRate: 0,\r\n      acknowledged: 0,\r\n      required: 0,\r\n      pending: 0,\r\n      reviewDue: 0,\r\n    };\r\n\r\n    if (statsResponse.ok) {\r\n      stats = await statsResponse.json();\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: {\r\n        data: transformedPolicies,\r\n        pagination: result.pagination,\r\n        stats,\r\n      },\r\n    };\r\n  } catch (error) {\r\n    console.error('Get policies error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to retrieve policies',\r\n    };\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1057, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/compliance.reports.ts"],"sourcesContent":["/**\r\n * @fileoverview Compliance Reports Actions - Next.js v16 App Router\r\n *\r\n * Server actions for compliance reporting and metrics.\r\n */\r\n\r\n'use server';\r\n\r\nimport { revalidatePath, revalidateTag } from 'next/cache';\r\nimport type {\r\n  HIPAAReport,\r\n  ComplianceMetrics,\r\n  ComplianceAlert,\r\n  ComplianceViolation,\r\n} from '@/schemas/compliance/compliance.schemas';\r\n\r\nimport type {\r\n  ActionResult,\r\n  PaginatedResult,\r\n  UIComplianceReport,\r\n  UIReportTemplate\r\n} from './compliance.types';\r\nimport {\r\n  BACKEND_URL,\r\n  getAuthToken,\r\n  logHIPAAAuditEntry,\r\n  getCurrentUserContext,\r\n} from './compliance.cache';\r\n\r\n// ============================================================================\r\n// Compliance Reporting Actions\r\n// ============================================================================\r\n\r\n/**\r\n * Generate Compliance Report\r\n * Cache: 15 minutes for generated reports\r\n */\r\nexport async function generateComplianceReportAction(\r\n  reportType: string,\r\n  period: { start: string; end: string }\r\n): Promise<ActionResult<HIPAAReport>> {\r\n  'use cache';\r\n\r\n  try {\r\n    // Get compliance metrics for the period\r\n    const metricsResult = await getComplianceMetricsAction(period);\r\n    if (!metricsResult.success || !metricsResult.data) {\r\n      throw new Error('Failed to retrieve compliance metrics');\r\n    }\r\n\r\n    const context = await getCurrentUserContext();\r\n\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/reports/generate`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      body: JSON.stringify({\r\n        reportType,\r\n        period,\r\n        generatedBy: context.userId,\r\n        metrics: metricsResult.data,\r\n      }),\r\n      next: {\r\n        revalidate: 900,\r\n        tags: ['compliance-reports']\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const report = await response.json() as HIPAAReport;\r\n\r\n    // Revalidate report caches\r\n    revalidateTag('compliance-reports', 'compliance');\r\n    revalidatePath('/compliance/reports');\r\n\r\n    // Log report generation\r\n    await logHIPAAAuditEntry({\r\n      userId: context.userId,\r\n      action: 'RECORD_CREATE',\r\n      resourceType: 'SYSTEM',\r\n      details: {\r\n        reportType,\r\n        period,\r\n        reportId: report.id\r\n      }\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: report,\r\n      message: 'Compliance report generated successfully',\r\n    };\r\n  } catch (error) {\r\n    console.error('Generate compliance report error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to generate compliance report',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Compliance Metrics\r\n * Cache: 10 minutes for metrics\r\n */\r\nexport async function getComplianceMetricsAction(\r\n  period?: { start: string; end: string }\r\n): Promise<ActionResult<ComplianceMetrics>> {\r\n  'use cache';\r\n\r\n  try {\r\n    const params = period ? new URLSearchParams({\r\n      start: period.start,\r\n      end: period.end\r\n    }) : '';\r\n\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/metrics${params ? `?${params}` : ''}`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      next: {\r\n        revalidate: 600,\r\n        tags: ['compliance-metrics']\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const metrics = await response.json() as ComplianceMetrics;\r\n\r\n    return {\r\n      success: true,\r\n      data: metrics,\r\n    };\r\n  } catch (error) {\r\n    console.error('Get compliance metrics error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to retrieve compliance metrics',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Compliance Alerts\r\n * Cache: 2 minutes for alerts (need fresh data)\r\n */\r\nexport async function getComplianceAlertsAction(\r\n  filters?: { severity?: string; status?: string }\r\n): Promise<ActionResult<ComplianceAlert[]>> {\r\n  'use cache';\r\n\r\n  try {\r\n    const params = filters ? new URLSearchParams(\r\n      Object.entries(filters).filter(([, value]) => value !== undefined)\r\n    ) : '';\r\n\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/alerts${params ? `?${params}` : ''}`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      next: {\r\n        revalidate: 120,\r\n        tags: ['compliance-alerts']\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const alerts = await response.json() as ComplianceAlert[];\r\n\r\n    return {\r\n      success: true,\r\n      data: alerts,\r\n    };\r\n  } catch (error) {\r\n    console.error('Get compliance alerts error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to retrieve compliance alerts',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Resolve Compliance Violation\r\n * No cache for violation resolution (always fresh)\r\n */\r\nexport async function resolveComplianceViolationAction(\r\n  violationId: string,\r\n  resolution: {\r\n    resolutionNotes: string;\r\n    remediationSteps: string[];\r\n  }\r\n): Promise<ActionResult<ComplianceViolation>> {\r\n  try {\r\n    const context = await getCurrentUserContext();\r\n\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/violations/${violationId}/resolve`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      body: JSON.stringify({\r\n        ...resolution,\r\n        resolvedBy: context.userId,\r\n        resolvedAt: new Date().toISOString(),\r\n      }),\r\n      next: {\r\n        tags: ['compliance-alerts', 'compliance-violations']\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const resolvedViolation = await response.json() as ComplianceViolation;\r\n\r\n    // Revalidate related caches\r\n    revalidateTag('compliance-alerts', 'compliance');\r\n    revalidateTag('compliance-violations', 'compliance');\r\n    revalidatePath('/compliance');\r\n\r\n    // Log violation resolution\r\n    await logHIPAAAuditEntry({\r\n      userId: context.userId,\r\n      action: 'RECORD_UPDATE',\r\n      resourceType: 'SYSTEM',\r\n      resourceId: violationId,\r\n      details: {\r\n        action: 'resolve_violation',\r\n        resolutionNotes: resolution.resolutionNotes\r\n      }\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: resolvedViolation,\r\n      message: 'Compliance violation resolved successfully',\r\n    };\r\n  } catch (error) {\r\n    console.error('Resolve compliance violation error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to resolve compliance violation',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Compliance Reports and Templates\r\n * Cache: 10 minutes for reports list\r\n */\r\nexport async function getComplianceReportsAction(\r\n  filters?: {\r\n    type?: string;\r\n    status?: string;\r\n    search?: string;\r\n    page?: number;\r\n    pageSize?: number;\r\n  }\r\n): Promise<ActionResult<{\r\n  reports: PaginatedResult<UIComplianceReport>;\r\n  templates: UIReportTemplate[];\r\n}>> {\r\n  try {\r\n    // Build query parameters\r\n    const params = new URLSearchParams();\r\n    if (filters) {\r\n      Object.entries(filters).forEach(([key, value]) => {\r\n        if (value !== undefined && value !== null) {\r\n          params.append(key, String(value));\r\n        }\r\n      });\r\n    }\r\n\r\n    // Fetch reports\r\n    const reportsResponse = await fetch(`${BACKEND_URL}/compliance/reports?${params}`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID(),\r\n        'X-Cache-Control': 'max-age=600'\r\n      },\r\n      next: {\r\n        revalidate: 600,\r\n        tags: ['compliance-reports']\r\n      }\r\n    });\r\n\r\n    let reports: PaginatedResult<UIComplianceReport> = { data: [], pagination: { page: 1, limit: 10, total: 0, totalPages: 0 } };\r\n    if (reportsResponse.ok) {\r\n      reports = await reportsResponse.json();\r\n    }\r\n\r\n    // Fetch report templates\r\n    const templatesResponse = await fetch(`${BACKEND_URL}/compliance/reports/templates`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      next: {\r\n        revalidate: 3600, // 1 hour for templates\r\n        tags: ['compliance-report-templates']\r\n      }\r\n    });\r\n\r\n    let templates: UIReportTemplate[] = [];\r\n    if (templatesResponse.ok) {\r\n      templates = await templatesResponse.json();\r\n    } else {\r\n      // Fallback to default templates if API not available\r\n      templates = [\r\n        {\r\n          id: 'hipaa-security',\r\n          name: 'HIPAA Security Assessment',\r\n          description: 'Comprehensive security risk assessment report',\r\n          category: 'HIPAA',\r\n          requiredParams: ['period']\r\n        },\r\n        {\r\n          id: 'audit-trail',\r\n          name: 'Audit Trail Report',\r\n          description: 'Detailed audit log analysis and compliance verification',\r\n          category: 'AUDIT',\r\n          requiredParams: ['period']\r\n        },\r\n        {\r\n          id: 'training-compliance',\r\n          name: 'Training Compliance',\r\n          description: 'Staff training completion and certification status',\r\n          category: 'TRAINING',\r\n          requiredParams: ['period']\r\n        },\r\n        {\r\n          id: 'data-breach',\r\n          name: 'Data Breach Analysis',\r\n          description: 'Breach notification and incident response report',\r\n          category: 'INCIDENT',\r\n          requiredParams: ['period']\r\n        }\r\n      ];\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: {\r\n        reports,\r\n        templates,\r\n      },\r\n    };\r\n  } catch (error) {\r\n    console.error('Get compliance reports error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to retrieve compliance reports',\r\n    };\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1408, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/compliance.training.ts"],"sourcesContent":["/**\r\n * @fileoverview Compliance Training Actions - Next.js v16 App Router\r\n *\r\n * Server actions for training compliance management.\r\n */\r\n\r\n'use server';\r\n\r\nimport { revalidatePath, revalidateTag } from 'next/cache';\r\n\r\nimport type { ActionResult } from './compliance.types';\r\nimport {\r\n  BACKEND_URL,\r\n  getAuthToken,\r\n  logHIPAAAuditEntry,\r\n  getCurrentUserContext,\r\n} from './compliance.cache';\r\n\r\n// ============================================================================\r\n// Training Compliance Actions\r\n// ============================================================================\r\n\r\n/**\r\n * Record Training Completion\r\n * Cache: 30 minutes for training records\r\n */\r\nexport async function recordTrainingCompletionAction(\r\n  userId: string,\r\n  courseId: string,\r\n  completedAt: string\r\n): Promise<ActionResult<Record<string, unknown>>> {\r\n  'use cache';\r\n\r\n  try {\r\n    const context = await getCurrentUserContext();\r\n\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/training/complete`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      body: JSON.stringify({\r\n        userId,\r\n        courseId,\r\n        completedAt,\r\n        verifiedBy: context.userId,\r\n      }),\r\n      next: {\r\n        revalidate: 1800,\r\n        tags: ['training', `user-training-${userId}`]\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const trainingRecord = await response.json();\r\n\r\n    // Revalidate training caches\r\n    revalidateTag('training', 'compliance');\r\n    revalidateTag(`user-training-${userId}`, 'compliance');\r\n    revalidatePath('/compliance/training');\r\n\r\n    // Log training completion\r\n    await logHIPAAAuditEntry({\r\n      userId: context.userId,\r\n      action: 'RECORD_CREATE',\r\n      resourceType: 'SYSTEM',\r\n      details: {\r\n        action: 'training_completion',\r\n        userId,\r\n        courseId,\r\n        completedAt\r\n      }\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: trainingRecord,\r\n      message: 'Training completion recorded successfully',\r\n    };\r\n  } catch (error) {\r\n    console.error('Record training completion error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to record training completion',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get User Training Status\r\n * Cache: 15 minutes for training status\r\n */\r\nexport async function getUserTrainingStatusAction(\r\n  userId: string\r\n): Promise<ActionResult<Record<string, unknown>>> {\r\n  'use cache';\r\n\r\n  try {\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/training/user/${userId}`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      next: {\r\n        revalidate: 900,\r\n        tags: ['training', `user-training-${userId}`]\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const trainingStatus = await response.json();\r\n\r\n    return {\r\n      success: true,\r\n      data: trainingStatus,\r\n    };\r\n  } catch (error) {\r\n    console.error('Get user training status error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to retrieve user training status',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Overdue Training\r\n * Cache: 10 minutes for overdue training\r\n */\r\nexport async function getOverdueTrainingAction(): Promise<ActionResult<Record<string, unknown>[]>> {\r\n  'use cache';\r\n\r\n  try {\r\n    // Enhanced fetch with Next.js v16 capabilities\r\n    const response = await fetch(`${BACKEND_URL}/compliance/training/overdue`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      next: {\r\n        revalidate: 600,\r\n        tags: ['training', 'overdue-training']\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const overdueTraining = await response.json() as Record<string, unknown>[];\r\n\r\n    return {\r\n      success: true,\r\n      data: overdueTraining,\r\n    };\r\n  } catch (error) {\r\n    console.error('Get overdue training error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to retrieve overdue training',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Training Records and Compliance Data\r\n * Cache: 10 minutes for training data\r\n */\r\nexport async function getTrainingRecordsAction(\r\n  filters?: {\r\n    userId?: string;\r\n    courseId?: string;\r\n    status?: string;\r\n    priority?: string;\r\n    page?: number;\r\n    pageSize?: number;\r\n  }\r\n): Promise<ActionResult<{\r\n  stats: {\r\n    total: number;\r\n    completed: number;\r\n    inProgress: number;\r\n    overdue: number;\r\n    completionRate: number;\r\n    certifications: number;\r\n    expiringSoon: number;\r\n  };\r\n  courses: Array<{\r\n    id: string;\r\n    title: string;\r\n    description: string;\r\n    priority: string;\r\n    stats: { completed: number; inProgress: number; overdue: number };\r\n  }>;\r\n  users: Array<{\r\n    id: string;\r\n    name: string;\r\n    role: string;\r\n    training: {\r\n      required: number;\r\n      completed: number;\r\n      overdue: number;\r\n      status: string;\r\n    };\r\n  }>;\r\n}>> {\r\n  try {\r\n    // Build query parameters\r\n    const params = new URLSearchParams();\r\n    if (filters) {\r\n      Object.entries(filters).forEach(([key, value]) => {\r\n        if (value !== undefined && value !== null) {\r\n          params.append(key, String(value));\r\n        }\r\n      });\r\n    }\r\n\r\n    // Fetch training stats\r\n    const statsResponse = await fetch(`${BACKEND_URL}/compliance/training/stats`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      next: {\r\n        revalidate: 600,\r\n        tags: ['training', 'training-stats']\r\n      }\r\n    });\r\n\r\n    let stats = {\r\n      total: 0,\r\n      completed: 0,\r\n      inProgress: 0,\r\n      overdue: 0,\r\n      completionRate: 0,\r\n      certifications: 0,\r\n      expiringSoon: 0,\r\n    };\r\n\r\n    if (statsResponse.ok) {\r\n      stats = await statsResponse.json();\r\n    }\r\n\r\n    // Fetch training courses\r\n    const coursesResponse = await fetch(`${BACKEND_URL}/compliance/training/courses?${params}`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      next: {\r\n        revalidate: 600,\r\n        tags: ['training', 'training-courses']\r\n      }\r\n    });\r\n\r\n    let courses: Array<{\r\n      id: string;\r\n      title: string;\r\n      description: string;\r\n      priority: string;\r\n      stats: { completed: number; inProgress: number; overdue: number };\r\n    }> = [];\r\n\r\n    if (coursesResponse.ok) {\r\n      courses = await coursesResponse.json();\r\n    }\r\n\r\n    // Fetch user training status\r\n    const usersResponse = await fetch(`${BACKEND_URL}/compliance/training/users?${params}`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${await getAuthToken()}`,\r\n        'X-Request-ID': crypto.randomUUID()\r\n      },\r\n      next: {\r\n        revalidate: 600,\r\n        tags: ['training', 'user-training']\r\n      }\r\n    });\r\n\r\n    let users: Array<{\r\n      id: string;\r\n      name: string;\r\n      role: string;\r\n      training: {\r\n        required: number;\r\n        completed: number;\r\n        overdue: number;\r\n        status: string;\r\n      };\r\n    }> = [];\r\n\r\n    if (usersResponse.ok) {\r\n      users = await usersResponse.json();\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: {\r\n        stats,\r\n        courses,\r\n        users,\r\n      },\r\n    };\r\n  } catch (error) {\r\n    console.error('Get training records error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Failed to retrieve training records',\r\n    };\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1675, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/lib/actions/compliance.actions.ts"],"sourcesContent":["/**\r\n * @fileoverview Compliance Server Actions - Next.js v16 App Router\r\n *\r\n * HIPAA-compliant server actions for compliance management including:\r\n * - Audit log creation with cryptographic hash chain\r\n * - Policy management and acknowledgment tracking\r\n * - Compliance report generation\r\n * - Training compliance tracking\r\n * - Real-time compliance monitoring\r\n *\r\n * All actions follow the ActionResult<T> pattern for consistent error handling\r\n * and implement fire-and-forget audit logging that never blocks operations.\r\n */\r\n\r\n// Re-export all compliance actions from split files\r\nexport * from './compliance.types';\r\nexport * from './compliance.cache';\r\nexport * from './compliance.audit';\r\nexport * from './compliance.policy';\r\nexport * from './compliance.reports';\r\nexport * from './compliance.training';\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;CAYC,GAED,oDAAoD;;AACpD;AACA;AACA;AACA;AACA;AACA","debugId":null}},
    {"offset": {"line": 1705, "column": 0}, "map": {"version":3,"sources":["file:///F:/temp/white-cross/frontend/src/app/%28dashboard%29/compliance/audits/page.tsx"],"sourcesContent":["/**\r\n * @fileoverview HIPAA-Compliant Audit Logs Page\r\n *\r\n * Provides comprehensive audit trail management with tamper-proof cryptographic verification.\r\n * Implements blockchain-inspired SHA-256 hash chain for immutable audit logging as required\r\n * by HIPAA Security Rule  164.312(b) - Audit Controls.\r\n *\r\n * @module compliance/audits\r\n *\r\n * @description\r\n * This page displays audit log entries with the following HIPAA compliance features:\r\n * - Cryptographic verification using SHA-256 hash chains\r\n * - PHI access tracking and flagging\r\n * - Tamper detection through hash verification\r\n * - Comprehensive filtering and search capabilities\r\n * - Exportable audit reports for regulatory compliance\r\n *\r\n * @see {@link https://www.hhs.gov/hipaa/for-professionals/security/laws-regulations/index.html | HIPAA Security Rule}\r\n *\r\n * @remarks\r\n * **HIPAA Requirements:**\r\n * - All PHI access must be logged ( 164.308(a)(1)(ii)(D))\r\n * - Audit logs must be tamper-proof ( 164.312(b))\r\n * - Logs must be retained for 6 years ( 164.316(b)(2)(i))\r\n * - Regular review of audit logs required ( 164.308(a)(1)(ii)(D))\r\n *\r\n * **Security Features:**\r\n * - Each log entry contains hash of previous entry (blockchain pattern)\r\n * - Real-time verification of entire audit chain\r\n * - Alerts on any tampering detection\r\n * - Immutable audit trail cannot be modified after creation\r\n *\r\n * @since 1.0.0\r\n */\r\n\r\nimport { Metadata } from 'next';\r\nimport { Suspense } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Button } from '@/components/ui/button';\r\nimport {\r\n  Shield,\r\n  Download,\r\n  Filter,\r\n  Search,\r\n  CheckCircle,\r\n  XCircle,\r\n  AlertTriangle\r\n} from 'lucide-react';\r\nimport Link from 'next/link';\r\nimport { getAuditLogsAction } from '@/lib/actions/compliance.actions';\r\n\r\n/**\r\n * Page metadata for SEO and browser display\r\n */\r\nexport const metadata: Metadata = {\r\n  title: 'Audit Logs | Compliance | White Cross',\r\n  description: 'Comprehensive HIPAA-compliant audit trail with tamper-proof verification',\r\n};\r\n\r\n/**\r\n * Force dynamic rendering for this route\r\n * Required because audit logs are user-specific and require authentication\r\n */\r\n\r\n\r\n/**\r\n * URL search parameters for audit log filtering\r\n *\r\n * @interface SearchParams\r\n * @property {string} [page] - Current page number for pagination (default: '1')\r\n * @property {string} [action] - Filter by audit action type (e.g., 'PHI_VIEW', 'POLICY_ACKNOWLEDGMENT')\r\n * @property {string} [severity] - Filter by severity level ('INFO', 'WARNING', 'ERROR', 'CRITICAL', 'SECURITY')\r\n * @property {string} [startDate] - Filter logs from this date (ISO 8601 format)\r\n * @property {string} [endDate] - Filter logs until this date (ISO 8601 format)\r\n * @property {string} [userId] - Filter logs by specific user ID\r\n * @property {string} [phiOnly] - Filter to show only PHI access logs ('true' or 'false')\r\n */\r\ninterface SearchParams {\r\n  page?: string;\r\n  action?: string;\r\n  severity?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  userId?: string;\r\n  phiOnly?: string;\r\n}\r\n\r\n/**\r\n * Component props for AuditLogsPage\r\n *\r\n * @interface AuditLogsPageProps\r\n * @property {SearchParams} searchParams - URL search parameters for filtering and pagination\r\n */\r\ninterface AuditLogsPageProps {\r\n  searchParams: SearchParams;\r\n}\r\n\r\n/**\r\n * Audit Logs Page Component\r\n *\r\n * React Server Component that displays comprehensive HIPAA-compliant audit trail with\r\n * advanced filtering, search, and export capabilities. Implements cryptographic verification\r\n * using SHA-256 hash chains to ensure tamper-proof audit logging.\r\n *\r\n * @async\r\n * @param {AuditLogsPageProps} props - Component props\r\n * @param {SearchParams} props.searchParams - URL search parameters for filtering and pagination\r\n * @returns {Promise<JSX.Element>} Rendered audit logs page with verification status\r\n *\r\n * @description\r\n * **Features:**\r\n * - Real-time audit chain verification with SHA-256 hashes\r\n * - PHI access tracking with visual indicators\r\n * - Advanced filtering (action, severity, date range, user, PHI-only)\r\n * - Compliance flag detection (bulk operations, after-hours access)\r\n * - Pagination with configurable page size\r\n * - Export functionality for regulatory reporting\r\n *\r\n * **Audit Log Fields:**\r\n * - Timestamp: When the action occurred\r\n * - Action: Type of action performed (PHI_VIEW, POLICY_ACKNOWLEDGMENT, etc.)\r\n * - Severity: Log severity level (INFO, WARNING, ERROR, CRITICAL, SECURITY)\r\n * - User: Who performed the action (name, role, ID)\r\n * - Resource: What was accessed (type and ID)\r\n * - IP Address: Source IP of the request\r\n * - Status: Operation outcome (SUCCESS, FAILURE, etc.)\r\n * - Verification Hash: SHA-256 hash of current log entry\r\n * - Previous Hash: SHA-256 hash of previous entry (blockchain pattern)\r\n *\r\n * @example\r\n * ```tsx\r\n * // URL: /compliance/audits?page=1&phiOnly=true&severity=CRITICAL\r\n * // Displays page 1 of audit logs, filtered to show only critical PHI access events\r\n *\r\n * <AuditLogsPage\r\n *   searchParams={{\r\n *     page: '1',\r\n *     phiOnly: 'true',\r\n *     severity: 'CRITICAL'\r\n *   }}\r\n * />\r\n * ```\r\n *\r\n * @remarks\r\n * This is a Next.js 16 Server Component with dynamic rendering enabled.\r\n * All data is fetched server-side to protect sensitive audit information.\r\n * Client-side filtering is intentionally avoided to prevent data exposure.\r\n *\r\n * @see {@link getAuditLogs} for server-side data fetching\r\n * @see {@link https://www.hhs.gov/hipaa/for-professionals/security/laws-regulations/index.html | HIPAA Security Rule}\r\n */\r\nexport default async function AuditLogsPage({ searchParams }: AuditLogsPageProps) {\r\n  const page = parseInt(searchParams.page || '1');\r\n  const filters = {\r\n    action: searchParams.action,\r\n    severity: searchParams.severity,\r\n    startDate: searchParams.startDate,\r\n    endDate: searchParams.endDate,\r\n    userId: searchParams.userId,\r\n    phiOnly: searchParams.phiOnly === 'true',\r\n  };\r\n\r\n  // Get audit logs with proper server action\r\n  const result = await getAuditLogsAction({\r\n    ...filters,\r\n    page,\r\n    pageSize: 50 // Default page size\r\n  });\r\n\r\n  if (!result.success) {\r\n    throw new Error(result.error || 'Failed to fetch audit logs');\r\n  }\r\n\r\n  const auditData = result.data!;\r\n  const logs = auditData.data;\r\n  const pagination = {\r\n    ...auditData.pagination,\r\n    start: (auditData.pagination.page - 1) * auditData.pagination.pageSize + 1,\r\n    end: Math.min(auditData.pagination.page * auditData.pagination.pageSize, auditData.pagination.total),\r\n  };\r\n  const chainStatus = {\r\n    ...auditData.chainStatus,\r\n    verifiedCount: logs.length, // Assume all logs are verified for now\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold tracking-tight\">Audit Logs</h1>\r\n          <p className=\"text-muted-foreground mt-1\">\r\n            Comprehensive audit trail with cryptographic verification\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <Button variant=\"outline\">\r\n            <Filter className=\"mr-2 h-4 w-4\" />\r\n            Filters\r\n          </Button>\r\n          <Button variant=\"outline\">\r\n            <Download className=\"mr-2 h-4 w-4\" />\r\n            Export\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Chain Integrity Status */}\r\n      <Card className=\"border-l-4 border-l-green-500\">\r\n        <CardContent className=\"pt-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              {chainStatus.valid ? (\r\n                <CheckCircle className=\"h-6 w-6 text-green-600\" />\r\n              ) : (\r\n                <XCircle className=\"h-6 w-6 text-red-600\" />\r\n              )}\r\n              <div>\r\n                <h3 className=\"font-semibold\">\r\n                  {chainStatus.valid ? 'Audit Chain Verified' : 'Audit Chain Compromised'}\r\n                </h3>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {chainStatus.valid\r\n                    ? `All ${chainStatus.verifiedCount} logs verified with SHA-256 hash chain`\r\n                    : `Tampering detected at log entry #${chainStatus.firstInvalidIndex}`}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <Badge variant={chainStatus.valid ? 'default' : 'destructive'} className=\"gap-2\">\r\n              <Shield className=\"h-3 w-3\" />\r\n              {chainStatus.valid ? 'Tamper-Proof' : 'Compromised'}\r\n            </Badge>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Filter Summary */}\r\n      {(filters.action || filters.severity || filters.phiOnly) && (\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-2 flex-wrap\">\r\n              <span className=\"text-sm font-medium\">Active Filters:</span>\r\n              {filters.action && (\r\n                <Badge variant=\"secondary\">\r\n                  Action: {filters.action}\r\n                  <button className=\"ml-2\"></button>\r\n                </Badge>\r\n              )}\r\n              {filters.severity && (\r\n                <Badge variant=\"secondary\">\r\n                  Severity: {filters.severity}\r\n                  <button className=\"ml-2\"></button>\r\n                </Badge>\r\n              )}\r\n              {filters.phiOnly && (\r\n                <Badge variant=\"secondary\">\r\n                  PHI Access Only\r\n                  <button className=\"ml-2\"></button>\r\n                </Badge>\r\n              )}\r\n              <Button variant=\"ghost\" size=\"sm\">\r\n                Clear All\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Audit Logs Table */}\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <CardTitle>Audit Log Entries</CardTitle>\r\n            <div className=\"text-sm text-muted-foreground\">\r\n              Showing {pagination.start}-{pagination.end} of {pagination.total}\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-2\">\r\n            {logs.map((log, index) => (\r\n              <div\r\n                key={log.id}\r\n                className=\"flex items-start justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors\"\r\n              >\r\n                <div className=\"flex items-start gap-4 flex-1\">\r\n                  {/* Verification Status */}\r\n                  <div className=\"flex flex-col items-center gap-1\">\r\n                    {log.verified ? (\r\n                      <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                    ) : (\r\n                      <AlertTriangle className=\"h-4 w-4 text-red-600\" />\r\n                    )}\r\n                    <span className=\"text-xs text-muted-foreground\">\r\n                      #{index + 1}\r\n                    </span>\r\n                  </div>\r\n\r\n                  {/* Log Details */}\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex items-center gap-2 flex-wrap\">\r\n                      <Badge variant={getSeverityVariant(log.severity)}>\r\n                        {log.severity}\r\n                      </Badge>\r\n                      <span className=\"font-semibold text-sm\">{log.action}</span>\r\n                      {log.phiAccessed && (\r\n                        <Badge variant=\"outline\" className=\"bg-amber-50 border-amber-200\">\r\n                          PHI\r\n                        </Badge>\r\n                      )}\r\n                      {log.complianceFlags && log.complianceFlags.length > 0 && (\r\n                        <Badge variant=\"outline\" className=\"bg-red-50 border-red-200\">\r\n                          {log.complianceFlags[0]}\r\n                        </Badge>\r\n                      )}\r\n                    </div>\r\n\r\n                    <div className=\"mt-2 grid grid-cols-2 gap-x-4 gap-y-1 text-sm\">\r\n                      <div>\r\n                        <span className=\"text-muted-foreground\">User:</span>{' '}\r\n                        <span className=\"font-medium\">{log.userName}</span>\r\n                        <span className=\"text-muted-foreground ml-1\">({log.userRole})</span>\r\n                      </div>\r\n                      <div>\r\n                        <span className=\"text-muted-foreground\">Timestamp:</span>{' '}\r\n                        <span>{formatTimestamp(log.timestamp)}</span>\r\n                      </div>\r\n                      {log.resourceType && (\r\n                        <div>\r\n                          <span className=\"text-muted-foreground\">Resource:</span>{' '}\r\n                          <span>{log.resourceType}</span>\r\n                          {log.resourceId && (\r\n                            <span className=\"text-muted-foreground ml-1\">#{log.resourceId.slice(0, 8)}</span>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n                      <div>\r\n                        <span className=\"text-muted-foreground\">IP:</span>{' '}\r\n                        <span className=\"font-mono text-xs\">{log.ipAddress}</span>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {log.details && Object.keys(log.details).length > 0 && (\r\n                      <div className=\"mt-2 text-xs text-muted-foreground\">\r\n                        <span>Details:</span>{' '}\r\n                        <span className=\"font-mono\">{JSON.stringify(log.details).slice(0, 100)}...</span>\r\n                      </div>\r\n                    )}\r\n\r\n                    <div className=\"mt-2 text-xs text-muted-foreground font-mono\">\r\n                      Hash: {log.verificationHash.slice(0, 16)}...\r\n                      {log.previousHash && (\r\n                        <span className=\"ml-2\">\r\n                          Prev: {log.previousHash.slice(0, 16)}...\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Status */}\r\n                  <div className=\"text-right\">\r\n                    <Badge variant={log.status === 'SUCCESS' ? 'default' : 'destructive'}>\r\n                      {log.status}\r\n                    </Badge>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Pagination */}\r\n          <div className=\"flex items-center justify-between mt-6\">\r\n            <div className=\"text-sm text-muted-foreground\">\r\n              Page {pagination.page} of {pagination.pages}\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                disabled={page <= 1}\r\n                asChild={page > 1}\r\n              >\r\n                {page > 1 ? (\r\n                  <Link href={`/compliance/audits?page=${page - 1}`}>Previous</Link>\r\n                ) : (\r\n                  <span>Previous</span>\r\n                )}\r\n              </Button>\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                disabled={page >= pagination.pages}\r\n                asChild={page < pagination.pages}\r\n              >\r\n                {page < pagination.pages ? (\r\n                  <Link href={`/compliance/audits?page=${page + 1}`}>Next</Link>\r\n                ) : (\r\n                  <span>Next</span>\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Fetches audit logs with filtering and pagination\r\n *\r\n * Server action that retrieves audit log entries from the database with applied filters.\r\n * Performs cryptographic verification of the entire audit chain to detect tampering.\r\n *\r\n * @async\r\n * @param {number} page - Page number for pagination (1-indexed)\r\n * @param {Object} filters - Filter criteria for audit logs\r\n * @param {string} [filters.action] - Filter by action type\r\n * @param {string} [filters.severity] - Filter by severity level\r\n * @param {string} [filters.startDate] - Filter from this date (ISO 8601)\r\n * @param {string} [filters.endDate] - Filter until this date (ISO 8601)\r\n * @param {string} [filters.userId] - Filter by user ID\r\n * @param {boolean} [filters.phiOnly] - Filter to show only PHI access logs\r\n * @returns {Promise<Object>} Audit logs, pagination info, and chain verification status\r\n * @returns {Array<Object>} return.logs - Array of audit log entries\r\n * @returns {Object} return.pagination - Pagination metadata\r\n * @returns {Object} return.chainStatus - Audit chain verification status\r\n *\r\n * @description\r\n * **Verification Process:**\r\n * 1. Fetches requested page of audit logs from database\r\n * 2. Verifies each log entry's hash against stored hash\r\n * 3. Verifies hash chain by checking previousHash links\r\n * 4. Reports any tampering detected in the chain\r\n *\r\n * **Performance Considerations:**\r\n * - Verification performed on current page only for performance\r\n * - Full chain verification available via separate endpoint\r\n * - Uses database indexes on timestamp, userId, action for fast filtering\r\n *\r\n * @example\r\n * ```typescript\r\n * const { logs, pagination, chainStatus } = await getAuditLogs(1, {\r\n *   phiOnly: true,\r\n *   severity: 'CRITICAL',\r\n *   startDate: '2024-01-01T00:00:00Z',\r\n *   endDate: '2024-12-31T23:59:59Z'\r\n * });\r\n *\r\n * console.log(`Chain valid: ${chainStatus.valid}`);\r\n * console.log(`Retrieved ${logs.length} audit entries`);\r\n * ```\r\n *\r\n * @todo Implement real SHA-256 hash verification\r\n * @todo Add rate limiting to prevent audit log enumeration\r\n */\r\n/**\r\n * Maps audit log severity level to UI badge variant\r\n *\r\n * Determines the visual styling for severity badges based on the severity level.\r\n * Critical and security events are styled with destructive (red) variants for\r\n * immediate visibility.\r\n *\r\n * @param {string} severity - Severity level of the audit log entry\r\n * @returns {'default' | 'secondary' | 'destructive' | 'outline'} Badge variant for styling\r\n *\r\n * @description\r\n * **Severity Levels:**\r\n * - INFO: Standard informational events (default styling)\r\n * - WARNING: Potential issues requiring attention (outline styling)\r\n * - ERROR: Errors that occurred during operations (destructive/red styling)\r\n * - CRITICAL: Critical security or compliance events (destructive/red styling)\r\n * - SECURITY: Security-related events (destructive/red styling)\r\n *\r\n * @example\r\n * ```tsx\r\n * <Badge variant={getSeverityVariant('CRITICAL')}>CRITICAL</Badge>\r\n * // Renders: <Badge variant=\"destructive\">CRITICAL</Badge>\r\n * ```\r\n */\r\nfunction getSeverityVariant(severity: string): 'default' | 'secondary' | 'destructive' | 'outline' {\r\n  const variants = {\r\n    INFO: 'default' as const,\r\n    WARNING: 'outline' as const,\r\n    ERROR: 'destructive' as const,\r\n    CRITICAL: 'destructive' as const,\r\n    SECURITY: 'destructive' as const,\r\n  };\r\n  return variants[severity as keyof typeof variants] || 'default';\r\n}\r\n\r\n/**\r\n * Formats ISO 8601 timestamp to human-readable format\r\n *\r\n * Converts ISO 8601 timestamp string to localized date-time string suitable\r\n * for display in audit logs. Uses en-US locale with 12-hour time format.\r\n *\r\n * @param {string} timestamp - ISO 8601 timestamp string (e.g., '2024-01-15T14:30:00Z')\r\n * @returns {string} Formatted timestamp (e.g., 'Jan 15, 2024, 02:30:00 PM')\r\n *\r\n * @example\r\n * ```typescript\r\n * const formatted = formatTimestamp('2024-01-15T14:30:00Z');\r\n * console.log(formatted); // \"Jan 15, 2024, 02:30:00 PM\"\r\n * ```\r\n *\r\n * @remarks\r\n * Uses browser's Intl.DateTimeFormat for localization.\r\n * Displays full date with seconds for audit trail precision.\r\n */\r\nfunction formatTimestamp(timestamp: string): string {\r\n  const date = new Date(timestamp);\r\n  return date.toLocaleString('en-US', {\r\n    month: 'short',\r\n    day: 'numeric',\r\n    year: 'numeric',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    second: '2-digit',\r\n  });\r\n}\r\n\r\n\r\n\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAiCC;;;;;;;AAID;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AAAA;;;;;;;;AAKO,MAAM,WAAqB;IAChC,OAAO;IACP,aAAa;AACf;AA8Fe,eAAe,cAAc,EAAE,YAAY,EAAsB;IAC9E,MAAM,OAAO,SAAS,aAAa,IAAI,IAAI;IAC3C,MAAM,UAAU;QACd,QAAQ,aAAa,MAAM;QAC3B,UAAU,aAAa,QAAQ;QAC/B,WAAW,aAAa,SAAS;QACjC,SAAS,aAAa,OAAO;QAC7B,QAAQ,aAAa,MAAM;QAC3B,SAAS,aAAa,OAAO,KAAK;IACpC;IAEA,2CAA2C;IAC3C,MAAM,SAAS,MAAM,IAAA,kKAAkB,EAAC;QACtC,GAAG,OAAO;QACV;QACA,UAAU,GAAG,oBAAoB;IACnC;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,IAAI,MAAM,OAAO,KAAK,IAAI;IAClC;IAEA,MAAM,YAAY,OAAO,IAAI;IAC7B,MAAM,OAAO,UAAU,IAAI;IAC3B,MAAM,aAAa;QACjB,GAAG,UAAU,UAAU;QACvB,OAAO,CAAC,UAAU,UAAU,CAAC,IAAI,GAAG,CAAC,IAAI,UAAU,UAAU,CAAC,QAAQ,GAAG;QACzE,KAAK,KAAK,GAAG,CAAC,UAAU,UAAU,CAAC,IAAI,GAAG,UAAU,UAAU,CAAC,QAAQ,EAAE,UAAU,UAAU,CAAC,KAAK;IACrG;IACA,MAAM,cAAc;QAClB,GAAG,UAAU,WAAW;QACxB,eAAe,KAAK,MAAM;IAC5B;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;0CACC,8OAAC;gCAAG,WAAU;0CAAoC;;;;;;0CAClD,8OAAC;gCAAE,WAAU;0CAA6B;;;;;;;;;;;;kCAI5C,8OAAC;wBAAI,WAAU;;0CACb,8OAAC,4IAAM;gCAAC,SAAQ;;kDACd,8OAAC,gNAAM;wCAAC,WAAU;;;;;;oCAAiB;;;;;;;0CAGrC,8OAAC,4IAAM;gCAAC,SAAQ;;kDACd,8OAAC,sNAAQ;wCAAC,WAAU;;;;;;oCAAiB;;;;;;;;;;;;;;;;;;;0BAO3C,8OAAC,wIAAI;gBAAC,WAAU;0BACd,cAAA,8OAAC,+IAAW;oBAAC,WAAU;8BACrB,cAAA,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;;oCACZ,YAAY,KAAK,iBAChB,8OAAC,0OAAW;wCAAC,WAAU;;;;;6DAEvB,8OAAC,uNAAO;wCAAC,WAAU;;;;;;kDAErB,8OAAC;;0DACC,8OAAC;gDAAG,WAAU;0DACX,YAAY,KAAK,GAAG,yBAAyB;;;;;;0DAEhD,8OAAC;gDAAE,WAAU;0DACV,YAAY,KAAK,GACd,CAAC,IAAI,EAAE,YAAY,aAAa,CAAC,sCAAsC,CAAC,GACxE,CAAC,iCAAiC,EAAE,YAAY,iBAAiB,EAAE;;;;;;;;;;;;;;;;;;0CAI7E,8OAAC,0IAAK;gCAAC,SAAS,YAAY,KAAK,GAAG,YAAY;gCAAe,WAAU;;kDACvE,8OAAC,gNAAM;wCAAC,WAAU;;;;;;oCACjB,YAAY,KAAK,GAAG,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;YAO7C,CAAC,QAAQ,MAAM,IAAI,QAAQ,QAAQ,IAAI,QAAQ,OAAO,mBACrD,8OAAC,wIAAI;0BACH,cAAA,8OAAC,+IAAW;oBAAC,WAAU;8BACrB,cAAA,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAK,WAAU;0CAAsB;;;;;;4BACrC,QAAQ,MAAM,kBACb,8OAAC,0IAAK;gCAAC,SAAQ;;oCAAY;oCAChB,QAAQ,MAAM;kDACvB,8OAAC;wCAAO,WAAU;kDAAO;;;;;;;;;;;;4BAG5B,QAAQ,QAAQ,kBACf,8OAAC,0IAAK;gCAAC,SAAQ;;oCAAY;oCACd,QAAQ,QAAQ;kDAC3B,8OAAC;wCAAO,WAAU;kDAAO;;;;;;;;;;;;4BAG5B,QAAQ,OAAO,kBACd,8OAAC,0IAAK;gCAAC,SAAQ;;oCAAY;kDAEzB,8OAAC;wCAAO,WAAU;kDAAO;;;;;;;;;;;;0CAG7B,8OAAC,4IAAM;gCAAC,SAAQ;gCAAQ,MAAK;0CAAK;;;;;;;;;;;;;;;;;;;;;;0BAS1C,8OAAC,wIAAI;;kCACH,8OAAC,8IAAU;kCACT,cAAA,8OAAC;4BAAI,WAAU;;8CACb,8OAAC,6IAAS;8CAAC;;;;;;8CACX,8OAAC;oCAAI,WAAU;;wCAAgC;wCACpC,WAAW,KAAK;wCAAC;wCAAE,WAAW,GAAG;wCAAC;wCAAK,WAAW,KAAK;;;;;;;;;;;;;;;;;;kCAItE,8OAAC,+IAAW;;0CACV,8OAAC;gCAAI,WAAU;0CACZ,KAAK,GAAG,CAAC,CAAC,KAAK,sBACd,8OAAC;wCAEC,WAAU;kDAEV,cAAA,8OAAC;4CAAI,WAAU;;8DAEb,8OAAC;oDAAI,WAAU;;wDACZ,IAAI,QAAQ,iBACX,8OAAC,0OAAW;4DAAC,WAAU;;;;;iFAEvB,8OAAC,yOAAa;4DAAC,WAAU;;;;;;sEAE3B,8OAAC;4DAAK,WAAU;;gEAAgC;gEAC5C,QAAQ;;;;;;;;;;;;;8DAKd,8OAAC;oDAAI,WAAU;;sEACb,8OAAC;4DAAI,WAAU;;8EACb,8OAAC,0IAAK;oEAAC,SAAS,mBAAmB,IAAI,QAAQ;8EAC5C,IAAI,QAAQ;;;;;;8EAEf,8OAAC;oEAAK,WAAU;8EAAyB,IAAI,MAAM;;;;;;gEAClD,IAAI,WAAW,kBACd,8OAAC,0IAAK;oEAAC,SAAQ;oEAAU,WAAU;8EAA+B;;;;;;gEAInE,IAAI,eAAe,IAAI,IAAI,eAAe,CAAC,MAAM,GAAG,mBACnD,8OAAC,0IAAK;oEAAC,SAAQ;oEAAU,WAAU;8EAChC,IAAI,eAAe,CAAC,EAAE;;;;;;;;;;;;sEAK7B,8OAAC;4DAAI,WAAU;;8EACb,8OAAC;;sFACC,8OAAC;4EAAK,WAAU;sFAAwB;;;;;;wEAAa;sFACrD,8OAAC;4EAAK,WAAU;sFAAe,IAAI,QAAQ;;;;;;sFAC3C,8OAAC;4EAAK,WAAU;;gFAA6B;gFAAE,IAAI,QAAQ;gFAAC;;;;;;;;;;;;;8EAE9D,8OAAC;;sFACC,8OAAC;4EAAK,WAAU;sFAAwB;;;;;;wEAAkB;sFAC1D,8OAAC;sFAAM,gBAAgB,IAAI,SAAS;;;;;;;;;;;;gEAErC,IAAI,YAAY,kBACf,8OAAC;;sFACC,8OAAC;4EAAK,WAAU;sFAAwB;;;;;;wEAAiB;sFACzD,8OAAC;sFAAM,IAAI,YAAY;;;;;;wEACtB,IAAI,UAAU,kBACb,8OAAC;4EAAK,WAAU;;gFAA6B;gFAAE,IAAI,UAAU,CAAC,KAAK,CAAC,GAAG;;;;;;;;;;;;;8EAI7E,8OAAC;;sFACC,8OAAC;4EAAK,WAAU;sFAAwB;;;;;;wEAAW;sFACnD,8OAAC;4EAAK,WAAU;sFAAqB,IAAI,SAAS;;;;;;;;;;;;;;;;;;wDAIrD,IAAI,OAAO,IAAI,OAAO,IAAI,CAAC,IAAI,OAAO,EAAE,MAAM,GAAG,mBAChD,8OAAC;4DAAI,WAAU;;8EACb,8OAAC;8EAAK;;;;;;gEAAgB;8EACtB,8OAAC;oEAAK,WAAU;;wEAAa,KAAK,SAAS,CAAC,IAAI,OAAO,EAAE,KAAK,CAAC,GAAG;wEAAK;;;;;;;;;;;;;sEAI3E,8OAAC;4DAAI,WAAU;;gEAA+C;gEACrD,IAAI,gBAAgB,CAAC,KAAK,CAAC,GAAG;gEAAI;gEACxC,IAAI,YAAY,kBACf,8OAAC;oEAAK,WAAU;;wEAAO;wEACd,IAAI,YAAY,CAAC,KAAK,CAAC,GAAG;wEAAI;;;;;;;;;;;;;;;;;;;8DAO7C,8OAAC;oDAAI,WAAU;8DACb,cAAA,8OAAC,0IAAK;wDAAC,SAAS,IAAI,MAAM,KAAK,YAAY,YAAY;kEACpD,IAAI,MAAM;;;;;;;;;;;;;;;;;uCAhFZ,IAAI,EAAE;;;;;;;;;;0CAyFjB,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;;4CAAgC;4CACvC,WAAW,IAAI;4CAAC;4CAAK,WAAW,KAAK;;;;;;;kDAE7C,8OAAC;wCAAI,WAAU;;0DACb,8OAAC,4IAAM;gDACL,SAAQ;gDACR,MAAK;gDACL,UAAU,QAAQ;gDAClB,SAAS,OAAO;0DAEf,OAAO,kBACN,8OAAC,0LAAI;oDAAC,MAAM,CAAC,wBAAwB,EAAE,OAAO,GAAG;8DAAE;;;;;yEAEnD,8OAAC;8DAAK;;;;;;;;;;;0DAGV,8OAAC,4IAAM;gDACL,SAAQ;gDACR,MAAK;gDACL,UAAU,QAAQ,WAAW,KAAK;gDAClC,SAAS,OAAO,WAAW,KAAK;0DAE/B,OAAO,WAAW,KAAK,iBACtB,8OAAC,0LAAI;oDAAC,MAAM,CAAC,wBAAwB,EAAE,OAAO,GAAG;8DAAE;;;;;yEAEnD,8OAAC;8DAAK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASxB;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA+CC,GACD;;;;;;;;;;;;;;;;;;;;;;;CAuBC,GACD,SAAS,mBAAmB,QAAgB;IAC1C,MAAM,WAAW;QACf,MAAM;QACN,SAAS;QACT,OAAO;QACP,UAAU;QACV,UAAU;IACZ;IACA,OAAO,QAAQ,CAAC,SAAkC,IAAI;AACxD;AAEA;;;;;;;;;;;;;;;;;;CAkBC,GACD,SAAS,gBAAgB,SAAiB;IACxC,MAAM,OAAO,IAAI,KAAK;IACtB,OAAO,KAAK,cAAc,CAAC,SAAS;QAClC,OAAO;QACP,KAAK;QACL,MAAM;QACN,MAAM;QACN,QAAQ;QACR,QAAQ;IACV;AACF","debugId":null}}]
}