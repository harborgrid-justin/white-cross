/**
 * @fileoverview Vulnerability Management Interface
 * @module interfaces/models/vulnerability
 * @description Vulnerability tracking and management data model
 */

import { IBaseEntity, ITaggableEntity, ISearchableEntity } from './base-entity.interface';
import {
  VulnerabilitySeverity,
  VulnerabilityStatus,
  VulnerabilityType,
  AttackVector,
  AttackComplexity,
  PrivilegesRequired,
  UserInteraction,
  ImpactRating
} from '../enums/vulnerability-types.enum';

/**
 * Vulnerability interface
 */
export interface IVulnerability extends IBaseEntity, ITaggableEntity, ISearchableEntity {
  /** Vulnerability title */
  title: string;

  /** Detailed description */
  description: string;

  /** Vulnerability type */
  type: VulnerabilityType;

  /** Severity level */
  severity: VulnerabilitySeverity;

  /** Current status */
  status: VulnerabilityStatus;

  /** CVE ID (if applicable) */
  cveId?: string;

  /** CWE ID (Common Weakness Enumeration) */
  cweId?: string;

  /** CVSS v3 score */
  cvssScore?: number;

  /** CVSS v3 vector string */
  cvssVector?: string;

  /** CVSS metrics breakdown */
  cvssMetrics?: ICVSSMetrics;

  /** Affected systems/assets */
  affectedSystems: string[];

  /** Affected software/products */
  affectedProducts?: IaffectedProduct[];

  /** Affected versions */
  affectedVersions?: string[];

  /** Discovery date */
  discoveredAt: Date;

  /** Reported date */
  reportedAt?: Date;

  /** Published date */
  publishedAt?: Date;

  /** Disclosure date */
  disclosedAt?: Date;

  /** Last updated date */
  lastUpdatedAt?: Date;

  /** Proof of concept available */
  pocAvailable?: boolean;

  /** Exploit available */
  exploitAvailable?: boolean;

  /** Actively exploited */
  activelyExploited?: boolean;

  /** Exploit maturity */
  exploitMaturity?: 'UNPROVEN' | 'PROOF_OF_CONCEPT' | 'FUNCTIONAL' | 'HIGH' | 'NOT_DEFINED';

  /** Remediation available */
  remediationAvailable?: boolean;

  /** Remediation level */
  remediationLevel?: 'OFFICIAL_FIX' | 'TEMPORARY_FIX' | 'WORKAROUND' | 'UNAVAILABLE' | 'NOT_DEFINED';

  /** Remediation steps */
  remediation?: string[];

  /** Workaround available */
  workaround?: string;

  /** Patch information */
  patchInfo?: IPatchInfo;

  /** Vendor advisory URLs */
  vendorAdvisories?: string[];

  /** External references */
  externalReferences?: IExternalReference[];

  /** Risk assessment */
  riskAssessment?: IRiskAssessment;

  /** Business impact */
  businessImpact?: string;

  /** Technical impact */
  technicalImpact?: string;

  /** Assigned to (for remediation) */
  assignedTo?: string;

  /** Due date for remediation */
  dueDate?: Date;

  /** Target resolution date */
  targetResolutionDate?: Date;

  /** Actual resolution date */
  actualResolutionDate?: Date;

  /** SLA status */
  slaStatus?: 'ON_TRACK' | 'AT_RISK' | 'BREACHED';

  /** Related threat intelligence IDs */
  relatedThreats?: string[];

  /** Related incident IDs */
  relatedIncidents?: string[];

  /** Related vulnerability IDs */
  relatedVulnerabilities?: string[];

  /** Source of discovery */
  discoverySource?: 'INTERNAL_SCAN' | 'EXTERNAL_SCAN' | 'PENETRATION_TEST' | 'BUG_BOUNTY' | 'VENDOR' | 'RESEARCHER' | 'OTHER';

  /** Scanner that detected it */
  scanner?: string;

  /** Scan ID */
  scanId?: string;

  /** False positive indicator */
  isFalsePositive?: boolean;

  /** Acceptance justification (if risk accepted) */
  acceptanceJustification?: string;

  /** Accepted by */
  acceptedBy?: string;

  /** Acceptance date */
  acceptedAt?: Date;

  /** Custom fields */
  customFields?: Record<string, any>;
}

/**
 * CVSS v3 metrics
 */
export interface ICVSSMetrics {
  /** Base score (0.0 - 10.0) */
  baseScore: number;

  /** Base severity */
  baseSeverity: VulnerabilitySeverity;

  /** Temporal score */
  temporalScore?: number;

  /** Environmental score */
  environmentalScore?: number;

  /** Attack vector */
  attackVector: AttackVector;

  /** Attack complexity */
  attackComplexity: AttackComplexity;

  /** Privileges required */
  privilegesRequired: PrivilegesRequired;

  /** User interaction */
  userInteraction: UserInteraction;

  /** Scope */
  scope: 'UNCHANGED' | 'CHANGED';

  /** Confidentiality impact */
  confidentialityImpact: ImpactRating;

  /** Integrity impact */
  integrityImpact: ImpactRating;

  /** Availability impact */
  availabilityImpact: ImpactRating;

  /** Exploit code maturity */
  exploitCodeMaturity?: 'UNPROVEN' | 'PROOF_OF_CONCEPT' | 'FUNCTIONAL' | 'HIGH' | 'NOT_DEFINED';

  /** Remediation level */
  remediationLevel?: 'OFFICIAL_FIX' | 'TEMPORARY_FIX' | 'WORKAROUND' | 'UNAVAILABLE' | 'NOT_DEFINED';

  /** Report confidence */
  reportConfidence?: 'UNKNOWN' | 'REASONABLE' | 'CONFIRMED' | 'NOT_DEFINED';
}

/**
 * Affected product information
 */
export interface IaffectedProduct {
  /** Vendor name */
  vendor: string;

  /** Product name */
  product: string;

  /** Affected versions */
  versions: string[];

  /** Fixed versions */
  fixedVersions?: string[];

  /** CPE (Common Platform Enumeration) */
  cpe?: string;

  /** Platform */
  platform?: string;
}

/**
 * Patch information
 */
export interface IPatchInfo {
  /** Patch available */
  available: boolean;

  /** Patch version */
  version?: string;

  /** Patch release date */
  releaseDate?: Date;

  /** Patch URL */
  url?: string;

  /** Patch description */
  description?: string;

  /** Installation instructions */
  installationInstructions?: string;

  /** Requires restart */
  requiresRestart?: boolean;

  /** Patch testing status */
  testingStatus?: 'NOT_TESTED' | 'TESTING' | 'TESTED' | 'APPROVED';
}

/**
 * External reference
 */
export interface IExternalReference {
  /** Source name */
  source: string;

  /** URL */
  url?: string;

  /** Reference type */
  type?: 'ADVISORY' | 'ARTICLE' | 'BLOG' | 'FORUM' | 'MAILING_LIST' | 'TOOL' | 'OTHER';

  /** Description */
  description?: string;
}

/**
 * Risk assessment
 */
export interface IRiskAssessment {
  /** Likelihood (1-5) */
  likelihood: number;

  /** Impact (1-5) */
  impact: number;

  /** Risk score (calculated: likelihood * impact) */
  riskScore: number;

  /** Risk level */
  riskLevel: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';

  /** Asset criticality */
  assetCriticality?: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';

  /** Exploitability */
  exploitability?: 'LOW' | 'MEDIUM' | 'HIGH';

  /** Business context */
  businessContext?: string;

  /** Compensating controls */
  compensatingControls?: string[];

  /** Risk acceptance required */
  riskAcceptanceRequired?: boolean;

  /** Assessment date */
  assessmentDate: Date;

  /** Assessed by */
  assessedBy: string;

  /** Review date */
  reviewDate?: Date;
}

/**
 * Vulnerability scan result
 */
export interface IVulnerabilityScan {
  /** Scan ID */
  id: string;

  /** Scan name */
  name: string;

  /** Scanner */
  scanner: string;

  /** Scan type */
  type: 'NETWORK' | 'WEB_APP' | 'HOST' | 'CONTAINER' | 'CLOUD' | 'CODE';

  /** Start time */
  startedAt: Date;

  /** End time */
  completedAt?: Date;

  /** Status */
  status: 'RUNNING' | 'COMPLETED' | 'FAILED' | 'CANCELLED';

  /** Targets scanned */
  targets: string[];

  /** Total vulnerabilities found */
  totalVulnerabilities: number;

  /** Vulnerabilities by severity */
  vulnerabilitiesBySeverity: {
    critical: number;
    high: number;
    medium: number;
    low: number;
    info: number;
  };

  /** Scan results */
  results?: IVulnerability[];

  /** Scan report URL */
  reportUrl?: string;

  /** Scan configuration */
  configuration?: Record<string, any>;
}
