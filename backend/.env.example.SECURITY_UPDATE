# =============================================================================
# SECURITY CONFIGURATION - White Cross Healthcare Platform
# =============================================================================
# CRITICAL: Review and configure all security settings before deployment
# This file contains security-related environment variables for the NestJS backend

# -----------------------------------------------------------------------------
# JWT Authentication Configuration
# -----------------------------------------------------------------------------

# JWT Secret: CRITICAL - Must be at least 32 characters
# Generate with: openssl rand -base64 32
# NEVER commit the actual secret to version control
JWT_SECRET=your-super-secret-jwt-key-min-32-chars-required-change-this-in-production

# JWT Refresh Secret: Separate secret for refresh tokens (optional but recommended)
# Generate with: openssl rand -base64 32
JWT_REFRESH_SECRET=your-refresh-token-secret-min-32-chars-change-this-in-production

# JWT Expiration Times
JWT_ACCESS_TOKEN_EXPIRATION=15m
JWT_REFRESH_TOKEN_EXPIRATION=7d

# -----------------------------------------------------------------------------
# Password Hashing Configuration
# -----------------------------------------------------------------------------

# bcrypt Salt Rounds: Recommended 12 for healthcare applications
# Higher = More secure but slower (10-14 recommended)
# 10 = ~100ms, 11 = ~200ms, 12 = ~400ms (recommended), 13 = ~800ms, 14 = ~1600ms
BCRYPT_SALT_ROUNDS=12

# -----------------------------------------------------------------------------
# CSRF Protection
# -----------------------------------------------------------------------------

# CSRF Secret: CRITICAL - Used for CSRF token generation
# Generate with: openssl rand -base64 32
CSRF_SECRET=your-csrf-secret-min-32-chars-change-this-in-production

# CSRF Token Lifetime (milliseconds)
CSRF_TOKEN_LIFETIME=86400000

# -----------------------------------------------------------------------------
# CORS Configuration
# -----------------------------------------------------------------------------

# CORS Allowed Origins: Comma-separated list of allowed origins
# CRITICAL: NEVER use "*" in production
# Development: http://localhost:3000
# Production: https://app.whitecross.health,https://admin.whitecross.health
CORS_ORIGIN=http://localhost:3000

# -----------------------------------------------------------------------------
# Encryption Keys
# -----------------------------------------------------------------------------

# Encryption Key: CRITICAL - Used for field-level encryption (PHI data)
# Generate with: openssl rand -base64 32
# Used to encrypt sensitive PHI fields (SSN, medical records, etc.)
ENCRYPTION_KEY=your-encryption-key-min-32-chars-change-this-in-production

# Encryption Algorithm (AES-256-GCM recommended for HIPAA compliance)
ENCRYPTION_ALGORITHM=aes-256-gcm

# -----------------------------------------------------------------------------
# Redis Configuration (Token Blacklist, Rate Limiting, Session Storage)
# -----------------------------------------------------------------------------

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your-redis-password-if-required
REDIS_DB=0
REDIS_BLACKLIST_DB=2

# Enable Redis Adapter for WebSocket horizontal scaling
ENABLE_REDIS_ADAPTER=true

# -----------------------------------------------------------------------------
# Rate Limiting Configuration
# -----------------------------------------------------------------------------

# Enable Rate Limiting
RATE_LIMIT_ENABLED=true

# Default Rate Limits (requests per time window)
RATE_LIMIT_AUTH_MAX=5
RATE_LIMIT_AUTH_WINDOW=900000

RATE_LIMIT_API_MAX=100
RATE_LIMIT_API_WINDOW=60000

RATE_LIMIT_EXPORT_MAX=10
RATE_LIMIT_EXPORT_WINDOW=3600000

# -----------------------------------------------------------------------------
# Session Management
# -----------------------------------------------------------------------------

# Session Secret: Used for session signing
# Generate with: openssl rand -base64 32
SESSION_SECRET=your-session-secret-min-32-chars-change-this-in-production

# Session Lifetime (milliseconds)
SESSION_LIFETIME=86400000

# Maximum Concurrent Sessions per User
MAX_CONCURRENT_SESSIONS=3

# -----------------------------------------------------------------------------
# IP Restriction Configuration
# -----------------------------------------------------------------------------

# Enable IP Whitelist Mode (requires IP to be whitelisted)
IP_WHITELIST_ENABLED=false

# Enable IP Blacklist Checking
IP_BLACKLIST_ENABLED=true

# GeoIP Database Path (MaxMind GeoLite2 or similar)
GEOIP_DATABASE_PATH=/opt/geoip/GeoLite2-City.mmdb

# -----------------------------------------------------------------------------
# API Key Configuration
# -----------------------------------------------------------------------------

# API Key Hash Algorithm (SHA-256 recommended)
API_KEY_HASH_ALGORITHM=sha256

# API Key Default Expiration (days)
API_KEY_DEFAULT_EXPIRATION=365

# API Key Default Rate Limit (requests per minute)
API_KEY_DEFAULT_RATE_LIMIT=1000

# -----------------------------------------------------------------------------
# Security Headers Configuration
# -----------------------------------------------------------------------------

# Helmet Configuration (security headers)
HELMET_ENABLED=true
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# Content Security Policy
CSP_ENABLED=true
CSP_REPORT_URI=/api/security/csp-report

# -----------------------------------------------------------------------------
# Audit Logging Configuration
# -----------------------------------------------------------------------------

# Enable Security Audit Logging
AUDIT_LOGGING_ENABLED=true

# Audit Log Retention (days)
AUDIT_LOG_RETENTION_DAYS=2555

# Enable PHI Access Logging (HIPAA requirement)
PHI_ACCESS_LOGGING_ENABLED=true

# -----------------------------------------------------------------------------
# Threat Detection Configuration
# -----------------------------------------------------------------------------

# Enable Automatic Threat Detection
THREAT_DETECTION_ENABLED=true

# Brute Force Detection Threshold (failed attempts)
BRUTE_FORCE_THRESHOLD=5

# Brute Force Detection Window (milliseconds)
BRUTE_FORCE_WINDOW=300000

# Enable SQL Injection Detection
SQL_INJECTION_DETECTION=true

# Enable XSS Detection
XSS_DETECTION=true

# -----------------------------------------------------------------------------
# Compliance Configuration
# -----------------------------------------------------------------------------

# HIPAA Compliance Mode
HIPAA_COMPLIANCE_ENABLED=true

# Automatic Session Timeout (milliseconds) - HIPAA recommends 15 minutes
AUTO_LOGOUT_TIMEOUT=900000

# Require MFA for Admin Accounts
REQUIRE_MFA_FOR_ADMIN=true

# Password Complexity Requirements
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBER=true
PASSWORD_REQUIRE_SPECIAL=true

# Password Expiration (days) - 0 = never expire
PASSWORD_EXPIRATION_DAYS=90

# -----------------------------------------------------------------------------
# Monitoring and Alerting
# -----------------------------------------------------------------------------

# Enable Security Event Alerts
SECURITY_ALERTS_ENABLED=true

# Alert Webhook URL (Slack, PagerDuty, etc.)
SECURITY_ALERT_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# Email Alerts for Critical Security Events
SECURITY_ALERT_EMAIL=security@whitecross.health

# Sentry DSN for Error Tracking
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# -----------------------------------------------------------------------------
# Environment Configuration
# -----------------------------------------------------------------------------

NODE_ENV=development

# Application Port
PORT=3001

# Database Configuration (separate from security config)
DATABASE_HOST=localhost
DATABASE_PORT=3306
DATABASE_NAME=white_cross_dev
DATABASE_USERNAME=root
DATABASE_PASSWORD=your-database-password

# =============================================================================
# SECURITY CHECKLIST FOR PRODUCTION DEPLOYMENT
# =============================================================================
#
# ✅ Change all secrets and keys (JWT_SECRET, CSRF_SECRET, etc.)
# ✅ Set strong CORS_ORIGIN (no wildcards)
# ✅ Configure REDIS_PASSWORD
# ✅ Set BCRYPT_SALT_ROUNDS to 12 or higher
# ✅ Enable all security features (HIPAA_COMPLIANCE_ENABLED, etc.)
# ✅ Configure audit logging and retention
# ✅ Set up security alerting (Slack, email, Sentry)
# ✅ Configure IP restrictions if needed
# ✅ Test all security guards and decorators
# ✅ Review and update CSP headers
# ✅ Enable HTTPS (SSL/TLS certificates)
# ✅ Set up WAF (Web Application Firewall) if available
# ✅ Configure database encryption at rest
# ✅ Enable automatic backups with encryption
# ✅ Set up monitoring and alerting (Datadog, New Relic, etc.)
# ✅ Conduct security audit and penetration testing
#
# =============================================================================
