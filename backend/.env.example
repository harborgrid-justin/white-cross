# ================================================================================
# WHITE CROSS SCHOOL HEALTH PLATFORM - ENVIRONMENT CONFIGURATION
# ================================================================================
#
# This file contains ALL environment variables required for the application.
# Copy this file to .env and fill in your actual values.
#
# SECURITY NOTES:
# - NEVER commit .env files to version control
# - REQUIRED variables have no defaults - app will fail to start if missing
# - Optional variables have safe defaults indicated below
# - Secrets must be minimum 32 characters in production
#
# ================================================================================

# ================================================================================
# APPLICATION CONFIGURATION
# ================================================================================

# Environment: development, staging, production, test (REQUIRED)
NODE_ENV=development

# HTTP server port (safe default: 3001)
PORT=3001

# ================================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# ================================================================================
# SECURITY: All database credentials are REQUIRED - no defaults provided

# DATABASE_URL: Alternative connection string format (for cloud deployments)
# Use this OR individual connection parameters below (not both)
# Format: postgresql://username:password@host:port/database?sslmode=require
# Example for Heroku, Render, Railway: postgresql://user:pass@host:5432/dbname?sslmode=require
# DATABASE_URL=postgresql://username:password@localhost:5432/whitecross

# Individual Connection Parameters (use if DATABASE_URL not set)
# Database host (REQUIRED if DATABASE_URL not set)
DB_HOST=localhost

# Database port (safe default: 5432)
DB_PORT=5432

# Database username (REQUIRED - no default for security)
DB_USERNAME=your_database_username

# Database password (REQUIRED - minimum 8 characters)
# SECURITY: Use strong password, never commit actual password
DB_PASSWORD=your_secure_database_password

# Database name (REQUIRED)
DB_NAME=whitecross

# Test database name (required in test environment)
DB_NAME_TEST=whitecross_test

# Enable SSL for database connections (safe default: false for local dev)
# REQUIRED in production
DB_SSL=false

# Auto-sync database schema (safe default: false to prevent data loss)
# WARNING: NEVER use true in production
DB_SYNC=false

# Enable database query logging (safe default: false)
# NOTE: Production always logs for HIPAA compliance regardless of this setting
DB_LOGGING=false

# ================================================================================
# DATABASE CONNECTION POOL CONFIGURATION
# ================================================================================
# Connection pool settings control database connection lifecycle and performance
# Adjust based on your application load and database server capacity
#
# PERFORMANCE IMPACT:
# - Increasing DB_POOL_MAX improves concurrent request handling (5x improvement)
# - Proper pool sizing prevents connection exhaustion under load
# - Eviction monitoring helps identify connection leaks
# - Retry logic provides resilience against transient failures

# Minimum connections in pool (safe default: 2)
# Production recommendation: 5 for baseline traffic handling
DB_POOL_MIN=2

# Maximum connections in pool (safe default: 10, production: 50)
# Production recommendation: 50 for high concurrency healthcare workloads
# WARNING: Must be >= DB_POOL_MIN and not exceed database max_connections
# CRITICAL: Increased from 10 to 50 for production to handle peak loads
DB_POOL_MAX=10

# Connection acquire timeout in milliseconds (safe default: 30000 = 30s)
# Time to wait for a connection before throwing error
# Higher values needed for heavy operations like bulk imports
DB_ACQUIRE_TIMEOUT=30000

# Connection idle timeout in milliseconds (safe default: 10000 = 10s)
# Time before releasing idle connections back to pool
# Lower values free up connections faster but may cause reconnection overhead
# OPTIMIZED: Reduced from 30s to 10s for faster connection recycling
DB_IDLE_TIMEOUT=10000

# Pool eviction check interval in milliseconds (safe default: 1000 = 1s)
# How often to check for idle connections to evict
# Lower values = more aggressive cleanup, higher values = less overhead
DB_POOL_EVICT=1000

# ================================================================================
# DATABASE PERFORMANCE & MONITORING
# ================================================================================

# Enable query benchmarking (safe default: false, production: true)
# Logs query execution time for performance monitoring
# RECOMMENDED: Enable in production for HIPAA audit compliance
DB_BENCHMARK=false

# Maximum retry attempts for failed queries (safe default: 3)
# Automatically retries transient failures (timeouts, connection errors)
DB_RETRY_MAX=3

# Statement timeout in milliseconds (safe default: 30000 = 30s)
# Maximum time allowed for any single query to execute
# Prevents runaway queries from blocking the database
DB_STATEMENT_TIMEOUT=30000

# Idle in transaction timeout in milliseconds (safe default: 30000 = 30s)
# Maximum time a transaction can remain idle before being terminated
# Prevents long-running transactions from holding locks
DB_IDLE_IN_TRANSACTION_TIMEOUT=30000

# ================================================================================
# JWT & AUTHENTICATION
# ================================================================================
# SECURITY: Secrets are REQUIRED with minimum 32 characters - no defaults

# JWT signing secret (REQUIRED - minimum 32 characters)
# SECURITY: Generate with: openssl rand -base64 32
JWT_SECRET=your-super-secret-jwt-key-minimum-32-chars-change-in-production

# JWT refresh token secret (REQUIRED - minimum 32 characters)
# SECURITY: Must be different from JWT_SECRET
JWT_REFRESH_SECRET=your-super-secret-refresh-key-minimum-32-chars-change-in-production

# JWT access token expiration (safe default: 15m)
JWT_EXPIRES_IN=15m

# JWT refresh token expiration (safe default: 7d)
JWT_REFRESH_EXPIRES_IN=7d

# Session secret (REQUIRED - minimum 32 characters)
# SECURITY: Must be different from JWT_SECRET and JWT_REFRESH_SECRET
# Used for session cookie signing
SESSION_SECRET=your-super-secret-session-key-minimum-32-chars-change-in-production

# ================================================================================
# SECURITY CONFIGURATION
# ================================================================================

# CSRF token secret (REQUIRED in production - minimum 32 characters)
# SECURITY: Generate with: openssl rand -base64 32
CSRF_SECRET=your-csrf-secret-minimum-32-chars-change-in-production

# Configuration encryption key (REQUIRED in production - minimum 32 characters)
CONFIG_ENCRYPTION_KEY=your-config-encryption-key-minimum-32-chars-change-in-production

# bcrypt Salt Rounds for password hashing (safe default: 12 for healthcare)
# Higher = More secure but slower (10-14 recommended range)
# Performance: 10=~100ms, 11=~200ms, 12=~400ms, 13=~800ms, 14=~1600ms
# SECURITY: 12 recommended for healthcare applications handling PHI
BCRYPT_SALT_ROUNDS=12

# Encryption algorithm (safe default: aes-256-gcm)
ENCRYPTION_ALGORITHM=aes-256-gcm

# Encryption key size in bytes (safe default: 32)
ENCRYPTION_KEY_SIZE=32

# Encryption IV size in bytes (safe default: 16)
ENCRYPTION_IV_SIZE=16

# RSA key size in bits (safe default: 4096)
RSA_KEY_SIZE=4096

# Enable automatic key rotation (safe default: true)
KEY_ROTATION_ENABLED=true

# Key rotation interval in days (safe default: 90)
KEY_ROTATION_INTERVAL_DAYS=90

# ================================================================================
# CORS & NETWORKING
# ================================================================================

# CORS allowed origins (REQUIRED)
# Development: http://localhost:3000
# Production: https://your-domain.com
# SECURITY: Never use wildcard (*) in production
CORS_ORIGIN=http://localhost:3000

# ================================================================================
# REDIS CONFIGURATION
# ================================================================================

# Redis host (safe default: localhost)
REDIS_HOST=localhost

# Redis port (safe default: 6379)
REDIS_PORT=6379

# Redis password (optional for local dev)
REDIS_PASSWORD=

# Redis username (optional)
REDIS_USERNAME=

# Redis database for cache (safe default: 0)
REDIS_DB=0

# Redis database for queues (safe default: 1)
REDIS_QUEUE_DB=1

# Default TTL in seconds (safe default: 300)
REDIS_TTL_DEFAULT=300

# Connection timeout in ms (safe default: 5000)
REDIS_CONNECTION_TIMEOUT=5000

# Max retries (safe default: 3)
REDIS_MAX_RETRIES=3

# Retry delay in ms (safe default: 1000)
REDIS_RETRY_DELAY=1000

# ================================================================================
# CACHE CONFIGURATION
# ================================================================================

CACHE_KEY_PREFIX=cache
CACHE_ENABLE_COMPRESSION=false
CACHE_COMPRESSION_THRESHOLD=1024
CACHE_ENABLE_L1=true
CACHE_L1_MAX_SIZE=1000
CACHE_L1_TTL=60
CACHE_ENABLE_LOGGING=false
CACHE_WARMING_ENABLED=false
CACHE_MAX_SIZE=1000
CACHE_DEFAULT_TTL=300000

# ================================================================================
# QUEUE CONFIGURATION
# ================================================================================

QUEUE_CONCURRENCY_DELIVERY=10
QUEUE_CONCURRENCY_NOTIFICATION=15
QUEUE_CONCURRENCY_ENCRYPTION=5
QUEUE_CONCURRENCY_INDEXING=3
QUEUE_CONCURRENCY_BATCH=2
QUEUE_CONCURRENCY_CLEANUP=1

# ================================================================================
# WEBSOCKET CONFIGURATION
# ================================================================================

WS_PORT=3002
WS_PATH=/socket.io
WS_CORS_ORIGIN=http://localhost:3000
WS_PING_TIMEOUT=60000
WS_PING_INTERVAL=25000

# ================================================================================
# LOGGING & MONITORING
# ================================================================================

# Log level: error, warn, info, debug, verbose (safe default: info)
LOG_LEVEL=info

# Sentry DSN for error tracking (optional)
SENTRY_DSN=

# Request timeout in ms (safe default: 30000)
REQUEST_TIMEOUT=30000

# ================================================================================
# AWS CONFIGURATION (Optional - for cloud deployments)
# ================================================================================

# AWS Region (safe default: us-east-1)
AWS_REGION=us-east-1

# AWS Credentials (optional - prefer IAM roles in production)
# Only required if not using IAM roles
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# S3 Configuration
AWS_S3_BUCKET=
AWS_S3_REGION=
AWS_S3_ENDPOINT=
AWS_S3_FORCE_PATH_STYLE=false

# AWS Secrets Manager
AWS_SECRETS_MANAGER_ENABLED=false
AWS_SECRET_NAME=
AWS_SECRETS_MANAGER_REGION=

# AWS SES (Simple Email Service)
AWS_SES_ENABLED=false
AWS_SES_REGION=
AWS_SES_FROM_EMAIL=

# AWS CloudWatch
AWS_CLOUDWATCH_ENABLED=false
AWS_CLOUDWATCH_LOG_GROUP=
AWS_CLOUDWATCH_LOG_STREAM=

# ================================================================================
# FEATURE FLAGS
# ================================================================================

FEATURES_ENABLE_AI_SEARCH=false
FEATURES_ENABLE_ANALYTICS=true
FEATURES_ENABLE_WEBSOCKET=true

# Module feature flags (opt-out: all enabled by default)
ENABLE_ANALYTICS=true
ENABLE_REPORTING=true
ENABLE_DASHBOARD=true
ENABLE_ADVANCED_FEATURES=true
ENABLE_ENTERPRISE=true

# Development-only features (opt-in)
ENABLE_DISCOVERY=false
CLI_MODE=false

# ================================================================================
# PRODUCTION CHECKLIST
# ================================================================================
# Before deploying to production:
# - Set NODE_ENV=production
# - Set all REQUIRED variables
# - Generate strong secrets (min 32 chars)
# - Set CORS_ORIGIN to exact domain
# - Set DB_SSL=true
# - Set DB_SYNC=false
# - Never commit .env to git
# ================================================================================
